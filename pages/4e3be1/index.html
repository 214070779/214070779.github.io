<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Block系列 | 洋仔的博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <meta name="description" content="专心做事，用心总结">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.55beba5e.css" as="style"><link rel="preload" href="/assets/js/app.cc55d274.js" as="script"><link rel="preload" href="/assets/js/2.81b2a5fe.js" as="script"><link rel="preload" href="/assets/js/50.d9cf5581.js" as="script"><link rel="prefetch" href="/assets/js/10.fd87ea06.js"><link rel="prefetch" href="/assets/js/100.033c06ef.js"><link rel="prefetch" href="/assets/js/101.1c0e8fbb.js"><link rel="prefetch" href="/assets/js/102.820c15ea.js"><link rel="prefetch" href="/assets/js/103.1f4387c0.js"><link rel="prefetch" href="/assets/js/104.6b56fc18.js"><link rel="prefetch" href="/assets/js/105.7e174701.js"><link rel="prefetch" href="/assets/js/106.e7ed90dd.js"><link rel="prefetch" href="/assets/js/107.5dff726f.js"><link rel="prefetch" href="/assets/js/108.1b4254ab.js"><link rel="prefetch" href="/assets/js/109.db801d19.js"><link rel="prefetch" href="/assets/js/11.4cd9f768.js"><link rel="prefetch" href="/assets/js/110.51ed8450.js"><link rel="prefetch" href="/assets/js/111.1ed05a5b.js"><link rel="prefetch" href="/assets/js/112.d7f263da.js"><link rel="prefetch" href="/assets/js/113.dea11b47.js"><link rel="prefetch" href="/assets/js/114.ad6403dc.js"><link rel="prefetch" href="/assets/js/115.28cf40c7.js"><link rel="prefetch" href="/assets/js/116.02bcdc6e.js"><link rel="prefetch" href="/assets/js/117.75a9e1eb.js"><link rel="prefetch" href="/assets/js/118.03e0d0e9.js"><link rel="prefetch" href="/assets/js/119.766321d8.js"><link rel="prefetch" href="/assets/js/12.1f119179.js"><link rel="prefetch" href="/assets/js/120.4acf5e51.js"><link rel="prefetch" href="/assets/js/121.a4fcaab7.js"><link rel="prefetch" href="/assets/js/122.d2cc02cb.js"><link rel="prefetch" href="/assets/js/123.c4c3b254.js"><link rel="prefetch" href="/assets/js/124.55aefdfc.js"><link rel="prefetch" href="/assets/js/125.33021e89.js"><link rel="prefetch" href="/assets/js/126.bf744470.js"><link rel="prefetch" href="/assets/js/127.d1b1efb8.js"><link rel="prefetch" href="/assets/js/128.8c1b4252.js"><link rel="prefetch" href="/assets/js/129.ac017f9f.js"><link rel="prefetch" href="/assets/js/13.0f009df8.js"><link rel="prefetch" href="/assets/js/130.fdc573c0.js"><link rel="prefetch" href="/assets/js/131.c4f70462.js"><link rel="prefetch" href="/assets/js/132.d874068e.js"><link rel="prefetch" href="/assets/js/133.3344bf55.js"><link rel="prefetch" href="/assets/js/134.86c9bfea.js"><link rel="prefetch" href="/assets/js/135.7761e325.js"><link rel="prefetch" href="/assets/js/136.99654544.js"><link rel="prefetch" href="/assets/js/137.25867633.js"><link rel="prefetch" href="/assets/js/138.3016a91b.js"><link rel="prefetch" href="/assets/js/139.ead29e5f.js"><link rel="prefetch" href="/assets/js/14.1c908535.js"><link rel="prefetch" href="/assets/js/140.2217ee0f.js"><link rel="prefetch" href="/assets/js/141.faed4896.js"><link rel="prefetch" href="/assets/js/142.3786cfaa.js"><link rel="prefetch" href="/assets/js/143.680d45a4.js"><link rel="prefetch" href="/assets/js/144.5e0d30d9.js"><link rel="prefetch" href="/assets/js/145.a2c5cf58.js"><link rel="prefetch" href="/assets/js/146.215c3961.js"><link rel="prefetch" href="/assets/js/147.81e5dbea.js"><link rel="prefetch" href="/assets/js/148.7ef156fa.js"><link rel="prefetch" href="/assets/js/149.07344fb0.js"><link rel="prefetch" href="/assets/js/15.24686777.js"><link rel="prefetch" href="/assets/js/150.100e1276.js"><link rel="prefetch" href="/assets/js/151.5a0852bd.js"><link rel="prefetch" href="/assets/js/152.d0e587d9.js"><link rel="prefetch" href="/assets/js/153.007ec2d1.js"><link rel="prefetch" href="/assets/js/154.3178d124.js"><link rel="prefetch" href="/assets/js/155.53357b05.js"><link rel="prefetch" href="/assets/js/156.d5438e93.js"><link rel="prefetch" href="/assets/js/157.8afa8209.js"><link rel="prefetch" href="/assets/js/158.0434bf90.js"><link rel="prefetch" href="/assets/js/159.64687b5f.js"><link rel="prefetch" href="/assets/js/16.12f4db26.js"><link rel="prefetch" href="/assets/js/160.56d76ff4.js"><link rel="prefetch" href="/assets/js/161.f6414d3f.js"><link rel="prefetch" href="/assets/js/162.b9de4b51.js"><link rel="prefetch" href="/assets/js/163.07e063ef.js"><link rel="prefetch" href="/assets/js/164.3acfc294.js"><link rel="prefetch" href="/assets/js/165.66703a7d.js"><link rel="prefetch" href="/assets/js/166.cb851667.js"><link rel="prefetch" href="/assets/js/167.4098c444.js"><link rel="prefetch" href="/assets/js/168.a80d728b.js"><link rel="prefetch" href="/assets/js/169.bd937a75.js"><link rel="prefetch" href="/assets/js/17.6c77ddb7.js"><link rel="prefetch" href="/assets/js/170.e3d78c48.js"><link rel="prefetch" href="/assets/js/171.bceae2ae.js"><link rel="prefetch" href="/assets/js/172.ce9b722c.js"><link rel="prefetch" href="/assets/js/173.e47f9666.js"><link rel="prefetch" href="/assets/js/174.7997805c.js"><link rel="prefetch" href="/assets/js/175.00237921.js"><link rel="prefetch" href="/assets/js/176.0fa3c92e.js"><link rel="prefetch" href="/assets/js/177.78d4055c.js"><link rel="prefetch" href="/assets/js/178.3b9e2d49.js"><link rel="prefetch" href="/assets/js/179.ffd38cbc.js"><link rel="prefetch" href="/assets/js/18.bdd3ef44.js"><link rel="prefetch" href="/assets/js/180.ea1e7437.js"><link rel="prefetch" href="/assets/js/181.1b990f8f.js"><link rel="prefetch" href="/assets/js/182.2294fb00.js"><link rel="prefetch" href="/assets/js/183.d49c9d33.js"><link rel="prefetch" href="/assets/js/184.ad8b9900.js"><link rel="prefetch" href="/assets/js/185.da48669b.js"><link rel="prefetch" href="/assets/js/186.650a47d2.js"><link rel="prefetch" href="/assets/js/187.dc3e7f5f.js"><link rel="prefetch" href="/assets/js/188.d372ce27.js"><link rel="prefetch" href="/assets/js/189.fa1c9909.js"><link rel="prefetch" href="/assets/js/19.10c0d5b8.js"><link rel="prefetch" href="/assets/js/190.6c1b8013.js"><link rel="prefetch" href="/assets/js/191.6676590e.js"><link rel="prefetch" href="/assets/js/192.cb1953e2.js"><link rel="prefetch" href="/assets/js/193.a6ae7e91.js"><link rel="prefetch" href="/assets/js/194.2ebc2436.js"><link rel="prefetch" href="/assets/js/195.35be6114.js"><link rel="prefetch" href="/assets/js/196.b360067a.js"><link rel="prefetch" href="/assets/js/197.c0234eef.js"><link rel="prefetch" href="/assets/js/198.6231b11b.js"><link rel="prefetch" href="/assets/js/199.838ff34e.js"><link rel="prefetch" href="/assets/js/20.92725459.js"><link rel="prefetch" href="/assets/js/200.5dc57180.js"><link rel="prefetch" href="/assets/js/201.39e5421a.js"><link rel="prefetch" href="/assets/js/202.0a56fa31.js"><link rel="prefetch" href="/assets/js/203.90d6ea32.js"><link rel="prefetch" href="/assets/js/204.48311b42.js"><link rel="prefetch" href="/assets/js/205.e1f37224.js"><link rel="prefetch" href="/assets/js/206.92c38d74.js"><link rel="prefetch" href="/assets/js/207.3493f997.js"><link rel="prefetch" href="/assets/js/208.d2d00438.js"><link rel="prefetch" href="/assets/js/209.7ff3e1db.js"><link rel="prefetch" href="/assets/js/21.703ec124.js"><link rel="prefetch" href="/assets/js/210.b9e087c1.js"><link rel="prefetch" href="/assets/js/211.0b5f6ae5.js"><link rel="prefetch" href="/assets/js/212.5a5a4e85.js"><link rel="prefetch" href="/assets/js/213.ddea0aff.js"><link rel="prefetch" href="/assets/js/214.06e03126.js"><link rel="prefetch" href="/assets/js/215.99e71be9.js"><link rel="prefetch" href="/assets/js/216.5ab77662.js"><link rel="prefetch" href="/assets/js/217.5b8b2a56.js"><link rel="prefetch" href="/assets/js/218.656d4df8.js"><link rel="prefetch" href="/assets/js/219.2f9282d7.js"><link rel="prefetch" href="/assets/js/22.7832c9ca.js"><link rel="prefetch" href="/assets/js/220.05012b4c.js"><link rel="prefetch" href="/assets/js/221.150b41d4.js"><link rel="prefetch" href="/assets/js/222.18bfe57a.js"><link rel="prefetch" href="/assets/js/223.5d9b036a.js"><link rel="prefetch" href="/assets/js/224.cd5efc56.js"><link rel="prefetch" href="/assets/js/225.fe1ef215.js"><link rel="prefetch" href="/assets/js/226.b5602968.js"><link rel="prefetch" href="/assets/js/227.9f3fc228.js"><link rel="prefetch" href="/assets/js/228.a9a155dc.js"><link rel="prefetch" href="/assets/js/229.53d80ddd.js"><link rel="prefetch" href="/assets/js/23.8e2d40f9.js"><link rel="prefetch" href="/assets/js/230.4918b1a6.js"><link rel="prefetch" href="/assets/js/231.ca415abb.js"><link rel="prefetch" href="/assets/js/232.04bfb190.js"><link rel="prefetch" href="/assets/js/233.d2a40489.js"><link rel="prefetch" href="/assets/js/234.e2aacb9a.js"><link rel="prefetch" href="/assets/js/235.163536f8.js"><link rel="prefetch" href="/assets/js/236.6c845360.js"><link rel="prefetch" href="/assets/js/237.cad6b7ea.js"><link rel="prefetch" href="/assets/js/238.c802c732.js"><link rel="prefetch" href="/assets/js/239.3a5fe17c.js"><link rel="prefetch" href="/assets/js/24.4c371769.js"><link rel="prefetch" href="/assets/js/240.27f6052d.js"><link rel="prefetch" href="/assets/js/241.a631c566.js"><link rel="prefetch" href="/assets/js/242.01736d0d.js"><link rel="prefetch" href="/assets/js/243.b1af5586.js"><link rel="prefetch" href="/assets/js/244.18016cf2.js"><link rel="prefetch" href="/assets/js/245.0626c28d.js"><link rel="prefetch" href="/assets/js/246.73f699ec.js"><link rel="prefetch" href="/assets/js/247.f444bd44.js"><link rel="prefetch" href="/assets/js/248.65a80d31.js"><link rel="prefetch" href="/assets/js/249.0dd1d0d9.js"><link rel="prefetch" href="/assets/js/25.b040b00d.js"><link rel="prefetch" href="/assets/js/250.69712e0b.js"><link rel="prefetch" href="/assets/js/251.d4d3c3e2.js"><link rel="prefetch" href="/assets/js/252.6484f155.js"><link rel="prefetch" href="/assets/js/253.410f1ed5.js"><link rel="prefetch" href="/assets/js/254.e8b85c6f.js"><link rel="prefetch" href="/assets/js/255.d2df3587.js"><link rel="prefetch" href="/assets/js/256.09bb0d0e.js"><link rel="prefetch" href="/assets/js/257.71461633.js"><link rel="prefetch" href="/assets/js/258.af2f399d.js"><link rel="prefetch" href="/assets/js/259.9ec5e83b.js"><link rel="prefetch" href="/assets/js/26.a1fb922a.js"><link rel="prefetch" href="/assets/js/260.cac8239f.js"><link rel="prefetch" href="/assets/js/261.925d41ff.js"><link rel="prefetch" href="/assets/js/262.28633c4a.js"><link rel="prefetch" href="/assets/js/263.f21c004b.js"><link rel="prefetch" href="/assets/js/264.57e4ff6c.js"><link rel="prefetch" href="/assets/js/265.c962904f.js"><link rel="prefetch" href="/assets/js/266.5d28c35b.js"><link rel="prefetch" href="/assets/js/267.966d88be.js"><link rel="prefetch" href="/assets/js/268.7f072ba9.js"><link rel="prefetch" href="/assets/js/269.8a2bbc16.js"><link rel="prefetch" href="/assets/js/27.8ae4e4fd.js"><link rel="prefetch" href="/assets/js/270.c7dbb8c2.js"><link rel="prefetch" href="/assets/js/271.fd0a8147.js"><link rel="prefetch" href="/assets/js/272.39f2833e.js"><link rel="prefetch" href="/assets/js/273.5d03fdb3.js"><link rel="prefetch" href="/assets/js/274.d7cde43a.js"><link rel="prefetch" href="/assets/js/275.2b84609e.js"><link rel="prefetch" href="/assets/js/276.2ba14d83.js"><link rel="prefetch" href="/assets/js/277.bedaa21d.js"><link rel="prefetch" href="/assets/js/278.9750200e.js"><link rel="prefetch" href="/assets/js/279.54cf5084.js"><link rel="prefetch" href="/assets/js/28.7c726cfd.js"><link rel="prefetch" href="/assets/js/280.24775da3.js"><link rel="prefetch" href="/assets/js/281.f44383db.js"><link rel="prefetch" href="/assets/js/282.5dd2530b.js"><link rel="prefetch" href="/assets/js/283.60a029cc.js"><link rel="prefetch" href="/assets/js/284.80d5c684.js"><link rel="prefetch" href="/assets/js/285.2233e644.js"><link rel="prefetch" href="/assets/js/286.2e6924e4.js"><link rel="prefetch" href="/assets/js/287.52470b25.js"><link rel="prefetch" href="/assets/js/288.0c9d41ca.js"><link rel="prefetch" href="/assets/js/289.57b35055.js"><link rel="prefetch" href="/assets/js/29.5762da80.js"><link rel="prefetch" href="/assets/js/290.3765d6a5.js"><link rel="prefetch" href="/assets/js/291.6bd15b79.js"><link rel="prefetch" href="/assets/js/292.afb5a75a.js"><link rel="prefetch" href="/assets/js/293.f5759dcb.js"><link rel="prefetch" href="/assets/js/294.2209dfe5.js"><link rel="prefetch" href="/assets/js/295.f7e224d5.js"><link rel="prefetch" href="/assets/js/296.36fde749.js"><link rel="prefetch" href="/assets/js/297.df8a1239.js"><link rel="prefetch" href="/assets/js/298.d0028860.js"><link rel="prefetch" href="/assets/js/299.f44a0e98.js"><link rel="prefetch" href="/assets/js/3.1b6e43a5.js"><link rel="prefetch" href="/assets/js/30.f7bd2da9.js"><link rel="prefetch" href="/assets/js/300.e1e1e2af.js"><link rel="prefetch" href="/assets/js/301.ac068e67.js"><link rel="prefetch" href="/assets/js/302.1e2a778b.js"><link rel="prefetch" href="/assets/js/303.32c1023d.js"><link rel="prefetch" href="/assets/js/304.2bd7d59c.js"><link rel="prefetch" href="/assets/js/305.0e0b08a3.js"><link rel="prefetch" href="/assets/js/306.48947241.js"><link rel="prefetch" href="/assets/js/307.04186968.js"><link rel="prefetch" href="/assets/js/308.b6b41f7b.js"><link rel="prefetch" href="/assets/js/309.ed01b460.js"><link rel="prefetch" href="/assets/js/31.81b4a4d2.js"><link rel="prefetch" href="/assets/js/310.61ab2756.js"><link rel="prefetch" href="/assets/js/311.dfa83b75.js"><link rel="prefetch" href="/assets/js/312.21c9fcf2.js"><link rel="prefetch" href="/assets/js/313.9c7bdcf7.js"><link rel="prefetch" href="/assets/js/314.444459f4.js"><link rel="prefetch" href="/assets/js/315.01c2dddd.js"><link rel="prefetch" href="/assets/js/316.fa19412e.js"><link rel="prefetch" href="/assets/js/317.b8e81823.js"><link rel="prefetch" href="/assets/js/318.a76c19a2.js"><link rel="prefetch" href="/assets/js/319.b6d393e9.js"><link rel="prefetch" href="/assets/js/32.d9074bf8.js"><link rel="prefetch" href="/assets/js/320.b9b7d53d.js"><link rel="prefetch" href="/assets/js/321.377dc9df.js"><link rel="prefetch" href="/assets/js/322.5414100c.js"><link rel="prefetch" href="/assets/js/323.0edddb0c.js"><link rel="prefetch" href="/assets/js/324.a3c19125.js"><link rel="prefetch" href="/assets/js/325.0a931352.js"><link rel="prefetch" href="/assets/js/326.99cd4779.js"><link rel="prefetch" href="/assets/js/327.aa0bbc95.js"><link rel="prefetch" href="/assets/js/328.8d936413.js"><link rel="prefetch" href="/assets/js/329.86331300.js"><link rel="prefetch" href="/assets/js/33.61cbe880.js"><link rel="prefetch" href="/assets/js/330.2f949c81.js"><link rel="prefetch" href="/assets/js/331.27c8897b.js"><link rel="prefetch" href="/assets/js/332.2a06265f.js"><link rel="prefetch" href="/assets/js/333.5380694f.js"><link rel="prefetch" href="/assets/js/334.a4fc88c7.js"><link rel="prefetch" href="/assets/js/335.d24aa360.js"><link rel="prefetch" href="/assets/js/336.e6c27799.js"><link rel="prefetch" href="/assets/js/337.7068bfa9.js"><link rel="prefetch" href="/assets/js/338.05129acf.js"><link rel="prefetch" href="/assets/js/339.32a155e4.js"><link rel="prefetch" href="/assets/js/34.458856b1.js"><link rel="prefetch" href="/assets/js/340.79f4160c.js"><link rel="prefetch" href="/assets/js/341.1845d39d.js"><link rel="prefetch" href="/assets/js/342.e9025266.js"><link rel="prefetch" href="/assets/js/343.022762e6.js"><link rel="prefetch" href="/assets/js/344.5f6ede26.js"><link rel="prefetch" href="/assets/js/345.0f09d3e9.js"><link rel="prefetch" href="/assets/js/346.baf57bd3.js"><link rel="prefetch" href="/assets/js/347.fca5ad32.js"><link rel="prefetch" href="/assets/js/348.ee72d1c4.js"><link rel="prefetch" href="/assets/js/349.3d1973a7.js"><link rel="prefetch" href="/assets/js/35.bd72afbd.js"><link rel="prefetch" href="/assets/js/350.6c10a97f.js"><link rel="prefetch" href="/assets/js/351.2b4fcad2.js"><link rel="prefetch" href="/assets/js/352.cc2e2e46.js"><link rel="prefetch" href="/assets/js/353.93baf91c.js"><link rel="prefetch" href="/assets/js/354.ce9d0e4c.js"><link rel="prefetch" href="/assets/js/355.110b2119.js"><link rel="prefetch" href="/assets/js/356.31c1cb3f.js"><link rel="prefetch" href="/assets/js/357.fc56933d.js"><link rel="prefetch" href="/assets/js/358.3d6f0995.js"><link rel="prefetch" href="/assets/js/359.e42fb771.js"><link rel="prefetch" href="/assets/js/36.51ff5da4.js"><link rel="prefetch" href="/assets/js/360.b23f20a6.js"><link rel="prefetch" href="/assets/js/361.d40a5970.js"><link rel="prefetch" href="/assets/js/362.5526289b.js"><link rel="prefetch" href="/assets/js/363.57de68f3.js"><link rel="prefetch" href="/assets/js/364.be1cb110.js"><link rel="prefetch" href="/assets/js/365.61d49f0a.js"><link rel="prefetch" href="/assets/js/366.b507225c.js"><link rel="prefetch" href="/assets/js/367.7b1436ad.js"><link rel="prefetch" href="/assets/js/368.dcd60637.js"><link rel="prefetch" href="/assets/js/369.51c46392.js"><link rel="prefetch" href="/assets/js/37.4d7470cc.js"><link rel="prefetch" href="/assets/js/370.79f0015e.js"><link rel="prefetch" href="/assets/js/371.d8c48ef6.js"><link rel="prefetch" href="/assets/js/372.3ccfa0e9.js"><link rel="prefetch" href="/assets/js/373.6ff5c143.js"><link rel="prefetch" href="/assets/js/374.f4fcf914.js"><link rel="prefetch" href="/assets/js/375.d24d77a1.js"><link rel="prefetch" href="/assets/js/376.46fa8c82.js"><link rel="prefetch" href="/assets/js/377.dc0360fd.js"><link rel="prefetch" href="/assets/js/38.b792089b.js"><link rel="prefetch" href="/assets/js/39.65ad4770.js"><link rel="prefetch" href="/assets/js/4.86cba761.js"><link rel="prefetch" href="/assets/js/40.8b58385f.js"><link rel="prefetch" href="/assets/js/41.398e86ae.js"><link rel="prefetch" href="/assets/js/42.789f1388.js"><link rel="prefetch" href="/assets/js/43.05f9d13d.js"><link rel="prefetch" href="/assets/js/44.c2b40548.js"><link rel="prefetch" href="/assets/js/45.df48e9a2.js"><link rel="prefetch" href="/assets/js/46.b83749fb.js"><link rel="prefetch" href="/assets/js/47.7ef7d498.js"><link rel="prefetch" href="/assets/js/48.228e3df9.js"><link rel="prefetch" href="/assets/js/49.fda0dc0b.js"><link rel="prefetch" href="/assets/js/5.3a0ea465.js"><link rel="prefetch" href="/assets/js/51.3096a574.js"><link rel="prefetch" href="/assets/js/52.479127e5.js"><link rel="prefetch" href="/assets/js/53.5e0b1963.js"><link rel="prefetch" href="/assets/js/54.59740785.js"><link rel="prefetch" href="/assets/js/55.3b7f709a.js"><link rel="prefetch" href="/assets/js/56.54492258.js"><link rel="prefetch" href="/assets/js/57.35db8f10.js"><link rel="prefetch" href="/assets/js/58.4de20d90.js"><link rel="prefetch" href="/assets/js/59.63dfef23.js"><link rel="prefetch" href="/assets/js/6.5a97029d.js"><link rel="prefetch" href="/assets/js/60.fdf12a20.js"><link rel="prefetch" href="/assets/js/61.fe3f97d3.js"><link rel="prefetch" href="/assets/js/62.f1b0daf7.js"><link rel="prefetch" href="/assets/js/63.93837b5d.js"><link rel="prefetch" href="/assets/js/64.97a1fe26.js"><link rel="prefetch" href="/assets/js/65.70f35686.js"><link rel="prefetch" href="/assets/js/66.3ba3c686.js"><link rel="prefetch" href="/assets/js/67.14cef3f2.js"><link rel="prefetch" href="/assets/js/68.e8a147f5.js"><link rel="prefetch" href="/assets/js/69.24e88bd2.js"><link rel="prefetch" href="/assets/js/7.ce6c36f3.js"><link rel="prefetch" href="/assets/js/70.15818cd2.js"><link rel="prefetch" href="/assets/js/71.119594cc.js"><link rel="prefetch" href="/assets/js/72.9fcbbf86.js"><link rel="prefetch" href="/assets/js/73.b82c6339.js"><link rel="prefetch" href="/assets/js/74.32848a73.js"><link rel="prefetch" href="/assets/js/75.6efef423.js"><link rel="prefetch" href="/assets/js/76.17ea6bee.js"><link rel="prefetch" href="/assets/js/77.220ac10b.js"><link rel="prefetch" href="/assets/js/78.a880b44d.js"><link rel="prefetch" href="/assets/js/79.217ab01c.js"><link rel="prefetch" href="/assets/js/8.cbd97eba.js"><link rel="prefetch" href="/assets/js/80.2e717400.js"><link rel="prefetch" href="/assets/js/81.b7277c4e.js"><link rel="prefetch" href="/assets/js/82.8e22a60c.js"><link rel="prefetch" href="/assets/js/83.c39494a6.js"><link rel="prefetch" href="/assets/js/84.e379d0cd.js"><link rel="prefetch" href="/assets/js/85.3f7d9716.js"><link rel="prefetch" href="/assets/js/86.a7c0bd99.js"><link rel="prefetch" href="/assets/js/87.eb9b0263.js"><link rel="prefetch" href="/assets/js/88.32d31cd7.js"><link rel="prefetch" href="/assets/js/89.cb0eb0c6.js"><link rel="prefetch" href="/assets/js/9.e79b9220.js"><link rel="prefetch" href="/assets/js/90.2aa9f60f.js"><link rel="prefetch" href="/assets/js/91.979af91d.js"><link rel="prefetch" href="/assets/js/92.ecca824d.js"><link rel="prefetch" href="/assets/js/93.70a3d5ac.js"><link rel="prefetch" href="/assets/js/94.c163ecdc.js"><link rel="prefetch" href="/assets/js/95.d5eb2ea5.js"><link rel="prefetch" href="/assets/js/96.d596f924.js"><link rel="prefetch" href="/assets/js/97.fde076d3.js"><link rel="prefetch" href="/assets/js/98.1189bd76.js"><link rel="prefetch" href="/assets/js/99.9e004fea.js">
    <link rel="stylesheet" href="/assets/css/0.styles.55beba5e.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="洋仔的博客" class="logo"> <span class="site-name can-hide">洋仔的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人心法" class="dropdown-title"><a href="/person/" class="link-title">个人心法</a> <span class="title" style="display:none;">个人心法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>个人心法总结</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fe3f91/" class="nav-link">价值心法</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/pages/d13cac/" class="nav-link">iOS基础知识</a></li><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">前端</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/more/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/15d3d8/" class="nav-link">投资体系</a></li><li class="dropdown-item"><!----> <a href="/pages/4db018/" class="nav-link">毛选</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/214070779/publicPicture@master/pingtou.5ytkqlpmd940.webp"> <div class="blogger-info"><h3>洋仔</h3> <span>奋斗的小青年</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人心法" class="dropdown-title"><a href="/person/" class="link-title">个人心法</a> <span class="title" style="display:none;">个人心法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>个人心法总结</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fe3f91/" class="nav-link">价值心法</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/pages/d13cac/" class="nav-link">iOS基础知识</a></li><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">前端</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/more/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/15d3d8/" class="nav-link">投资体系</a></li><li class="dropdown-item"><!----> <a href="/pages/4db018/" class="nav-link">毛选</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术文档</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GitHub技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>博客搭建</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>iOS基础知识</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>iOS底层相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Runloop系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Runtime系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>内存管理系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Block系列</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/4e3be1/" aria-current="page" class="active sidebar-link">Block系列</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/4e3be1/#block-本质" class="sidebar-link">block 本质</a></li><li class="sidebar-sub-header level2"><a href="/pages/4e3be1/#block-类型" class="sidebar-link">Block 类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#nsglobalblock-全局block" class="sidebar-link">NSGlobalBlock 全局block</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#nsstackblock-栈block" class="sidebar-link">NSStackBlock 栈block</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#nsmallocblock" class="sidebar-link">NSMallocBlock</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#总结" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/4e3be1/#block中关键字的使用" class="sidebar-link">block中关键字的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#block-的作用" class="sidebar-link">__block 的作用</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#weak-的作用" class="sidebar-link">__weak 的作用</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#strong-的作用" class="sidebar-link">__strong 的作用</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/4e3be1/#拓展知识" class="sidebar-link">拓展知识</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#思考题" class="sidebar-link">思考题</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#block-数据结构" class="sidebar-link">Block 数据结构</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/4e3be1/#总结-2" class="sidebar-link">总结</a></li><li class="sidebar-sub-header level2"><a href="/pages/4e3be1/#block面试题" class="sidebar-link">block面试题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#block和-weak修饰符的区别" class="sidebar-link">block和_weak修饰符的区别？</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#block是否能修改外部变量的值" class="sidebar-link">block是否能修改外部变量的值</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#block在arc跟mrc中的行为和用法有什么区别" class="sidebar-link">Block在ARC跟MRC中的行为和用法有什么区别？</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#block是类吗-有哪些类型" class="sidebar-link">block是类吗，有哪些类型?</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#一个int变量被-block-修饰与否的区别-block的变量截获" class="sidebar-link">一个int变量被 __block 修饰与否的区别？block的变量截获</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#什么时候栈上的block会被复制到堆呢" class="sidebar-link">什么时候栈上的Block会被复制到堆呢？</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#block在修改nsmutablearray-需不需要添加-block" class="sidebar-link">block在修改NSMutableArray，需不需要添加__block</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#block怎么进行内存管理的" class="sidebar-link">block怎么进行内存管理的?</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#block可以用strong修饰吗" class="sidebar-link">block可以用strong修饰吗?</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#解决循环引用时为什么要用-strong、-weak修饰" class="sidebar-link">解决循环引用时为什么要用_strong、_weak修饰?</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#block发生copy时机" class="sidebar-link">block发生copy时机?</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#block访问对象类型的auto变量时-在arc和mrc下有什么区别" class="sidebar-link">Block访问对象类型的auto变量时，在ARC和MRC下有什么区别?</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/4e3be1/#block-的变量捕获机制" class="sidebar-link">block 的变量捕获机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#auto-类型的局部变量" class="sidebar-link">auto 类型的局部变量</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#static-类型的局部变量" class="sidebar-link">static 类型的局部变量</a></li><li class="sidebar-sub-header level3"><a href="/pages/4e3be1/#对象类型的局部变量" class="sidebar-link">对象类型的局部变量</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>线程系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>KVC跟KVO系列以及通知中心</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>UI系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>离屏渲染系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>组件化系列跟架构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>OC跟webview交互系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>持久化系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>APP编译系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>APP性能优化系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>cocoapods系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>swift系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Git系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>网络相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>三方库系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>系统原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>总结系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>算法系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>数据结构系列</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/ui/#技术" data-v-06225672>技术</a></li><li data-v-06225672><a href="/ui/#iOS基础知识" data-v-06225672>iOS基础知识</a></li><li data-v-06225672><a href="/ui/#Block系列" data-v-06225672>Block系列</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/214070779" target="_blank" title="作者" class="beLink" data-v-06225672>洋仔</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-08-12</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Block系列<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="block-本质"><a href="#block-本质" class="header-anchor">#</a> block 本质</h2> <p>Block 本质上是一个 Objective-C 的对象，它内部也有一个 isa 指针，它是一个封装了函数及函数调用环境的 Objective-C 对象，可以添加到 NSArray 及 NSDictionary 等集合中，它是基于 C 语言及运行时特性，有点类似标准的 C 函数。但除了可执行代码以外，另外包含了变量同堆或栈的自动绑定。</p> <h2 id="block-类型"><a href="#block-类型" class="header-anchor">#</a> Block 类型</h2> <h3 id="nsglobalblock-全局block"><a href="#nsglobalblock-全局block" class="header-anchor">#</a> NSGlobalBlock 全局block</h3> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span>exampleBlock<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token comment">// block</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;exampleBlock is: %@&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span>exampleBlock class<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>打印日志：exampleBlock is: <strong>NSGlobalBlock</strong></p> <p>如果一个 block 没有访问外部局部变量，或者访问的是全局变量，或者静态局部变量，此时的 block 就是一个全局 block ，并且数据存储在全局区。</p> <h3 id="nsstackblock-栈block"><a href="#nsstackblock-栈block" class="header-anchor">#</a> NSStackBlock 栈block</h3> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code><span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span>exampleBlock<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token comment">// block</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;exampleBlock is: %d&quot;</span><span class="token punctuation">,</span> temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;exampleBlock is: %@&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span>exampleBlock class<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>打印日志：exampleBlock is: <strong>NSMallocBlock</strong>？？？不是说好的 <strong>NSStackBlock</strong> 的吗？为什么打印的是__NSMallocBlock__ 呢？这里是因为我们使用了 ARC ，Xcode 默认帮我们做了很多事情。</p> <p>我们可以去 Build Settings 里面，找到 Objective-C Automatic Reference Counting ，并将其设置为 No ，然后再 Run 一次代码。你会看到打印日志是：exampleBlock is: <strong>NSStackBlock</strong></p> <p>如果 block 访问了外部局部变量，此时的 block 就是一个栈 block ，并且存储在栈区。由于栈区的释放是由系统控制，因此栈中的代码在作用域结束之后内存就会销毁，如果此时再调用 block 就会发生问题，( 注： 此代码运行在 MRC 下)如：</p> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span>simpleBlock<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">callFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    simpleBlock <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">{</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;simpleBlock-----%d&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    NSString <span class="token operator">*</span> appDelegateClassName<span class="token punctuation">;</span>
    <span class="token operator">@</span>autoreleasepool <span class="token punctuation">{</span>
        <span class="token function">callFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">simpleBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Setup code that might create autoreleased objects goes here.</span>
        appDelegateClassName <span class="token operator">=</span> <span class="token function">NSStringFromClass</span><span class="token punctuation">(</span><span class="token punctuation">[</span>AppDelegate class<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>打印日志：simpleBlock--------41044160</p> <h3 id="nsmallocblock"><a href="#nsmallocblock" class="header-anchor">#</a> NSMallocBlock</h3> <p>当一个 <strong>NSStackBlock</strong> 类型 block 做 copy 操作后，就会将这个 block 从栈上复制到堆上，而堆上的这个 block 类型就是 <strong>NSMallocBlock</strong> 类型。在 ARC 环境下，编译器会根据情况，自动将 block 从栈上 copy 到堆上。具体会进行 copy 的情况有如下 4 种：</p> <p>block 作为函数的返回值时；
block 赋值给 __strong 指针，或者赋值给 block 类型的成员变量时；
block 作为 Cocoa API 中方法名含有 usingBlock 的方法参数时；
block 作为 GCD API 的方法参数时；</p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>MRC下block类型</p> <table><thead><tr><th>类型</th> <th>环境</th></tr></thead> <tbody><tr><td>_NSConcreteGlobalBlock</td> <td>只访问了静态变量（包括全局静态变量和局部静态变量）和全局变量</td></tr> <tr><td>_NSConcreteStackBlock</td> <td>没访问静态变量和全局变量</td></tr> <tr><td>_NSConcreteMallocBlock</td> <td>NSStackBlock调用了copy</td></tr></tbody></table> <p>ARC下block类型</p> <table><thead><tr><th>类型</th> <th>环境</th></tr></thead> <tbody><tr><td>_NSConcreteGlobalBlock</td> <td>只访问了静态变量（包括全局静态变量和局部静态变量）和全局变量</td></tr> <tr><td>_NSConcreteMallocBlock</td> <td>没访问静态变量和全局变量</td></tr></tbody></table> <details class="custom-block details"><summary>点击查看</summary> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code> __weak <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>weakSelf <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span>block1<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=</span>  <span class="token operator">^</span><span class="token punctuation">{</span>
        a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//b为全局变量</span>

    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    __block <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span>block2<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=</span>  <span class="token operator">^</span><span class="token punctuation">{</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;age:%d&quot;</span><span class="token punctuation">,</span> weakSelf<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        c <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;block1.class = %@&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>block1 class<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;block2.class = %@&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>block2 class<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;block2 copy.class = %@&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>block2 copy<span class="token punctuation">]</span> class<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

运行结果如下：
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">45</span><span class="token punctuation">:</span><span class="token number">54.457496</span><span class="token operator">+</span><span class="token number">0800</span> BlockTestDemo<span class="token punctuation">[</span><span class="token number">13178</span><span class="token punctuation">:</span><span class="token number">426318</span><span class="token punctuation">]</span> block1<span class="token punctuation">.</span>class <span class="token operator">=</span> __NSGlobalBlock__
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">45</span><span class="token punctuation">:</span><span class="token number">54.457616</span><span class="token operator">+</span><span class="token number">0800</span> BlockTestDemo<span class="token punctuation">[</span><span class="token number">13178</span><span class="token punctuation">:</span><span class="token number">426318</span><span class="token punctuation">]</span> block2<span class="token punctuation">.</span>class <span class="token operator">=</span> __NSStackBlock__
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">45</span><span class="token punctuation">:</span><span class="token number">54.457720</span><span class="token operator">+</span><span class="token number">0800</span> BlockTestDemo<span class="token punctuation">[</span><span class="token number">13178</span><span class="token punctuation">:</span><span class="token number">426318</span><span class="token punctuation">]</span> block2 copy<span class="token punctuation">.</span>class <span class="token operator">=</span> __NSMallocBlock__
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></details> <h2 id="block中关键字的使用"><a href="#block中关键字的使用" class="header-anchor">#</a> block中关键字的使用</h2> <h3 id="block-的作用"><a href="#block-的作用" class="header-anchor">#</a> __block 的作用</h3> <p>简单来说，__block 作用是允许 block 内部访问和修改外部变量，在 ARC 环境下还可以用来防止循环引用；</p> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code>__block <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span>exampleBlock<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token comment">// block</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;1.age is: %d&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    age <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;2.age is: %d&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">exampleBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;3.age is: %d&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>__block 主要用来解决 block 内部无法修改 auto 变量值的问题，为什么加上 __block 修饰之后，auto 变量值就能修改了呢？</p> <p>这是因为，加上 __block 修饰之后，编译器会将 __block 变量包装成一个结构体 __Block_byref_age_0 ，结构体内部 *__forwarding 是指向自身的指针，并且结构体内部还存储着外部 auto 变量。</p> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code><span class="token keyword">struct</span> __Block_byref_val_0 <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>__isa<span class="token punctuation">;</span> <span class="token comment">// isa指针</span>
    __Block_byref_val_0 <span class="token operator">*</span>__forwarding<span class="token punctuation">;</span> 
    <span class="token keyword">int</span> __flags<span class="token punctuation">;</span>
    <span class="token keyword">int</span> __size<span class="token punctuation">;</span> <span class="token comment">// Block结构体大小</span>
    <span class="token keyword">int</span> age<span class="token punctuation">;</span> <span class="token comment">// 捕获到的变量</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="https://cdn.staticaly.com/gh/214070779/picx-images-hosting@master/20230813/Screenshot-2023-08-22-at-20.32.40.4mbeyx6a1lk0.webp" alt="Screenshot-2023-08-22-at-20"></p> <p>从上图可以看到，如果 block 是在栈上，那么这个 __forwarding 指针就是指向它自己，当这个 block 从栈上复制到堆上后，栈上的 __forwarding 指针指向的是复制到堆上的 __block 结构体。堆上的 __block 结构体中的 __forwarding 指向的还是它自己，即 age-&gt;__forwarding 获取到堆上的 __block 结构体，age-&gt;__forwarding-&gt;age 会把堆上的 age 赋值为 16 。因此不管是栈上还是堆上的 __block 结构体，最终使用到的都是堆上的 __block 结构体里面的数据。</p> <p>对于是否可以修改外部变量,我们可以主要集中于这个自加的操作,如果<code>__forwarding</code>永远指向自身那么直接通过i取到i对应的值就可以了为什么中间加一个<code>__forwarding</code>呢？</p> <p>我们知道, ARC环境下，一旦Block赋值就会触发copy，__block修饰的变量也就会copy到堆上，Block的类型也就变成了__NSMallocBlock。</p> <p>堆上的Block会持有对象。我们把Block通过copy到了堆上，堆上也会重新复制一份Block，并且该Block也会继续持有该__block修饰的对象。当Block释放的时候，__block修饰的对象因为没有被任何对象引用，也会被释放销毁</p> <p><code>__forwarding</code>指针这里的作用就是针对堆的Block，把原来<code>__forwarding</code>指针指向自己，换成指向<code>_NSConcreteMallocBlock</code>上复制之后的__block自己。然后堆上的变量的<code>__forwarding</code>再指向自己。这样不管__block怎么复制到堆上，还是在栈上，都可以通过<code>(i-&gt;__forwarding-&gt;i)</code>来访问到变量值。</p> <p>block创建的时候是在栈上的,对block进行赋值操作之后会将block拷贝到堆上。同时也会将block中使用的对象拷贝到堆上。然后将栈上的__block修饰对象的__forwarding指针指向堆上的拷贝之后的对象。这样我们在block内部修改的时候虽然是修改堆上的对象的值,但是因为栈上的对象的__forwarding指针将堆和栈的对象链接起来。因此达到了修改的目的。</p> <h3 id="weak-的作用"><a href="#weak-的作用" class="header-anchor">#</a> __weak 的作用</h3> <p>简单来说是为了防止循环引用。</p> <p><img src="https://cdn.staticaly.com/gh/214070779/picx-images-hosting@master/20230813/Screenshot-2023-08-22-at-20.36.38.7dcazf1w73k0.webp" alt="Screenshot-2023-08-22-at-20"></p> <p>self 本身会对 block 进行强引用，block 也会对 self 形成强引用，这样就会造成循环引用的问题。我们可以通过使用 __weak 打破循环，使 block 对象对 self 弱引用。</p> <p>此时我们注意，由于 block 对 self 的引用为 weak 引用，因此有可能在执行 block 时，self 对象本身已经释放，那么我们如何保证 self 对象不在 block 内部释放呢？这就引出了下面__strong 的作用。</p> <h3 id="strong-的作用"><a href="#strong-的作用" class="header-anchor">#</a> __strong 的作用</h3> <p>简单来说，是防止 block 内部引用的外部 weak 变量被提前释放，进而在 block 内部无法获取 weak 变量以继续使用的情况；</p> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code>__weak <span class="token function">__typeof</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> weakSelf <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span>exampleBlock<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    __strong <span class="token function">__typeof</span><span class="token punctuation">(</span>weakSelf<span class="token punctuation">)</span> strongSelf <span class="token operator">=</span> weakSelf<span class="token punctuation">;</span>
    <span class="token punctuation">[</span>strongSelf exampleFunc<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这样就保证了在 block 作用域结束之前，block 内部都持有一个 strongSelf 对象可供使用。</p> <p>但是，即便如此，依然有一个场景，就是执行 __strong __typeof(weakSelf) strongSelf = weakSelf; 之前，weakSelf 对象已经释放，这时如果给 self 对象发送消息，这没有问题，Objective-C 的消息发送机制允许我们给一个 nil 对象发送消息，这不会出现问题。但如果有额外的一些操作，比如说将 self 添加到数组，这时因为 self 为 nil，程序就会 Crash。</p> <p>我们可以增加一层安全保护来解决这个问题，如：</p> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code>__weak <span class="token function">__typeof</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> weakSelf <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span>exampleBlock<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    __strong <span class="token function">__typeof</span><span class="token punctuation">(</span>weakSelf<span class="token punctuation">)</span> strongSelf <span class="token operator">=</span> weakSelf<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>strongSelf<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Add operation here</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="拓展知识"><a href="#拓展知识" class="header-anchor">#</a> 拓展知识</h2> <h3 id="思考题"><a href="#思考题" class="header-anchor">#</a> 思考题</h3> <p>Block 内修改外部 NSMutableString 、NSMutableArray 、NSMutableDictionary 对象，是否需要添加 __block 修饰？</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>NSMutableArray *mutableArray = [[NSMutableArray alloc] init];
[mutableArray addObject:@&quot;1&quot;];
void (^exampleBlock)(void) = ^{
    // block
    [mutableArray addObject:@&quot;2&quot;];
};
exampleBlock();
NSLog(@&quot;mutableArray: %@&quot;, mutableArray);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>打印日志：mutableArray: ( 1, 2 )</p> <p>答案是：不需要，因为在 block 内部，我们只是使用了对象 mutableArray 的内存地址，往其中添加内容。并没有修改其内存地址，因此不需要使用 __block 也可以正确执行。当我们只是使用局部变量的内存地址，而不是对其内存地址进行修改时，我们无需对其添加 __block ，如果添加了 __block 系统会自动创建相应的结构体，这种情况冗余且低效。</p> <h3 id="block-数据结构"><a href="#block-数据结构" class="header-anchor">#</a> Block 数据结构</h3> <p>Block 内部数据结构图如下：</p> <p><img src="https://cdn.staticaly.com/gh/214070779/picx-images-hosting@master/20230813/Screenshot-2023-08-22-at-20.39.46.72e92suy31k0.webp" alt="Screenshot-2023-08-22-at-20"></p> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code><span class="token keyword">struct</span> Block_descriptor <span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span> reserved<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>copy<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>dst<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>dispose<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> Block_layout <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>isa<span class="token punctuation">;</span>
    <span class="token keyword">int</span> flags<span class="token punctuation">;</span>
    <span class="token keyword">int</span> reserved<span class="token punctuation">;</span> 
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>invoke<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> Block_descriptor <span class="token operator">*</span>descriptor<span class="token punctuation">;</span>
    <span class="token comment">/* Imported variables. */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Block_layout 结构体成员含义如下：</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>isa: 指向所属类的指针，也就是 block 的类型</p> <p>flags: 按 bit 位表示一些 block 的附加信息，比如判断 block 类型、判断 block 引用计数、判断 block 是否需要执行辅助函数等；</p> <p>reserved: 保留变量；</p> <p>invoke: block 函数指针，指向具体的 block 实现的函数调用地址，block 内部的执行代码都在这个函数中；</p> <p>descriptor: 结构体 Block_descriptor，block 的附加描述信息，包含 copy/dispose 函数，block 的大小，保留变量；</p> <p>variables: 因为 block 有闭包性，所以可以访问 block 外部的局部变量。这些 variables 就是复制到结构体中的外部局部变量或变量的地址；</p></div> <p>Block_descriptor 结构体成员含义如下：</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>reserved: 保留变量；</p> <p>size: block 的大小；</p> <p>copy: 函数用于捕获变量并持有引用；</p> <p>dispose: 析构函数，用来释放捕获的资源；</p></div> <h2 id="总结-2"><a href="#总结-2" class="header-anchor">#</a> 总结</h2> <p>使用 Block 过程中需要我们关注的重点有 4 个：</p> <p>block 的三种类型；
block 避免引起循环引用；
block 对 auto 变量的 copy 操作；
__block、__weak、__strong 的作用；</p> <h2 id="block面试题"><a href="#block面试题" class="header-anchor">#</a> block面试题</h2> <h3 id="block和-weak修饰符的区别"><a href="#block和-weak修饰符的区别" class="header-anchor">#</a> _block和__weak修饰符的区别？</h3> <ul><li>__block不管是ARC还是MRC模式下都可以使用，可以修饰对象，还可以修饰基本数据类型。</li> <li>__weak只能在ARC模式下使用，也只能修饰对象，不能修饰基本数据类型。</li> <li>__block对象可以在block中被重新赋值，__weak不可以。</li></ul> <h3 id="block是否能修改外部变量的值"><a href="#block是否能修改外部变量的值" class="header-anchor">#</a> block是否能修改外部变量的值</h3> <p>Block不允许修改外部变量的值，这里所说的外部变量的值，指的是栈中指针的内存地址。__block 所起到的作用就是只要观察到该变量被 block 所持有，就将“外部变量”在栈中的内存地址放到了堆中。进而在block内部也可以修改外部变量的值。</p> <h3 id="block在arc跟mrc中的行为和用法有什么区别"><a href="#block在arc跟mrc中的行为和用法有什么区别" class="header-anchor">#</a> Block在ARC跟MRC中的行为和用法有什么区别？</h3> <p><strong>相同点</strong></p> <ul><li>block的本质一样, 都是函数指针</li> <li>使用__block都可以解决在block中修改外部变量的问题</li></ul> <p><strong>不同点</strong></p> <p>解决循环引用的方式不同
MRC中使用__block
ARC中使用 __weak</p> <p>block用什么属性修饰，为什么？</p> <p>在MRC中, 定义Block属性时, 应该用copy修饰</p> <p>在ARC中, 定义Block属性时, 系统会自动将其copy, 即复制到堆上. 但习惯上还是会用copy修饰</p> <p>用copy修饰的原因</p> <p>block创建时默认是创建在栈上的, 超过作用域后就会被销毁, 只有使用copy才会生成一个堆block, 在作用域外被访问</p> <h3 id="block是类吗-有哪些类型"><a href="#block是类吗-有哪些类型" class="header-anchor">#</a> block是类吗，有哪些类型?</h3> <p>block也算是个类,因为它有isa指针,block.isa的类型包括</p> <p>_NSConcreteGlobalBlock 跟全局变量一样,设置在程序的数据区域(.data)中
_NSConcreteStackBlock栈上(前面讲的都是栈上的 block)
_NSConcreteMallocBlock 堆上</p> <blockquote><p>这个isa可以按位运算</p></blockquote> <h3 id="一个int变量被-block-修饰与否的区别-block的变量截获"><a href="#一个int变量被-block-修饰与否的区别-block的变量截获" class="header-anchor">#</a> 一个int变量被 __block 修饰与否的区别？block的变量截获</h3> <p>被__block 修饰与否的区别
用一段示例代码来解答这个问题吧:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>__block int a = 10;
int b = 20;

PrintTwoIntBlock block = ^(){
    a -= 10;
    printf(&quot;%d, %d\n&quot;,a,b);
};

block();//0 20

a += 20;
b += 30;

printf(&quot;%d, %d\n&quot;,a,b);//20 50

block();/10 20
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>通过__block修饰int a,block体中对这个变量的引用是指针拷贝,它会作为block结构体构造参数传入到结构体中且复制这个变量的指针引用，从而达到可以修改变量的作用.</p> <p>int b没有被__block修饰,block内部对b是值copy.所以在block内部修改b不影响外部b的变化.</p> <h3 id="什么时候栈上的block会被复制到堆呢"><a href="#什么时候栈上的block会被复制到堆呢" class="header-anchor">#</a> 什么时候栈上的Block会被复制到堆呢？</h3> <ul><li>调用block的copy函数时。</li> <li>Block作为函数返回值返回时。</li> <li>将Block赋值给附有__strong修饰符id类型的类或者Block类型成员变量时。</li> <li>方法中含有usingBlock的Cocoa框架方法或者GCD的API中传递Block时。</li></ul> <p>什么时候Block被废弃呢？</p> <p>堆上的Block被释放后,谁都不再持有Block时调用dispose函数。</p> <h3 id="block在修改nsmutablearray-需不需要添加-block"><a href="#block在修改nsmutablearray-需不需要添加-block" class="header-anchor">#</a> block在修改NSMutableArray，需不需要添加__block</h3> <ul><li><p>如修改NSMutableArray的存储内容的话,是不需要添加__block修饰的。</p></li> <li><p>如修改NSMutableArray对象的本身,那必须添加__block修饰。</p></li></ul> <h3 id="block怎么进行内存管理的"><a href="#block怎么进行内存管理的" class="header-anchor">#</a> block怎么进行内存管理的?</h3> <p>在上面Block的构造函数__TestClass__testMethods_block_impl_0中的isa指针指向的是&amp;_NSConcreteStackBlock，它表示当前的Block位于栈区中.</p> <table><thead><tr><th>block内存操作</th> <th>存储域/存储位置</th> <th>copy操作的影响</th></tr></thead> <tbody><tr><td>_NSConcreteGlobalBlock</td> <td>程序的数据区域</td> <td>什么也不做</td></tr> <tr><td>_NSConcreteStackBlock</td> <td>栈</td> <td>从栈拷贝到堆</td></tr> <tr><td>_NSConcreteMallocBlock</td> <td>堆</td> <td>引用计数增加</td></tr></tbody></table> <ul><li><p>全局Block:_NSConcreteGlobalBlock的结构体实例设置在程序的数据存储区，所以可以在程序的任意位置通过指针来访问，它的产生条件:</p> <ul><li><p>记述全局变量的地方有block语法时.</p></li> <li><p>block不截获的自动变量.</p> <blockquote><p>以上两个条件只要满足一个就可以产生全局Block. 参考</p></blockquote></li></ul></li> <li><p>栈Block:</p></li></ul> <p>_NSConcreteStackBlock在生成Block以后，如果这个Block不是全局Block,那它就是栈Block,生命周期在其所属的变量作用域内.(也就是说如果销毁取决于所属的变量作用域).如果Block变量和__block变量复制到了堆上以后，则不再会受到变量作用域结束的影响了，因为它变成了</p> <ul><li>堆Block.</li></ul> <p>_NSConcreteMallocBlock将栈block复制到堆以后，block结构体的isa成员变量变成了_NSConcreteMallocBlock。</p> <h3 id="block可以用strong修饰吗"><a href="#block可以用strong修饰吗" class="header-anchor">#</a> block可以用strong修饰吗?</h3> <p>在ARC中可以，因为在ARC环境中的block只能在堆内存或全局内存中，因此不涉及到从栈拷贝到堆中的操作.</p> <p>在MRC中不行,因为要有拷贝过程.如果执行copy用strong的话会crash, strong是ARC中引入的关键字.如果使用retain相当于忽视了block的copy过程.</p> <h3 id="解决循环引用时为什么要用-strong、-weak修饰"><a href="#解决循环引用时为什么要用-strong、-weak修饰" class="header-anchor">#</a> 解决循环引用时为什么要用__strong、__weak修饰?</h3> <p>首先因为block捕获变量的时候 结构体构造时传入了self,造成了默认的引用关系,所以一般在block外部对操作对象会加上__weak,在Block内部使用__strong修饰符的对象类型的自动变量，那么当Block从栈复制到堆的时候，该对象就会被Block所持有,但是持有的是我们上面加了__weak所以行程了比消此长的链条,刚好能解决block延迟销毁的时候对外部对象生命周期造成的影响.如果不这样做很容易造成循环引用.</p> <h3 id="block发生copy时机"><a href="#block发生copy时机" class="header-anchor">#</a> block发生copy时机?</h3> <p>在ARC中,编译器将创建在栈中的block会自动拷贝到堆内存中,而block作为方法或函数的参数传递时,编译器不会做copy操作.</p> <ul><li>调用block的copy函数时。</li> <li>Block作为函数返回值返回时。</li> <li>将Block赋值给附有__strong修饰符id类型的类或者Block类型成员变量时。</li> <li>方法中含有usingBlock的Cocoa框架方法或者GCD的API中传递Block时。</li></ul> <h3 id="block访问对象类型的auto变量时-在arc和mrc下有什么区别"><a href="#block访问对象类型的auto变量时-在arc和mrc下有什么区别" class="header-anchor">#</a> Block访问对象类型的auto变量时，在ARC和MRC下有什么区别?</h3> <p>ARC下会对这个对象强引用，MRC下不会</p> <h2 id="block-的变量捕获机制"><a href="#block-的变量捕获机制" class="header-anchor">#</a> block 的变量捕获机制</h2> <p>block 的变量捕获机制，是为了保证 block 内部能够正常访问外部的变量。</p> <table><thead><tr><th>变量类型</th> <th>是否捕获到 block 内部</th> <th>访问方式</th></tr></thead> <tbody><tr><td>全局变量</td> <td>否</td> <td>直接访问</td></tr> <tr><td>局部变量（auto 类型）</td> <td>是</td> <td>值传递</td></tr> <tr><td>局部变量（static 类型）</td> <td>是</td> <td>指针传递</td></tr></tbody></table> <p>对于全局变量，不会捕获到 block 内部，访问方式为直接访问。作用域的原因，全局变量哪里都可以直接访问，所以不用捕获。而对于局部变量，外部不能直接访问，所以需要捕获。下面我们来看一下 block 对于局部变量的具体捕获机制。</p> <h3 id="auto-类型的局部变量"><a href="#auto-类型的局部变量" class="header-anchor">#</a> auto 类型的局部变量</h3> <p>auto 类型的局部变量（我们定义出来的变量，默认都是 auto 类型，只是省略了），block 内部会自动生成一个同类型成员变量，用来存储这个变量的值，访问方式为值传递。auto 类型的局部变量可能会销毁，其内存会消失，block 将来执行代码的时候不可能再去访问那块内存，所以捕获其值。由于是值传递，我们修改 block 外部被捕获变量的值，不会影响到 block 内部捕获的变量值。</p> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code><span class="token comment">//局部变量截获 是值截获</span>
NSInteger num <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token function">NSInteger</span><span class="token punctuation">(</span><span class="token operator">^</span>block<span class="token punctuation">)</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">^</span><span class="token function">NSInteger</span><span class="token punctuation">(</span>NSInteger n<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> n<span class="token operator">*</span>num<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%zd&quot;</span><span class="token punctuation">,</span><span class="token function">block</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//这里的输出是6而不是2，原因就是对局部变量num的截获是值截获。</span>
<span class="token comment">//同样，在block里如果修改变量num，也是无效的，甚至编译器会报错</span>
NSMutableArray <span class="token operator">*</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>NSMutableArray arrayWithObjects<span class="token punctuation">:</span><span class="token string">@&quot;1&quot;</span><span class="token punctuation">,</span><span class="token string">@&quot;2&quot;</span><span class="token punctuation">,</span> nil<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">^</span>block<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%@&quot;</span><span class="token punctuation">,</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//局部变量</span>
    <span class="token punctuation">[</span>arr addObject<span class="token punctuation">:</span><span class="token string">@&quot;4&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>arr addObject<span class="token punctuation">:</span><span class="token string">@&quot;3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arr <span class="token operator">=</span> nil<span class="token punctuation">;</span>
<span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
打印为<span class="token number">1</span>，<span class="token number">2</span>，<span class="token number">3</span>
局部对象变量也是一样，截获的是值，而不是指针，在外部将其置为nil，对block没有影响，而该对象调用方法会影响
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="static-类型的局部变量"><a href="#static-类型的局部变量" class="header-anchor">#</a> static 类型的局部变量</h3> <p>static 类型的局部变量，block 内部会自动生成一个同类型成员变量，用来存储这个变量的地址，访问方式为指针传递。static 变量会一直保存在内存中， 所以捕获其地址即可。相反，由于是指针传递，我们修改 block 外部被捕获变量的值，会影响到 block 内部捕获的变量值。</p> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code><span class="token comment">//局部静态变量截获 是指针截获。</span>
<span class="token keyword">static</span>  NSInteger num <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token function">NSInteger</span><span class="token punctuation">(</span><span class="token operator">^</span>block<span class="token punctuation">)</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">^</span><span class="token function">NSInteger</span><span class="token punctuation">(</span>NSInteger n<span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token keyword">return</span> n<span class="token operator">*</span>num<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%zd&quot;</span><span class="token punctuation">,</span><span class="token function">block</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
输出为<span class="token number">2</span>，意味着num <span class="token operator">=</span> <span class="token number">1</span>这里的修改num值是有效的，即是指针截获。
同样，在block里去修改变量m，也是有效的。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code><span class="token comment">//全局变量，静态全局变量截获：不截获,直接取值。</span>
<span class="token operator">/</span>我们同样用clang编译看下结果。
<span class="token keyword">static</span> NSInteger num3 <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
NSInteger num4 <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>blockTest
<span class="token punctuation">{</span>
    NSInteger num <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> NSInteger num2 <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    __block NSInteger num5 <span class="token operator">=</span> <span class="token number">30000</span><span class="token punctuation">;</span>
<span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">^</span>block<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%zd&quot;</span><span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//局部变量</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%zd&quot;</span><span class="token punctuation">,</span>num2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//静态变量</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%zd&quot;</span><span class="token punctuation">,</span>num3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//全局变量</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%zd&quot;</span><span class="token punctuation">,</span>num4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//全局静态变量</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;%zd&quot;</span><span class="token punctuation">,</span>num5<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//__block修饰变量</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="对象类型的局部变量"><a href="#对象类型的局部变量" class="header-anchor">#</a> 对象类型的局部变量</h3> <p>对于对象类型的局部变量，block 会连同它的所有权修饰符一起捕获。</p> <ul><li>如果 block 是在栈上，将不会对对象产生强引用</li> <li>如果 block 被拷贝到堆上，将会调用 block 内部的 copy(__funcName_block_copy_num)函数，copy 函数内部又会调用 assign(_Block_object_assign)函数，assign 函数将会根据变量的所有权修饰符做出相应的操作，形成强引用（retain）或者弱引用。</li> <li>如果 block 从堆上移除，也就是被释放的时候，会调用 block 内部的 dispose(_Block_object_dispose)函数，dispose 函数会自动释放引用的变量（release）。</li></ul> <p><strong>总结1:</strong></p> <blockquote><p>MRC 中block 没有引用外部变量, block为 NSGlobalBlock 类型,存储在全局数据区.<br>
MRC 中block 引用外部变量,block为NSStackBlock 类型,存储在栈内存中.<br>
所以, 在block所属的栈作用域外使用block时, 需要将调用copy方法将该block存储在堆区.</p></blockquote> <p><strong>总结2:</strong></p> <blockquote><p>ARC 中 没有引用外部变量, block为 NSGlobalBlock 类型,存储在全局数据区.<br>
ARC 中 引用外部变量, block为 autoreleased NSMallocBlock 类型,存储在堆内存中.</p></blockquote></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/master/docs/02.技术/05.iOS基础知识/04.Block系列/00.Block系列.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/10/23, 23:26:17</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/42c60f/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">内存管理自我总结</div></a> <a href="/pages/d367ff/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">线程系列</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/42c60f/" class="prev">内存管理自我总结</a></span> <span class="next"><a href="/pages/d367ff/">线程系列</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/1e9b25/"><div>
            排序算法
            <!----></div></a> <span class="date">10-22</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/f27637/"><div>
            学习数据结构和算法的高效方法
            <!----></div></a> <span class="date">10-19</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/39672b/"><div>
            时间复杂度跟空间复杂度
            <!----></div></a> <span class="date">10-19</span></dt></dl> <dl><dd></dd> <dt><a href="/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:yangzai2140@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/214070779" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2024
    <span>Evan Xu | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.cc55d274.js" defer></script><script src="/assets/js/2.81b2a5fe.js" defer></script><script src="/assets/js/50.d9cf5581.js" defer></script>
  </body>
</html>
