<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>iOS组件化系列 | 洋仔的博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <meta name="description" content="专心做事，用心总结">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.55beba5e.css" as="style"><link rel="preload" href="/assets/js/app.cc55d274.js" as="script"><link rel="preload" href="/assets/js/2.81b2a5fe.js" as="script"><link rel="preload" href="/assets/js/60.fdf12a20.js" as="script"><link rel="prefetch" href="/assets/js/10.fd87ea06.js"><link rel="prefetch" href="/assets/js/100.033c06ef.js"><link rel="prefetch" href="/assets/js/101.1c0e8fbb.js"><link rel="prefetch" href="/assets/js/102.820c15ea.js"><link rel="prefetch" href="/assets/js/103.1f4387c0.js"><link rel="prefetch" href="/assets/js/104.6b56fc18.js"><link rel="prefetch" href="/assets/js/105.7e174701.js"><link rel="prefetch" href="/assets/js/106.e7ed90dd.js"><link rel="prefetch" href="/assets/js/107.5dff726f.js"><link rel="prefetch" href="/assets/js/108.1b4254ab.js"><link rel="prefetch" href="/assets/js/109.db801d19.js"><link rel="prefetch" href="/assets/js/11.4cd9f768.js"><link rel="prefetch" href="/assets/js/110.51ed8450.js"><link rel="prefetch" href="/assets/js/111.1ed05a5b.js"><link rel="prefetch" href="/assets/js/112.d7f263da.js"><link rel="prefetch" href="/assets/js/113.dea11b47.js"><link rel="prefetch" href="/assets/js/114.ad6403dc.js"><link rel="prefetch" href="/assets/js/115.28cf40c7.js"><link rel="prefetch" href="/assets/js/116.02bcdc6e.js"><link rel="prefetch" href="/assets/js/117.75a9e1eb.js"><link rel="prefetch" href="/assets/js/118.03e0d0e9.js"><link rel="prefetch" href="/assets/js/119.766321d8.js"><link rel="prefetch" href="/assets/js/12.1f119179.js"><link rel="prefetch" href="/assets/js/120.4acf5e51.js"><link rel="prefetch" href="/assets/js/121.a4fcaab7.js"><link rel="prefetch" href="/assets/js/122.d2cc02cb.js"><link rel="prefetch" href="/assets/js/123.c4c3b254.js"><link rel="prefetch" href="/assets/js/124.55aefdfc.js"><link rel="prefetch" href="/assets/js/125.33021e89.js"><link rel="prefetch" href="/assets/js/126.bf744470.js"><link rel="prefetch" href="/assets/js/127.d1b1efb8.js"><link rel="prefetch" href="/assets/js/128.8c1b4252.js"><link rel="prefetch" href="/assets/js/129.ac017f9f.js"><link rel="prefetch" href="/assets/js/13.0f009df8.js"><link rel="prefetch" href="/assets/js/130.fdc573c0.js"><link rel="prefetch" href="/assets/js/131.c4f70462.js"><link rel="prefetch" href="/assets/js/132.d874068e.js"><link rel="prefetch" href="/assets/js/133.3344bf55.js"><link rel="prefetch" href="/assets/js/134.86c9bfea.js"><link rel="prefetch" href="/assets/js/135.7761e325.js"><link rel="prefetch" href="/assets/js/136.99654544.js"><link rel="prefetch" href="/assets/js/137.25867633.js"><link rel="prefetch" href="/assets/js/138.3016a91b.js"><link rel="prefetch" href="/assets/js/139.ead29e5f.js"><link rel="prefetch" href="/assets/js/14.1c908535.js"><link rel="prefetch" href="/assets/js/140.2217ee0f.js"><link rel="prefetch" href="/assets/js/141.faed4896.js"><link rel="prefetch" href="/assets/js/142.3786cfaa.js"><link rel="prefetch" href="/assets/js/143.680d45a4.js"><link rel="prefetch" href="/assets/js/144.5e0d30d9.js"><link rel="prefetch" href="/assets/js/145.a2c5cf58.js"><link rel="prefetch" href="/assets/js/146.215c3961.js"><link rel="prefetch" href="/assets/js/147.81e5dbea.js"><link rel="prefetch" href="/assets/js/148.7ef156fa.js"><link rel="prefetch" href="/assets/js/149.07344fb0.js"><link rel="prefetch" href="/assets/js/15.24686777.js"><link rel="prefetch" href="/assets/js/150.100e1276.js"><link rel="prefetch" href="/assets/js/151.5a0852bd.js"><link rel="prefetch" href="/assets/js/152.d0e587d9.js"><link rel="prefetch" href="/assets/js/153.007ec2d1.js"><link rel="prefetch" href="/assets/js/154.3178d124.js"><link rel="prefetch" href="/assets/js/155.53357b05.js"><link rel="prefetch" href="/assets/js/156.d5438e93.js"><link rel="prefetch" href="/assets/js/157.8afa8209.js"><link rel="prefetch" href="/assets/js/158.0434bf90.js"><link rel="prefetch" href="/assets/js/159.64687b5f.js"><link rel="prefetch" href="/assets/js/16.12f4db26.js"><link rel="prefetch" href="/assets/js/160.56d76ff4.js"><link rel="prefetch" href="/assets/js/161.f6414d3f.js"><link rel="prefetch" href="/assets/js/162.b9de4b51.js"><link rel="prefetch" href="/assets/js/163.07e063ef.js"><link rel="prefetch" href="/assets/js/164.3acfc294.js"><link rel="prefetch" href="/assets/js/165.66703a7d.js"><link rel="prefetch" href="/assets/js/166.cb851667.js"><link rel="prefetch" href="/assets/js/167.4098c444.js"><link rel="prefetch" href="/assets/js/168.a80d728b.js"><link rel="prefetch" href="/assets/js/169.bd937a75.js"><link rel="prefetch" href="/assets/js/17.6c77ddb7.js"><link rel="prefetch" href="/assets/js/170.e3d78c48.js"><link rel="prefetch" href="/assets/js/171.bceae2ae.js"><link rel="prefetch" href="/assets/js/172.ce9b722c.js"><link rel="prefetch" href="/assets/js/173.e47f9666.js"><link rel="prefetch" href="/assets/js/174.7997805c.js"><link rel="prefetch" href="/assets/js/175.00237921.js"><link rel="prefetch" href="/assets/js/176.0fa3c92e.js"><link rel="prefetch" href="/assets/js/177.78d4055c.js"><link rel="prefetch" href="/assets/js/178.3b9e2d49.js"><link rel="prefetch" href="/assets/js/179.ffd38cbc.js"><link rel="prefetch" href="/assets/js/18.bdd3ef44.js"><link rel="prefetch" href="/assets/js/180.ea1e7437.js"><link rel="prefetch" href="/assets/js/181.1b990f8f.js"><link rel="prefetch" href="/assets/js/182.2294fb00.js"><link rel="prefetch" href="/assets/js/183.d49c9d33.js"><link rel="prefetch" href="/assets/js/184.ad8b9900.js"><link rel="prefetch" href="/assets/js/185.da48669b.js"><link rel="prefetch" href="/assets/js/186.650a47d2.js"><link rel="prefetch" href="/assets/js/187.dc3e7f5f.js"><link rel="prefetch" href="/assets/js/188.d372ce27.js"><link rel="prefetch" href="/assets/js/189.fa1c9909.js"><link rel="prefetch" href="/assets/js/19.10c0d5b8.js"><link rel="prefetch" href="/assets/js/190.6c1b8013.js"><link rel="prefetch" href="/assets/js/191.6676590e.js"><link rel="prefetch" href="/assets/js/192.cb1953e2.js"><link rel="prefetch" href="/assets/js/193.a6ae7e91.js"><link rel="prefetch" href="/assets/js/194.2ebc2436.js"><link rel="prefetch" href="/assets/js/195.35be6114.js"><link rel="prefetch" href="/assets/js/196.b360067a.js"><link rel="prefetch" href="/assets/js/197.c0234eef.js"><link rel="prefetch" href="/assets/js/198.6231b11b.js"><link rel="prefetch" href="/assets/js/199.838ff34e.js"><link rel="prefetch" href="/assets/js/20.92725459.js"><link rel="prefetch" href="/assets/js/200.5dc57180.js"><link rel="prefetch" href="/assets/js/201.39e5421a.js"><link rel="prefetch" href="/assets/js/202.0a56fa31.js"><link rel="prefetch" href="/assets/js/203.90d6ea32.js"><link rel="prefetch" href="/assets/js/204.48311b42.js"><link rel="prefetch" href="/assets/js/205.e1f37224.js"><link rel="prefetch" href="/assets/js/206.92c38d74.js"><link rel="prefetch" href="/assets/js/207.3493f997.js"><link rel="prefetch" href="/assets/js/208.d2d00438.js"><link rel="prefetch" href="/assets/js/209.7ff3e1db.js"><link rel="prefetch" href="/assets/js/21.703ec124.js"><link rel="prefetch" href="/assets/js/210.b9e087c1.js"><link rel="prefetch" href="/assets/js/211.0b5f6ae5.js"><link rel="prefetch" href="/assets/js/212.5a5a4e85.js"><link rel="prefetch" href="/assets/js/213.ddea0aff.js"><link rel="prefetch" href="/assets/js/214.06e03126.js"><link rel="prefetch" href="/assets/js/215.99e71be9.js"><link rel="prefetch" href="/assets/js/216.5ab77662.js"><link rel="prefetch" href="/assets/js/217.5b8b2a56.js"><link rel="prefetch" href="/assets/js/218.656d4df8.js"><link rel="prefetch" href="/assets/js/219.2f9282d7.js"><link rel="prefetch" href="/assets/js/22.7832c9ca.js"><link rel="prefetch" href="/assets/js/220.05012b4c.js"><link rel="prefetch" href="/assets/js/221.150b41d4.js"><link rel="prefetch" href="/assets/js/222.18bfe57a.js"><link rel="prefetch" href="/assets/js/223.5d9b036a.js"><link rel="prefetch" href="/assets/js/224.cd5efc56.js"><link rel="prefetch" href="/assets/js/225.fe1ef215.js"><link rel="prefetch" href="/assets/js/226.b5602968.js"><link rel="prefetch" href="/assets/js/227.9f3fc228.js"><link rel="prefetch" href="/assets/js/228.a9a155dc.js"><link rel="prefetch" href="/assets/js/229.53d80ddd.js"><link rel="prefetch" href="/assets/js/23.8e2d40f9.js"><link rel="prefetch" href="/assets/js/230.4918b1a6.js"><link rel="prefetch" href="/assets/js/231.ca415abb.js"><link rel="prefetch" href="/assets/js/232.04bfb190.js"><link rel="prefetch" href="/assets/js/233.d2a40489.js"><link rel="prefetch" href="/assets/js/234.e2aacb9a.js"><link rel="prefetch" href="/assets/js/235.163536f8.js"><link rel="prefetch" href="/assets/js/236.6c845360.js"><link rel="prefetch" href="/assets/js/237.cad6b7ea.js"><link rel="prefetch" href="/assets/js/238.c802c732.js"><link rel="prefetch" href="/assets/js/239.3a5fe17c.js"><link rel="prefetch" href="/assets/js/24.4c371769.js"><link rel="prefetch" href="/assets/js/240.27f6052d.js"><link rel="prefetch" href="/assets/js/241.a631c566.js"><link rel="prefetch" href="/assets/js/242.01736d0d.js"><link rel="prefetch" href="/assets/js/243.b1af5586.js"><link rel="prefetch" href="/assets/js/244.18016cf2.js"><link rel="prefetch" href="/assets/js/245.0626c28d.js"><link rel="prefetch" href="/assets/js/246.73f699ec.js"><link rel="prefetch" href="/assets/js/247.f444bd44.js"><link rel="prefetch" href="/assets/js/248.65a80d31.js"><link rel="prefetch" href="/assets/js/249.0dd1d0d9.js"><link rel="prefetch" href="/assets/js/25.b040b00d.js"><link rel="prefetch" href="/assets/js/250.69712e0b.js"><link rel="prefetch" href="/assets/js/251.d4d3c3e2.js"><link rel="prefetch" href="/assets/js/252.6484f155.js"><link rel="prefetch" href="/assets/js/253.410f1ed5.js"><link rel="prefetch" href="/assets/js/254.e8b85c6f.js"><link rel="prefetch" href="/assets/js/255.d2df3587.js"><link rel="prefetch" href="/assets/js/256.09bb0d0e.js"><link rel="prefetch" href="/assets/js/257.71461633.js"><link rel="prefetch" href="/assets/js/258.af2f399d.js"><link rel="prefetch" href="/assets/js/259.9ec5e83b.js"><link rel="prefetch" href="/assets/js/26.a1fb922a.js"><link rel="prefetch" href="/assets/js/260.cac8239f.js"><link rel="prefetch" href="/assets/js/261.925d41ff.js"><link rel="prefetch" href="/assets/js/262.28633c4a.js"><link rel="prefetch" href="/assets/js/263.f21c004b.js"><link rel="prefetch" href="/assets/js/264.57e4ff6c.js"><link rel="prefetch" href="/assets/js/265.c962904f.js"><link rel="prefetch" href="/assets/js/266.5d28c35b.js"><link rel="prefetch" href="/assets/js/267.966d88be.js"><link rel="prefetch" href="/assets/js/268.7f072ba9.js"><link rel="prefetch" href="/assets/js/269.8a2bbc16.js"><link rel="prefetch" href="/assets/js/27.8ae4e4fd.js"><link rel="prefetch" href="/assets/js/270.c7dbb8c2.js"><link rel="prefetch" href="/assets/js/271.fd0a8147.js"><link rel="prefetch" href="/assets/js/272.39f2833e.js"><link rel="prefetch" href="/assets/js/273.5d03fdb3.js"><link rel="prefetch" href="/assets/js/274.d7cde43a.js"><link rel="prefetch" href="/assets/js/275.2b84609e.js"><link rel="prefetch" href="/assets/js/276.2ba14d83.js"><link rel="prefetch" href="/assets/js/277.bedaa21d.js"><link rel="prefetch" href="/assets/js/278.9750200e.js"><link rel="prefetch" href="/assets/js/279.54cf5084.js"><link rel="prefetch" href="/assets/js/28.7c726cfd.js"><link rel="prefetch" href="/assets/js/280.24775da3.js"><link rel="prefetch" href="/assets/js/281.f44383db.js"><link rel="prefetch" href="/assets/js/282.5dd2530b.js"><link rel="prefetch" href="/assets/js/283.60a029cc.js"><link rel="prefetch" href="/assets/js/284.80d5c684.js"><link rel="prefetch" href="/assets/js/285.2233e644.js"><link rel="prefetch" href="/assets/js/286.2e6924e4.js"><link rel="prefetch" href="/assets/js/287.52470b25.js"><link rel="prefetch" href="/assets/js/288.0c9d41ca.js"><link rel="prefetch" href="/assets/js/289.57b35055.js"><link rel="prefetch" href="/assets/js/29.5762da80.js"><link rel="prefetch" href="/assets/js/290.3765d6a5.js"><link rel="prefetch" href="/assets/js/291.6bd15b79.js"><link rel="prefetch" href="/assets/js/292.afb5a75a.js"><link rel="prefetch" href="/assets/js/293.f5759dcb.js"><link rel="prefetch" href="/assets/js/294.2209dfe5.js"><link rel="prefetch" href="/assets/js/295.f7e224d5.js"><link rel="prefetch" href="/assets/js/296.36fde749.js"><link rel="prefetch" href="/assets/js/297.df8a1239.js"><link rel="prefetch" href="/assets/js/298.d0028860.js"><link rel="prefetch" href="/assets/js/299.f44a0e98.js"><link rel="prefetch" href="/assets/js/3.1b6e43a5.js"><link rel="prefetch" href="/assets/js/30.f7bd2da9.js"><link rel="prefetch" href="/assets/js/300.e1e1e2af.js"><link rel="prefetch" href="/assets/js/301.ac068e67.js"><link rel="prefetch" href="/assets/js/302.1e2a778b.js"><link rel="prefetch" href="/assets/js/303.32c1023d.js"><link rel="prefetch" href="/assets/js/304.2bd7d59c.js"><link rel="prefetch" href="/assets/js/305.0e0b08a3.js"><link rel="prefetch" href="/assets/js/306.48947241.js"><link rel="prefetch" href="/assets/js/307.04186968.js"><link rel="prefetch" href="/assets/js/308.b6b41f7b.js"><link rel="prefetch" href="/assets/js/309.ed01b460.js"><link rel="prefetch" href="/assets/js/31.81b4a4d2.js"><link rel="prefetch" href="/assets/js/310.61ab2756.js"><link rel="prefetch" href="/assets/js/311.dfa83b75.js"><link rel="prefetch" href="/assets/js/312.21c9fcf2.js"><link rel="prefetch" href="/assets/js/313.9c7bdcf7.js"><link rel="prefetch" href="/assets/js/314.444459f4.js"><link rel="prefetch" href="/assets/js/315.01c2dddd.js"><link rel="prefetch" href="/assets/js/316.fa19412e.js"><link rel="prefetch" href="/assets/js/317.b8e81823.js"><link rel="prefetch" href="/assets/js/318.a76c19a2.js"><link rel="prefetch" href="/assets/js/319.b6d393e9.js"><link rel="prefetch" href="/assets/js/32.d9074bf8.js"><link rel="prefetch" href="/assets/js/320.b9b7d53d.js"><link rel="prefetch" href="/assets/js/321.377dc9df.js"><link rel="prefetch" href="/assets/js/322.5414100c.js"><link rel="prefetch" href="/assets/js/323.0edddb0c.js"><link rel="prefetch" href="/assets/js/324.a3c19125.js"><link rel="prefetch" href="/assets/js/325.0a931352.js"><link rel="prefetch" href="/assets/js/326.99cd4779.js"><link rel="prefetch" href="/assets/js/327.aa0bbc95.js"><link rel="prefetch" href="/assets/js/328.8d936413.js"><link rel="prefetch" href="/assets/js/329.86331300.js"><link rel="prefetch" href="/assets/js/33.61cbe880.js"><link rel="prefetch" href="/assets/js/330.2f949c81.js"><link rel="prefetch" href="/assets/js/331.27c8897b.js"><link rel="prefetch" href="/assets/js/332.2a06265f.js"><link rel="prefetch" href="/assets/js/333.5380694f.js"><link rel="prefetch" href="/assets/js/334.a4fc88c7.js"><link rel="prefetch" href="/assets/js/335.d24aa360.js"><link rel="prefetch" href="/assets/js/336.e6c27799.js"><link rel="prefetch" href="/assets/js/337.7068bfa9.js"><link rel="prefetch" href="/assets/js/338.05129acf.js"><link rel="prefetch" href="/assets/js/339.32a155e4.js"><link rel="prefetch" href="/assets/js/34.458856b1.js"><link rel="prefetch" href="/assets/js/340.79f4160c.js"><link rel="prefetch" href="/assets/js/341.1845d39d.js"><link rel="prefetch" href="/assets/js/342.e9025266.js"><link rel="prefetch" href="/assets/js/343.022762e6.js"><link rel="prefetch" href="/assets/js/344.5f6ede26.js"><link rel="prefetch" href="/assets/js/345.0f09d3e9.js"><link rel="prefetch" href="/assets/js/346.baf57bd3.js"><link rel="prefetch" href="/assets/js/347.fca5ad32.js"><link rel="prefetch" href="/assets/js/348.ee72d1c4.js"><link rel="prefetch" href="/assets/js/349.3d1973a7.js"><link rel="prefetch" href="/assets/js/35.bd72afbd.js"><link rel="prefetch" href="/assets/js/350.6c10a97f.js"><link rel="prefetch" href="/assets/js/351.2b4fcad2.js"><link rel="prefetch" href="/assets/js/352.cc2e2e46.js"><link rel="prefetch" href="/assets/js/353.93baf91c.js"><link rel="prefetch" href="/assets/js/354.ce9d0e4c.js"><link rel="prefetch" href="/assets/js/355.110b2119.js"><link rel="prefetch" href="/assets/js/356.31c1cb3f.js"><link rel="prefetch" href="/assets/js/357.fc56933d.js"><link rel="prefetch" href="/assets/js/358.3d6f0995.js"><link rel="prefetch" href="/assets/js/359.e42fb771.js"><link rel="prefetch" href="/assets/js/36.51ff5da4.js"><link rel="prefetch" href="/assets/js/360.b23f20a6.js"><link rel="prefetch" href="/assets/js/361.d40a5970.js"><link rel="prefetch" href="/assets/js/362.5526289b.js"><link rel="prefetch" href="/assets/js/363.57de68f3.js"><link rel="prefetch" href="/assets/js/364.be1cb110.js"><link rel="prefetch" href="/assets/js/365.61d49f0a.js"><link rel="prefetch" href="/assets/js/366.b507225c.js"><link rel="prefetch" href="/assets/js/367.7b1436ad.js"><link rel="prefetch" href="/assets/js/368.dcd60637.js"><link rel="prefetch" href="/assets/js/369.51c46392.js"><link rel="prefetch" href="/assets/js/37.4d7470cc.js"><link rel="prefetch" href="/assets/js/370.79f0015e.js"><link rel="prefetch" href="/assets/js/371.d8c48ef6.js"><link rel="prefetch" href="/assets/js/372.3ccfa0e9.js"><link rel="prefetch" href="/assets/js/373.6ff5c143.js"><link rel="prefetch" href="/assets/js/374.f4fcf914.js"><link rel="prefetch" href="/assets/js/375.d24d77a1.js"><link rel="prefetch" href="/assets/js/376.46fa8c82.js"><link rel="prefetch" href="/assets/js/377.dc0360fd.js"><link rel="prefetch" href="/assets/js/38.b792089b.js"><link rel="prefetch" href="/assets/js/39.65ad4770.js"><link rel="prefetch" href="/assets/js/4.86cba761.js"><link rel="prefetch" href="/assets/js/40.8b58385f.js"><link rel="prefetch" href="/assets/js/41.398e86ae.js"><link rel="prefetch" href="/assets/js/42.789f1388.js"><link rel="prefetch" href="/assets/js/43.05f9d13d.js"><link rel="prefetch" href="/assets/js/44.c2b40548.js"><link rel="prefetch" href="/assets/js/45.df48e9a2.js"><link rel="prefetch" href="/assets/js/46.b83749fb.js"><link rel="prefetch" href="/assets/js/47.7ef7d498.js"><link rel="prefetch" href="/assets/js/48.228e3df9.js"><link rel="prefetch" href="/assets/js/49.fda0dc0b.js"><link rel="prefetch" href="/assets/js/5.3a0ea465.js"><link rel="prefetch" href="/assets/js/50.d9cf5581.js"><link rel="prefetch" href="/assets/js/51.3096a574.js"><link rel="prefetch" href="/assets/js/52.479127e5.js"><link rel="prefetch" href="/assets/js/53.5e0b1963.js"><link rel="prefetch" href="/assets/js/54.59740785.js"><link rel="prefetch" href="/assets/js/55.3b7f709a.js"><link rel="prefetch" href="/assets/js/56.54492258.js"><link rel="prefetch" href="/assets/js/57.35db8f10.js"><link rel="prefetch" href="/assets/js/58.4de20d90.js"><link rel="prefetch" href="/assets/js/59.63dfef23.js"><link rel="prefetch" href="/assets/js/6.5a97029d.js"><link rel="prefetch" href="/assets/js/61.fe3f97d3.js"><link rel="prefetch" href="/assets/js/62.f1b0daf7.js"><link rel="prefetch" href="/assets/js/63.93837b5d.js"><link rel="prefetch" href="/assets/js/64.97a1fe26.js"><link rel="prefetch" href="/assets/js/65.70f35686.js"><link rel="prefetch" href="/assets/js/66.3ba3c686.js"><link rel="prefetch" href="/assets/js/67.14cef3f2.js"><link rel="prefetch" href="/assets/js/68.e8a147f5.js"><link rel="prefetch" href="/assets/js/69.24e88bd2.js"><link rel="prefetch" href="/assets/js/7.ce6c36f3.js"><link rel="prefetch" href="/assets/js/70.15818cd2.js"><link rel="prefetch" href="/assets/js/71.119594cc.js"><link rel="prefetch" href="/assets/js/72.9fcbbf86.js"><link rel="prefetch" href="/assets/js/73.b82c6339.js"><link rel="prefetch" href="/assets/js/74.32848a73.js"><link rel="prefetch" href="/assets/js/75.6efef423.js"><link rel="prefetch" href="/assets/js/76.17ea6bee.js"><link rel="prefetch" href="/assets/js/77.220ac10b.js"><link rel="prefetch" href="/assets/js/78.a880b44d.js"><link rel="prefetch" href="/assets/js/79.217ab01c.js"><link rel="prefetch" href="/assets/js/8.cbd97eba.js"><link rel="prefetch" href="/assets/js/80.2e717400.js"><link rel="prefetch" href="/assets/js/81.b7277c4e.js"><link rel="prefetch" href="/assets/js/82.8e22a60c.js"><link rel="prefetch" href="/assets/js/83.c39494a6.js"><link rel="prefetch" href="/assets/js/84.e379d0cd.js"><link rel="prefetch" href="/assets/js/85.3f7d9716.js"><link rel="prefetch" href="/assets/js/86.a7c0bd99.js"><link rel="prefetch" href="/assets/js/87.eb9b0263.js"><link rel="prefetch" href="/assets/js/88.32d31cd7.js"><link rel="prefetch" href="/assets/js/89.cb0eb0c6.js"><link rel="prefetch" href="/assets/js/9.e79b9220.js"><link rel="prefetch" href="/assets/js/90.2aa9f60f.js"><link rel="prefetch" href="/assets/js/91.979af91d.js"><link rel="prefetch" href="/assets/js/92.ecca824d.js"><link rel="prefetch" href="/assets/js/93.70a3d5ac.js"><link rel="prefetch" href="/assets/js/94.c163ecdc.js"><link rel="prefetch" href="/assets/js/95.d5eb2ea5.js"><link rel="prefetch" href="/assets/js/96.d596f924.js"><link rel="prefetch" href="/assets/js/97.fde076d3.js"><link rel="prefetch" href="/assets/js/98.1189bd76.js"><link rel="prefetch" href="/assets/js/99.9e004fea.js">
    <link rel="stylesheet" href="/assets/css/0.styles.55beba5e.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="洋仔的博客" class="logo"> <span class="site-name can-hide">洋仔的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人心法" class="dropdown-title"><a href="/person/" class="link-title">个人心法</a> <span class="title" style="display:none;">个人心法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>个人心法总结</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fe3f91/" class="nav-link">价值心法</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/pages/d13cac/" class="nav-link">iOS基础知识</a></li><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">前端</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/more/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/15d3d8/" class="nav-link">投资体系</a></li><li class="dropdown-item"><!----> <a href="/pages/4db018/" class="nav-link">毛选</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/214070779/publicPicture@master/pingtou.5ytkqlpmd940.webp"> <div class="blogger-info"><h3>洋仔</h3> <span>奋斗的小青年</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人心法" class="dropdown-title"><a href="/person/" class="link-title">个人心法</a> <span class="title" style="display:none;">个人心法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>个人心法总结</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fe3f91/" class="nav-link">价值心法</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/pages/d13cac/" class="nav-link">iOS基础知识</a></li><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">前端</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/more/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/15d3d8/" class="nav-link">投资体系</a></li><li class="dropdown-item"><!----> <a href="/pages/4db018/" class="nav-link">毛选</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术文档</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GitHub技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>博客搭建</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>iOS基础知识</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>iOS底层相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Runloop系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Runtime系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>内存管理系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Block系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>线程系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>KVC跟KVO系列以及通知中心</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>UI系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>离屏渲染系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>组件化系列跟架构</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/f2a247/" aria-current="page" class="active sidebar-link">iOS组件化系列</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/f2a247/#url-scheme路由" class="sidebar-link">URL Scheme路由</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/f2a247/#mgjrouter" class="sidebar-link">MGJRouter</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/f2a247/#target-action" class="sidebar-link">Target - Action</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/f2a247/#ctmediator" class="sidebar-link">CTMediator</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/f2a247/#protocol-class" class="sidebar-link">protocol-class</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/f2a247/#protocol-class简单示例" class="sidebar-link">Protocol - Class简单示例</a></li><li class="sidebar-sub-header level3"><a href="/pages/f2a247/#beehive" class="sidebar-link">BeeHive</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/f2a247/#组件化架构实践规范和原则" class="sidebar-link">组件化架构实践规范和原则</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/f2a247/#组建拆分原则" class="sidebar-link">组建拆分原则</a></li><li class="sidebar-sub-header level3"><a href="/pages/f2a247/#基础-业务组件拆分原则" class="sidebar-link">基础/业务组件拆分原则</a></li></ul></li></ul></li><li><a href="/pages/b14b84/" class="sidebar-link">MVVM、MVC、MVP</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>OC跟webview交互系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>持久化系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>APP编译系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>APP性能优化系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>cocoapods系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>swift系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Git系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>网络相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>三方库系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>系统原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>总结系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>算法系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>数据结构系列</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/ui/#技术" data-v-06225672>技术</a></li><li data-v-06225672><a href="/ui/#iOS基础知识" data-v-06225672>iOS基础知识</a></li><li data-v-06225672><a href="/ui/#组件化系列跟架构" data-v-06225672>组件化系列跟架构</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/214070779" target="_blank" title="作者" class="beLink" data-v-06225672>洋仔</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-08-12</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">iOS组件化系列<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="常用的三种组件化通讯方案"><a href="#常用的三种组件化通讯方案" class="header-anchor">#</a> 常⽤的三种组件化通讯方案</h1> <p>组件化通信方案
组件化最重要的是兄弟模块的通讯
常⽤的三种方案</p> <ul><li>URL Scheme</li> <li>Target - Action</li> <li>Protocol - Class 匹配</li></ul> <h2 id="url-scheme路由"><a href="#url-scheme路由" class="header-anchor">#</a> URL Scheme路由</h2> <ul><li>使 URL 处理本地的跳转</li> <li>通过中间层进⾏注册 &amp; 调⽤ （load方法里把被调用者注册到中间层）</li> <li>注册表⽆需使用反射</li> <li>非懒加载 / 注册表的维护 / 参数</li></ul> <details class="custom-block details"><summary>点击查看</summary> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//MTMediator.h --- start</span>
typedef <span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">^</span>MTMediatorProcessBlock<span class="token punctuation">)</span><span class="token punctuation">(</span>NSDictionary <span class="token operator">*</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>registerScheme<span class="token operator">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>scheme processBlock<span class="token operator">:</span><span class="token punctuation">(</span>MTMediatorProcessBlock<span class="token punctuation">)</span>processBlock<span class="token punctuation">;</span>

<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>openUrl<span class="token operator">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>url params<span class="token operator">:</span><span class="token punctuation">(</span>NSDictionary <span class="token operator">*</span><span class="token punctuation">)</span>params<span class="token punctuation">;</span>
<span class="token comment">//MTMediator.h --- end</span>

<span class="token comment">//MTMediator.m --- start</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>NSMutableDictionary <span class="token operator">*</span><span class="token punctuation">)</span>mediatorCache<span class="token punctuation">{</span>
    <span class="token keyword">static</span> NSMutableDictionary <span class="token operator">*</span>cacheScheme<span class="token punctuation">;</span>
    <span class="token keyword">static</span> dispatch_once_t onceToken<span class="token punctuation">;</span>
    <span class="token function">dispatch_once</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>onceToken<span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
        cacheScheme <span class="token operator">=</span> @<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span>mutableCopy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> cacheScheme<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>registerScheme<span class="token operator">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>scheme processBlock<span class="token operator">:</span><span class="token punctuation">(</span>MTMediatorProcessBlock<span class="token punctuation">)</span>processBlock<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>scheme<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> processBlock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span>self <span class="token keyword">class</span><span class="token punctuation">]</span> mediatorCache<span class="token punctuation">]</span> setObject<span class="token operator">:</span>processBlock forKey<span class="token operator">:</span>scheme<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>openUrl<span class="token operator">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>url params<span class="token operator">:</span><span class="token punctuation">(</span>NSDictionary <span class="token operator">*</span><span class="token punctuation">)</span>params<span class="token punctuation">{</span>
    MTMediatorProcessBlock block <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span>self <span class="token keyword">class</span><span class="token punctuation">]</span> mediatorCache<span class="token punctuation">]</span> objectForKey<span class="token operator">:</span>url<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">block</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//MTMediator.m --- end</span>

<span class="token comment">//注册 --- start</span>
<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>load <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>MTMediator registerScheme<span class="token operator">:</span>@<span class="token string">&quot;detail://&quot;</span> <span class="token literal-property property">processBlock</span><span class="token operator">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSDictionary <span class="token operator">*</span> _Nonnull params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        NSString <span class="token operator">*</span>url <span class="token operator">=</span> <span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">[</span>params objectForKey<span class="token operator">:</span>@<span class="token string">&quot;url&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        UINavigationController <span class="token operator">*</span>navigationController <span class="token operator">=</span> <span class="token punctuation">(</span>UINavigationController <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">[</span>params objectForKey<span class="token operator">:</span>@<span class="token string">&quot;controller&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        MTDetailViewController <span class="token operator">*</span>controller <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>MTDetailViewController alloc<span class="token punctuation">]</span> initWithUrlString<span class="token operator">:</span>url<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//        controller.title = [NSString stringWithFormat:@&quot;%@&quot;, @(indexPath.row)];</span>
        <span class="token punctuation">[</span>navigationController pushViewController<span class="token operator">:</span>controller animated<span class="token operator">:</span><span class="token constant">YES</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//注册 --- end</span>

<span class="token comment">//调用 --- start</span>
<span class="token comment">//URL Scheme</span>
<span class="token punctuation">[</span>MTMediator openUrl<span class="token operator">:</span>@<span class="token string">&quot;detail://&quot;</span> <span class="token literal-property property">params</span><span class="token operator">:</span>@<span class="token punctuation">{</span>@<span class="token string">&quot;url&quot;</span><span class="token operator">:</span>item<span class="token punctuation">.</span>articleUrl<span class="token punctuation">,</span>@<span class="token string">&quot;controller&quot;</span><span class="token operator">:</span>self<span class="token punctuation">.</span>navigationController<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//调用 --- end</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div></details> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>说明：</p> <p>参考了系统URL Scheme机制
参数传递通过dictionary，对调用者不透明</p></div> <p>目前iOS上大部分路由工具都是基于URL匹配的，或者是根据命名约定，用runtime方法进行动态调用</p> <p>这些动态化的方案的优点是实现简单，缺点是需要维护字符串表，或者依赖于命名约定，无法在编译时暴露出所有问题，需要在运行时才能发现错误。</p> <h3 id="mgjrouter"><a href="#mgjrouter" class="header-anchor">#</a> MGJRouter</h3> <p>URL路由方式主要是以蘑菇街为代表的的
<a href="https://github.com/821385843/MGJRouter_Swift.git" target="_blank" rel="noopener noreferrer">MGJRouter-swift<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://github.com/lyujunwei/MGJRouter.git" target="_blank" rel="noopener noreferrer">MGJRoute-oc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
其实现思路是：</p> <p>App启动时实例化各组件模块，然后这些组件向ModuleManager注册Url，有些时候不需要实例化，使用class注册
当组件A需要调用组件B时，向ModuleManager传递URL，参数跟随URL以GET方式传递，类似openURL。然后由ModuleManager负责调度组件B，最后完成任务。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 1、注册某个URL
MGJRouter.registerURLPattern(&quot;app://home&quot;) { (info) in
    print(&quot;info: (info)&quot;)
}

//2、调用路由
MGJRouter.openURL(&quot;app://home&quot;)

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="url-路由的优点"><a href="#url-路由的优点" class="header-anchor">#</a> URL 路由的优点</h4> <ul><li>极高的动态性，适合经常开展运营活动的app，例如电商</li> <li>方便地统一管理多平台的路由规则</li> <li>易于适配URL Scheme</li></ul> <h4 id="url-路由的缺点"><a href="#url-路由的缺点" class="header-anchor">#</a> URl 路由的缺点</h4> <ul><li>传参方式有限，并且无法利用编译器进行参数类型检查，因此所有的参数都是通过字符串转换而来</li> <li>只适用于界面模块，不适用于通用模块</li> <li>参数的格式不明确，是个灵活的 dictionary，也需要有个地方可以查参数格式。</li> <li>不支持storyboard</li> <li>依赖于字符串硬编码，难以管理，蘑菇街做了个后台专门管理。</li> <li>无法保证所使用的的模块一定存在</li> <li>解耦能力有限，url 的”注册”、”实现”、”使用”必须用相同的字符规则，一旦任何一方做出修改都会导致其他方的代码失效，并且重构难度大</li></ul> <h2 id="target-action"><a href="#target-action" class="header-anchor">#</a> Target - Action</h2> <ul><li>抽离业务逻辑</li> <li>通过中间层进行调⽤</li> <li>中间层使⽤ runtime 反射</li> <li>中间层代码优化</li></ul> <details class="custom-block details"><summary>点击查看</summary> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//MTMediator.h</span>
#<span class="token keyword">import</span> <span class="token operator">&lt;</span>UIKit<span class="token operator">/</span>UIKit<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
#<span class="token keyword">import</span> <span class="token operator">&lt;</span>Foundation<span class="token operator">/</span>Foundation<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>

<span class="token constant">NS_ASSUME_NONNULL_BEGIN</span>

@<span class="token keyword">interface</span> <span class="token class-name">MTMediator</span> <span class="token operator">:</span> NSObject

<span class="token comment">//target action</span>
<span class="token operator">+</span> <span class="token punctuation">(</span> __kindof UIViewController <span class="token operator">*</span><span class="token punctuation">)</span>detailViewControllerWithUrl<span class="token operator">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>detailUrl<span class="token punctuation">;</span>

@end

<span class="token constant">NS_ASSUME_NONNULL_END</span>

<span class="token comment">//MTMediator.m</span>
#<span class="token keyword">import</span> <span class="token string">&quot;MTMediator.h&quot;</span>

@implementation MTMediator

<span class="token operator">+</span> <span class="token punctuation">(</span> __kindof UIViewController <span class="token operator">*</span><span class="token punctuation">)</span>detailViewControllerWithUrl<span class="token operator">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>detailUrl<span class="token punctuation">{</span>
    Class detailVC <span class="token operator">=</span> <span class="token function">NSClassFromString</span><span class="token punctuation">(</span>@<span class="token string">&quot;MTDetailViewController&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    UIViewController <span class="token operator">*</span>controller <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>detailVC alloc<span class="token punctuation">]</span> performSelector<span class="token operator">:</span><span class="token function">NSSelectorFromString</span><span class="token punctuation">(</span>@<span class="token string">&quot;initWithUrlString:&quot;</span><span class="token punctuation">)</span> withObject<span class="token operator">:</span>detailUrl<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> controller<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@end

<span class="token comment">//调用 </span>
<span class="token comment">//Target - Action</span>
 UIViewController <span class="token operator">*</span>vc <span class="token operator">=</span> <span class="token punctuation">[</span>MTMediator detailViewControllerWithUrl<span class="token operator">:</span>item<span class="token punctuation">.</span>articleUrl<span class="token punctuation">]</span><span class="token punctuation">;</span>
 vc<span class="token punctuation">.</span>title <span class="token operator">=</span> @<span class="token string">&quot;详情啊&quot;</span><span class="token punctuation">;</span>
 <span class="token punctuation">[</span>self<span class="token punctuation">.</span>navigationController pushViewController<span class="token operator">:</span>vc animated<span class="token operator">:</span><span class="token constant">YES</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 
说明：

硬编码方式（直接调用，不利于维护和扩展）
perform 最多能传递<span class="token number">2</span>个参数，可以传入字典避免参数过多 
<span class="token operator">-</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>performSelector<span class="token operator">:</span><span class="token punctuation">(</span><span class="token constant">SEL</span><span class="token punctuation">)</span>aSelector withObject<span class="token operator">:</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>object1 withObject<span class="token operator">:</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>object2<span class="token punctuation">;</span> 
<span class="token literal-property property">initWithUrlString</span><span class="token operator">:</span>方法必须实现 否则找不到sel崩溃
业务逻辑柔合在Mediator中，可以各个模块写各自的MTMediator扩展


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div></details> <h3 id="ctmediator"><a href="#ctmediator" class="header-anchor">#</a> CTMediator</h3> <p>三方框架其主要的代表框架是casatwy的<a href="https://github.com/casatwy/CTMediator.git" target="_blank" rel="noopener noreferrer">CTMediator<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
这个方案是基于OC的runtime、category特性动态获取模块，例如通过NSClassFromString获取类并创建实例，通过performSelector + NSInvocation动态调用方法</p> <p>其实现思路是：</p> <ol><li>利用分类为路由添加新接口，在接口中通过字符串获取对应的类</li> <li>通过runtime创建实例，动态调用实例的方法</li></ol> <p>CTMediator简单使用：</p> <details class="custom-block details"><summary>点击查看</summary> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token comment">//******* 1、分类定义新接口</span>
<span class="token keyword">extension</span> <span class="token class-name">CTMediator</span><span class="token punctuation">{</span>
    <span class="token attribute atrule">@objc</span> <span class="token keyword">func</span> <span class="token function-definition function">A_showHome</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token class-name">UIViewController</span><span class="token operator">?</span><span class="token punctuation">{</span>
    
        <span class="token comment">//在swift中使用时，需要传入对应项目的target名称，否则会找不到视图控制器</span>
        <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token constant">kCTMediatorParamsKeySwiftTargetModuleName</span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;CJLBase_Example&quot;</span></span>
        <span class="token punctuation">]</span>
        <span class="token comment">//CTMediator提供的performTarget:action:params:shouldCacheTarget:方法 通过传入name，找到对应的targer和action</span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> vc <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">performTarget</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;A&quot;</span></span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">&quot;Extension_HomeViewController&quot;</span></span><span class="token punctuation">,</span> params<span class="token punctuation">:</span> params<span class="token punctuation">,</span> shouldCacheTarget<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">UIViewController</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> vc
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token nil constant">nil</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//******* 2、模块提供者提供target-action的调用方式（对外需要加上public关键字）</span>
<span class="token keyword">class</span> <span class="token class-name">Target_A</span><span class="token punctuation">:</span> <span class="token class-name">NSObject</span> <span class="token punctuation">{</span>
    
    <span class="token attribute atrule">@objc</span> <span class="token keyword">func</span> <span class="token function-definition function">Action_Extension_HomeViewController</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> params<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token class-name">UIViewController</span><span class="token punctuation">{</span>
         
        <span class="token keyword">let</span> home <span class="token operator">=</span> <span class="token class-name">HomeViewController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> home
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">//******* 3、使用</span>
<span class="token keyword">if</span> <span class="token keyword">let</span> vc <span class="token operator">=</span> <span class="token class-name">CTMediator</span><span class="token punctuation">.</span><span class="token function">sharedInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token class-name">A_showHome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>navigationController<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">pushViewController</span><span class="token punctuation">(</span>vc<span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></details> <p>其模块间的引用关系如下图所示：</p> <p><img src="https://cdn.staticaly.com/gh/214070779/picx-images-hosting@master/20230813/Screenshot-2023-08-27-at-08.49.42.4fdiiebab440.webp" alt="Screenshot-2023-08-27-at-08"></p> <h4 id="优点"><a href="#优点" class="header-anchor">#</a> 优点</h4> <ul><li>利用 分类 可以明确声明接口，进行编译检查</li> <li>实现方式轻量</li></ul> <h4 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点</h4> <ul><li>需要在mediator 和 target中重新添加每一个接口，模块化时代码较为繁琐</li> <li>在 category 中仍然引入了字符串硬编码，内部使用字典传参，一定程度上也存在和 URL 路由相同的问题</li> <li>无法保证使用的模块一定存在，target在修改后，使用者只能在运行时才能发现错误</li> <li>可能会创建过多的 target 类</li></ul> <h4 id="ctmediator源码分析"><a href="#ctmediator源码分析" class="header-anchor">#</a> CTMediator源码分析</h4> <p>通过上面CTMediator简单示例的分类所调用的performTarget来到CTMediator中的具体实现，即performTarget:action:params:shouldCacheTarget:，主要是通过传入的name，找到对应的target 和 action</p> <details class="custom-block details"><summary>点击查看</summary> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token operator">-</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>performTarget<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">)</span>targetName action<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">)</span>actionName params<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token class-name">NSDictionary</span> <span class="token operator">*</span><span class="token punctuation">)</span>params shouldCacheTarget<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token constant">BOOL</span><span class="token punctuation">)</span>shouldCacheTarget
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>targetName <span class="token operator">==</span> <span class="token nil constant">nil</span> <span class="token operator">||</span> actionName <span class="token operator">==</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token nil constant">nil</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//在swift中使用时，需要传入对应项目的target名称，否则会找不到视图控制器</span>
    <span class="token class-name">NSString</span> <span class="token operator">*</span>swiftModuleName <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token constant">kCTMediatorParamsKeySwiftTargetModuleName</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token comment">// generate target 生成target</span>
    <span class="token class-name">NSString</span> <span class="token operator">*</span>targetClassString <span class="token operator">=</span> <span class="token nil constant">nil</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>swiftModuleName<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//swift中target文件名拼接</span>
        targetClassString <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">NSString</span> stringWithFormat<span class="token punctuation">:</span>@<span class="token string-literal"><span class="token string">&quot;%@.Target_%@&quot;</span></span><span class="token punctuation">,</span> swiftModuleName<span class="token punctuation">,</span> targetName<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//OC中target文件名拼接</span>
        targetClassString <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">NSString</span> stringWithFormat<span class="token punctuation">:</span>@<span class="token string-literal"><span class="token string">&quot;Target_%@&quot;</span></span><span class="token punctuation">,</span> targetName<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//缓存中查找target</span>
    <span class="token class-name">NSObject</span> <span class="token operator">*</span>target <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span> safeFetchCachedTarget<span class="token punctuation">:</span>targetClassString<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//缓存中没有target</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">==</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//通过字符串获取对应的类</span>
        <span class="token class-name">Class</span> targetClass <span class="token operator">=</span> <span class="token class-name">NSClassFromString</span><span class="token punctuation">(</span>targetClassString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建实例</span>
        target <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>targetClass alloc<span class="token punctuation">]</span> <span class="token keyword">init</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// generate action 生成action方法名称</span>
    <span class="token class-name">NSString</span> <span class="token operator">*</span>actionString <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">NSString</span> stringWithFormat<span class="token punctuation">:</span>@<span class="token string-literal"><span class="token string">&quot;Action_%@:&quot;</span></span><span class="token punctuation">,</span> actionName<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//通过方法名字符串获取对应的sel</span>
    <span class="token constant">SEL</span> action <span class="token operator">=</span> <span class="token class-name">NSSelectorFromString</span><span class="token punctuation">(</span>actionString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">==</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这里是处理无响应请求的地方之一，这个demo做得比较简单，如果没有可以响应的target，就直接return了。实际开发过程中是可以事先给一个固定的target专门用于在这个时候顶上，然后处理这种请求的</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> <span class="token class-name">NoTargetActionResponseWithTargetString</span><span class="token punctuation">:</span>targetClassString selectorString<span class="token punctuation">:</span>actionString originParams<span class="token punctuation">:</span>params<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token nil constant">nil</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//是否需要缓存</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldCacheTarget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> safeSetCachedTarget<span class="token punctuation">:</span>target key<span class="token punctuation">:</span>targetClassString<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//是否响应sel</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>target respondsToSelector<span class="token punctuation">:</span>action<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//动态调用方法</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">self</span> safePerformAction<span class="token punctuation">:</span>action target<span class="token punctuation">:</span>target params<span class="token punctuation">:</span>params<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这里是处理无响应请求的地方，如果无响应，则尝试调用对应target的notFound方法统一处理</span>
        <span class="token constant">SEL</span> action <span class="token operator">=</span> <span class="token class-name">NSSelectorFromString</span><span class="token punctuation">(</span>@<span class="token string-literal"><span class="token string">&quot;notFound:&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>target respondsToSelector<span class="token punctuation">:</span>action<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">self</span> safePerformAction<span class="token punctuation">:</span>action target<span class="token punctuation">:</span>target params<span class="token punctuation">:</span>params<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 这里也是处理无响应请求的地方，在notFound都没有的时候，这个demo是直接return了。实际开发过程中，可以用前面提到的固定的target顶上的。</span>
            <span class="token punctuation">[</span><span class="token keyword">self</span> <span class="token class-name">NoTargetActionResponseWithTargetString</span><span class="token punctuation">:</span>targetClassString selectorString<span class="token punctuation">:</span>actionString originParams<span class="token punctuation">:</span>params<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token attribute atrule">@synchronized</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>cachedTarget removeObjectForKey<span class="token punctuation">:</span>targetClassString<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token nil constant">nil</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 进入safePerformAction:target:params:实现，主要是通过invocation进行参数传递+消息转发</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>safePerformAction<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token constant">SEL</span><span class="token punctuation">)</span>action target<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token class-name">NSObject</span> <span class="token operator">*</span><span class="token punctuation">)</span>target params<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token class-name">NSDictionary</span> <span class="token operator">*</span><span class="token punctuation">)</span>params
<span class="token punctuation">{</span>
    <span class="token comment">//获取方法签名</span>
    <span class="token class-name">NSMethodSignature</span><span class="token operator">*</span> methodSig <span class="token operator">=</span> <span class="token punctuation">[</span>target methodSignatureForSelector<span class="token punctuation">:</span>action<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>methodSig <span class="token operator">==</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token nil constant">nil</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//获取方法签名中的返回类型，然后根据返回值完成参数传递</span>
    const char<span class="token operator">*</span> retType <span class="token operator">=</span> <span class="token punctuation">[</span>methodSig methodReturnType<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//void类型</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>retType<span class="token punctuation">,</span> <span class="token attribute atrule">@encode</span><span class="token punctuation">(</span>void<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//...省略其他类型的判断</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div></details> <h2 id="protocol-class"><a href="#protocol-class" class="header-anchor">#</a> protocol-class</h2> <ul><li>增加 Protocol Wrapper层 （中间件先注册Protocol和Class对应关系，将protocol和对应的类进行字典匹配）</li> <li>中间件返回 Protocol 对应的 Class，然后动态创建实例</li> <li>解决硬编码的问题</li></ul> <h3 id="protocol-class简单示例"><a href="#protocol-class简单示例" class="header-anchor">#</a> Protocol - Class简单示例</h3> <details class="custom-block details"><summary>点击查看</summary> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token comment">//具体的Protocol</span>
<span class="token comment">//MTMediator.h --- start</span>
<span class="token attribute atrule">@protocol</span> <span class="token class-name">MTDetailViewControllerProtocol</span> <span class="token operator">&lt;</span><span class="token class-name">NSObject</span><span class="token operator">&gt;</span>

<span class="token operator">+</span> <span class="token punctuation">(</span>__kindof <span class="token class-name">UIViewController</span> <span class="token operator">*</span><span class="token punctuation">)</span>detailViewControllerWithUrl<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">)</span>detailUrl<span class="token punctuation">;</span>

<span class="token attribute atrule">@end</span>

<span class="token attribute atrule">@interface</span> <span class="token class-name">MTMediator</span> <span class="token punctuation">:</span> <span class="token class-name">NSObject</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>registerProtol<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">Protocol</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">protocol</span> <span class="token keyword">class</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">)</span>cls<span class="token punctuation">;</span>
<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">)</span>classForProtocol<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">Protocol</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">protocol</span><span class="token punctuation">;</span>
<span class="token attribute atrule">@end</span>
<span class="token comment">//MTMediator.h --- end</span>

<span class="token comment">//MTMediator.m --- start</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>registerProtol<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">Protocol</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">protocol</span> <span class="token keyword">class</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">)</span>cls<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">protocol</span> <span class="token operator">&amp;&amp;</span> cls<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">self</span> <span class="token keyword">class</span><span class="token punctuation">]</span> mediatorCache<span class="token punctuation">]</span> setObject<span class="token punctuation">:</span>cls forKey<span class="token punctuation">:</span><span class="token class-name">NSStringFromProtocol</span><span class="token punctuation">(</span><span class="token keyword">protocol</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">)</span>classForProtocol<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">Protocol</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">protocol</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">self</span> <span class="token keyword">class</span><span class="token punctuation">]</span> mediatorCache<span class="token punctuation">]</span> objectForKey<span class="token punctuation">:</span><span class="token class-name">NSStringFromProtocol</span><span class="token punctuation">(</span><span class="token keyword">protocol</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//MTMediator.m --- end</span>

<span class="token comment">//被调用</span>
<span class="token comment">//MTDetailViewController.h --- start</span>
<span class="token attribute atrule">@protocol</span> <span class="token class-name">MTDetailViewControllerProtocol</span><span class="token punctuation">;</span>

<span class="token attribute atrule">@interface</span> <span class="token class-name">MTDetailViewController</span> <span class="token punctuation">:</span> <span class="token class-name">UIViewController</span><span class="token operator">&lt;</span><span class="token class-name">MTDetailViewControllerProtocol</span><span class="token operator">&gt;</span>
<span class="token attribute atrule">@end</span>
<span class="token comment">//MTDetailViewController.h --- end</span>

<span class="token comment">//MTDetailViewController.m --- start</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>load <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token class-name">MTMediator</span> registerProtol<span class="token punctuation">:</span> <span class="token attribute atrule">@protocol</span><span class="token punctuation">(</span><span class="token class-name">MTDetailViewControllerProtocol</span><span class="token punctuation">)</span> <span class="token keyword">class</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token keyword">self</span> <span class="token keyword">class</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token other-directive property">#pragma</span> mark <span class="token operator">-</span> <span class="token class-name">MTDetailViewControllerProtocol</span>
<span class="token operator">+</span> <span class="token punctuation">(</span> __kindof <span class="token class-name">UIViewController</span> <span class="token operator">*</span><span class="token punctuation">)</span>detailViewControllerWithUrl<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">)</span>detailUrl<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">MTDetailViewController</span> alloc<span class="token punctuation">]</span>initWithUrlString<span class="token punctuation">:</span>detailUrl<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//MTDetailViewController.m --- end</span>

<span class="token comment">//调用</span>
<span class="token class-name">Class</span> cls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">MTMediator</span> classForProtocol<span class="token punctuation">:</span> <span class="token attribute atrule">@protocol</span><span class="token punctuation">(</span><span class="token class-name">MTDetailViewControllerProtocol</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>cls respondsToSelector<span class="token punctuation">:</span> <span class="token attribute atrule">@selector</span><span class="token punctuation">(</span>detailViewControllerWithUrl<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>navigationController pushViewController<span class="token punctuation">:</span><span class="token punctuation">[</span>cls detailViewControllerWithUrl<span class="token punctuation">:</span>item<span class="token punctuation">.</span>articleUrl<span class="token punctuation">]</span> animated<span class="token punctuation">:</span><span class="token constant">YES</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//说明：被调用者先在中间件注册Protocol和Class对应关系，对外只暴漏Protocol</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div></details> <h3 id="beehive"><a href="#beehive" class="header-anchor">#</a> BeeHive</h3> <p>protocol比较典型的三方框架就是阿里的<a href="https://github.com/alibaba/BeeHive.git" target="_blank" rel="noopener noreferrer">BeeHive<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。BeeHive借鉴了Spring Service、Apache DSO的架构理念，采用AOP+扩展App生命周期API形式，将业务功能、基础功能模块以模块方式以解决大型应用中的复杂问题，并让模块之间以Service形式调用，将复杂问题切分，以AOP方式模块化服务。</p> <p>BeeHive 核心思想</p> <ol><li>各个模块间调用从直接调用对应模块，变成调用Service的形式，避免了直接依赖。</li> <li>App生命周期的分发，将耦合在AppDelegate中逻辑拆分，每个模块以微应用的形式独立存在。</li></ol> <p>示例如下:</p> <details class="custom-block details"><summary>点击查看</summary> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token comment">//******** 1、注册</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">BeeHive</span> shareInstance<span class="token punctuation">]</span> registerService<span class="token punctuation">:</span><span class="token attribute atrule">@protocol</span><span class="token punctuation">(</span><span class="token class-name">HomeServiceProtocol</span><span class="token punctuation">)</span> service<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token class-name">BHViewController</span> <span class="token keyword">class</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//******** 2、使用</span>
<span class="token other-directive property">#import</span> <span class="token string-literal"><span class="token string">&quot;BHService.h&quot;</span></span>

id<span class="token operator">&lt;</span> <span class="token class-name">HomeServiceProtocol</span> <span class="token operator">&gt;</span> homeVc <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">BeeHive</span> shareInstance<span class="token punctuation">]</span> createService<span class="token punctuation">:</span><span class="token attribute atrule">@protocol</span><span class="token punctuation">(</span><span class="token class-name">HomeServiceProtocol</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></details> <p>优点</p> <ol><li>利用接口调用，实现了参数传递时的类型安全</li> <li>直接使用模块的protocol接口，无需再重复封装</li></ol> <p>缺点</p> <ol><li>用框架来创建所有对象，创建方式不同，即不支持外部传入参数</li> <li>用OC runtime创建对象，不支持swift</li> <li>只做了protocol 和 class 的匹配，不支持更复杂的创建方式 和依赖注入</li> <li>无法保证所使用的protocol 一定存在对应的模块，也无法直接判断某个protocol是否能用于获取模块</li></ol> <p>除了BeeHive，还有Swinject</p> <h4 id="beehive-模块注册"><a href="#beehive-模块注册" class="header-anchor">#</a> BeeHive 模块注册</h4> <p>在BeeHive主要是通过BHModuleManager来管理各个模块的。BHModuleManager中只会管理已经被注册过的模块。
BeeHive提供了三种不同的注册形式，annotation,静态plist，动态注册。Module、Service之间没有关联，每个业务模块可以单独实现Module或者Service的功能。</p> <h4 id="annotation方式注册"><a href="#annotation方式注册" class="header-anchor">#</a> Annotation方式注册</h4> <p>这种方式主要是通过BeeHiveMod宏进行Annotation标记</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token comment">//***** 使用</span>
<span class="token class-name">BeeHiveMod</span><span class="token punctuation">(</span><span class="token class-name">ShopModule</span><span class="token punctuation">)</span>

<span class="token comment">//***** BeeHiveMod的宏定义</span>
<span class="token other-directive property">#define</span> <span class="token class-name">BeeHiveMod</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">\</span>
<span class="token keyword">class</span> <span class="token class-name">BeeHive</span><span class="token punctuation">;</span> char <span class="token operator">*</span> k#<span class="token other-directive property">#name</span>#<span class="token other-directive property">#_mod</span> <span class="token class-name">BeeHiveDATA</span><span class="token punctuation">(</span><span class="token class-name">BeehiveMods</span><span class="token punctuation">)</span> <span class="token operator">=</span> &quot;&quot;<span class="token other-directive property">#name</span><span class="token string-literal"><span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span>

<span class="token comment">//***** BeeHiveDATA的宏定义 </span>
<span class="token other-directive property">#define</span> <span class="token class-name">BeeHiveDATA</span><span class="token punctuation">(</span>sectname<span class="token punctuation">)</span> <span class="token function">__attribute</span><span class="token punctuation">(</span><span class="token punctuation">(</span>used<span class="token punctuation">,</span> <span class="token function">section</span><span class="token punctuation">(</span>&quot;<span class="token constant">__DATA</span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">&quot;#sectname&quot;</span></span> &quot;<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//*****  全部转换出来后为下面的格式 以name是ShopModule为例</span>

char <span class="token operator">*</span> <span class="token constant">kShopModule_mod</span> <span class="token function">__attribute</span><span class="token punctuation">(</span><span class="token punctuation">(</span>used<span class="token punctuation">,</span> <span class="token function">section</span><span class="token punctuation">(</span>&quot;<span class="token constant">__DATA</span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">&quot;&quot;</span></span><span class="token class-name">BeehiveMods</span><span class="token string-literal"><span class="token string">&quot;&quot;</span></span> &quot;<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;&quot;&quot;ShopModule&quot;&quot;&quot;</span></span><span class="token punctuation">;</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></div> <p>这里针对__attribute需要说明以下几点</p> <p>第一个参数used：用来修饰函数，被used修饰以后，意味着即使函数没有被引用，在Release下也不会被优化。如果不加这个修饰，那么Release环境链接器下会去掉没有被引用的段。
通过使用__attribute__((section(&quot;name&quot;)))来指明哪个段。数据则用__attribute__((used))来标记，防止链接器会优化删除未被使用的段，然后将模块注入到__DATA中</p> <p>此时Module已经被存储到Mach-O文件的特殊段中，那么如何取呢？</p> <p>进入BHReadConfiguration方法，主要是通过Mach-O找到存储的数据段，取出放入数组中</p> <details class="custom-block details"><summary>点击查看</summary> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token class-name">NSArray</span><span class="token operator">&lt;</span><span class="token class-name">NSString</span> <span class="token operator">*&gt;*</span> <span class="token class-name">BHReadConfiguration</span><span class="token punctuation">(</span>char <span class="token operator">*</span>sectionName<span class="token punctuation">,</span>const <span class="token keyword">struct</span> mach_header <span class="token operator">*</span>mhp<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token class-name">NSMutableArray</span> <span class="token operator">*</span>configs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">NSMutableArray</span> array<span class="token punctuation">]</span><span class="token punctuation">;</span>
    unsigned long size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token other-directive property">#ifndef</span> __LP64__
    <span class="token comment">// 找到之前存储的数据段(Module找BeehiveMods段 和 Service找BeehiveServices段)的一片内存</span>
    uintptr_t <span class="token operator">*</span>memory <span class="token operator">=</span> <span class="token punctuation">(</span>uintptr_t<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">getsectiondata</span><span class="token punctuation">(</span>mhp<span class="token punctuation">,</span> <span class="token constant">SEG_DATA</span><span class="token punctuation">,</span> sectionName<span class="token punctuation">,</span> <span class="token operator">&amp;</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token directive property"><span class="token directive-name">#else</span></span>
    const <span class="token keyword">struct</span> mach_header_64 <span class="token operator">*</span>mhp64 <span class="token operator">=</span> <span class="token punctuation">(</span>const <span class="token keyword">struct</span> mach_header_64 <span class="token operator">*</span><span class="token punctuation">)</span>mhp<span class="token punctuation">;</span>
    uintptr_t <span class="token operator">*</span>memory <span class="token operator">=</span> <span class="token punctuation">(</span>uintptr_t<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">getsectiondata</span><span class="token punctuation">(</span>mhp64<span class="token punctuation">,</span> <span class="token constant">SEG_DATA</span><span class="token punctuation">,</span> sectionName<span class="token punctuation">,</span> <span class="token operator">&amp;</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token directive property"><span class="token directive-name">#endif</span></span>

    unsigned long counter <span class="token operator">=</span> size<span class="token operator">/</span><span class="token function">sizeof</span><span class="token punctuation">(</span>void<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 把特殊段里面的数据都转换成字符串存入数组中</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>int idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> idx <span class="token operator">&lt;</span> counter<span class="token punctuation">;</span> <span class="token operator">++</span>idx<span class="token punctuation">)</span><span class="token punctuation">{</span>
        char <span class="token operator">*</span>string <span class="token operator">=</span> <span class="token punctuation">(</span>char<span class="token operator">*</span><span class="token punctuation">)</span>memory<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">NSString</span> <span class="token operator">*</span>str <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">NSString</span> stringWithUTF8String<span class="token punctuation">:</span>string<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>str<span class="token punctuation">)</span><span class="token keyword">continue</span><span class="token punctuation">;</span>

        <span class="token class-name">BHLog</span><span class="token punctuation">(</span>@<span class="token string-literal"><span class="token string">&quot;config = %@&quot;</span></span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">[</span>configs addObject<span class="token punctuation">:</span>str<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> configs<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></details> <p>注册的dyld_callback回调如下</p> <details class="custom-block details"><summary>点击查看</summary> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">static</span> void <span class="token function">dyld_callback</span><span class="token punctuation">(</span>const <span class="token keyword">struct</span> mach_header <span class="token operator">*</span>mhp<span class="token punctuation">,</span> intptr_t vmaddr_slide<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">NSArray</span> <span class="token operator">*</span>mods <span class="token operator">=</span> <span class="token class-name">BHReadConfiguration</span><span class="token punctuation">(</span><span class="token class-name">BeehiveModSectName</span><span class="token punctuation">,</span> mhp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span>modName <span class="token keyword">in</span> mods<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span> cls<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>modName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cls <span class="token operator">=</span> <span class="token class-name">NSClassFromString</span><span class="token punctuation">(</span>modName<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>cls<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">BHModuleManager</span> sharedManager<span class="token punctuation">]</span> registerDynamicModule<span class="token punctuation">:</span>cls<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//register services</span>
    <span class="token class-name">NSArray</span><span class="token operator">&lt;</span><span class="token class-name">NSString</span> <span class="token operator">*&gt;</span> <span class="token operator">*</span>services <span class="token operator">=</span> <span class="token class-name">BHReadConfiguration</span><span class="token punctuation">(</span><span class="token class-name">BeehiveServiceSectName</span><span class="token punctuation">,</span>mhp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span>map <span class="token keyword">in</span> services<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">NSData</span> <span class="token operator">*</span>jsonData <span class="token operator">=</span>  <span class="token punctuation">[</span>map dataUsingEncoding<span class="token punctuation">:</span><span class="token class-name">NSUTF8StringEncoding</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">NSError</span> <span class="token operator">*</span>error <span class="token operator">=</span> <span class="token nil constant">nil</span><span class="token punctuation">;</span>
        id json <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">NSJSONSerialization</span> <span class="token class-name">JSONObjectWithData</span><span class="token punctuation">:</span>jsonData options<span class="token punctuation">:</span><span class="token number">0</span> error<span class="token punctuation">:</span><span class="token operator">&amp;</span>error<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>json isKindOfClass<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token class-name">NSDictionary</span> <span class="token keyword">class</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span>json allKeys<span class="token punctuation">]</span><span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token keyword">protocol</span> <span class="token operator">=</span> <span class="token punctuation">[</span>json allKeys<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token class-name">NSString</span> <span class="token operator">*</span>clsName  <span class="token operator">=</span> <span class="token punctuation">[</span>json allValues<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">protocol</span> <span class="token operator">&amp;&amp;</span> clsName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">BHServiceManager</span> sharedManager<span class="token punctuation">]</span> registerService<span class="token punctuation">:</span><span class="token class-name">NSProtocolFromString</span><span class="token punctuation">(</span><span class="token keyword">protocol</span><span class="token punctuation">)</span> implClass<span class="token punctuation">:</span><span class="token class-name">NSClassFromString</span><span class="token punctuation">(</span>clsName<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token function">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>constructor<span class="token punctuation">)</span><span class="token punctuation">)</span>
void <span class="token function">initProphet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//_dyld_register_func_for_add_image函数是用来注册dyld加载镜像时的回调函数,在dyld加载镜像时,会执行注册过的回调函数</span>
    <span class="token function">_dyld_register_func_for_add_image</span><span class="token punctuation">(</span>dyld_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div></details> <p>读取本地Pilst文件
首先，需要设置好路径</p> <p>[BHContext shareInstance].moduleConfigName = @&quot;BeeHive.bundle/BeeHive&quot;;//可选，默认为BeeHive.bundle/BeeHive.plist</p> <p>创建plist文件，Plist文件的格式也是数组中包含多个字典。字典里面有两个Key，一个是@&quot;moduleLevel&quot;，另一个是@&quot;moduleClass&quot;。注意根的数组的名字叫@“moduleClasses”。</p> <p><img src="https://cdn.staticaly.com/gh/214070779/picx-images-hosting@master/20230813/Screenshot-2023-08-27-at-09.12.36.57ibc5z4mlw0.webp" alt="Screenshot-2023-08-27-at-09"></p> <p>进入loadLocalModules方法，主要是从Plist里面取出数组，然后把数组加入到BHModuleInfos数组里面。</p> <details class="custom-block details"><summary>点击查看</summary> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token comment">//初始化context时，加载Modules和Services</span>
<span class="token operator">-</span><span class="token punctuation">(</span>void<span class="token punctuation">)</span>setContext<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token class-name">BHContext</span> <span class="token operator">*</span><span class="token punctuation">)</span>context
<span class="token punctuation">{</span>
    _context <span class="token operator">=</span> context<span class="token punctuation">;</span>

    <span class="token keyword">static</span> dispatch_once_t onceToken<span class="token punctuation">;</span>
    <span class="token function">dispatch_once</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>onceToken<span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> loadStaticServices<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> loadStaticModules<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
👇
<span class="token comment">//加载modules</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>loadStaticModules
<span class="token punctuation">{</span>
    <span class="token comment">// 读取本地plist文件里面的Module，并注册到BHModuleManager的BHModuleInfos数组中</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">BHModuleManager</span> sharedManager<span class="token punctuation">]</span> loadLocalModules<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//注册所有modules，在内部根据优先级进行排序</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">BHModuleManager</span> sharedManager<span class="token punctuation">]</span> registedAllModules<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
👇
<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>loadLocalModules
<span class="token punctuation">{</span>
    <span class="token comment">//plist文件路径</span>
    <span class="token class-name">NSString</span> <span class="token operator">*</span>plistPath <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">NSBundle</span> mainBundle<span class="token punctuation">]</span> pathForResource<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token class-name">BHContext</span> shareInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>moduleConfigName ofType<span class="token punctuation">:</span>@<span class="token string-literal"><span class="token string">&quot;plist&quot;</span></span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//判断文件是否存在</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">NSFileManager</span> defaultManager<span class="token punctuation">]</span> fileExistsAtPath<span class="token punctuation">:</span>plistPath<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//读取整个文件[@&quot;moduleClasses&quot; : 数组]</span>
    <span class="token class-name">NSDictionary</span> <span class="token operator">*</span>moduleList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">NSDictionary</span> alloc<span class="token punctuation">]</span> initWithContentsOfFile<span class="token punctuation">:</span>plistPath<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//通过moduleClasses key读取 数组 [[@&quot;moduleClass&quot;:&quot;aaa&quot;, @&quot;moduleLevel&quot;: @&quot;bbb&quot;], [...]]</span>
    <span class="token class-name">NSArray</span><span class="token operator">&lt;</span><span class="token class-name">NSDictionary</span> <span class="token operator">*&gt;</span> <span class="token operator">*</span>modulesArray <span class="token operator">=</span> <span class="token punctuation">[</span>moduleList objectForKey<span class="token punctuation">:</span><span class="token constant">kModuleArrayKey</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">NSMutableDictionary</span><span class="token operator">&lt;</span><span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">NSNumber</span> <span class="token operator">*&gt;</span> <span class="token operator">*</span>moduleInfoByClass <span class="token operator">=</span> @<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span>mutableCopy<span class="token punctuation">;</span>
    <span class="token comment">//遍历数组</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token class-name">BHModuleInfos</span> enumerateObjectsUsingBlock<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token class-name">NSDictionary</span> <span class="token operator">*</span> _Nonnull obj<span class="token punctuation">,</span> <span class="token class-name">NSUInteger</span> idx<span class="token punctuation">,</span> <span class="token constant">BOOL</span> <span class="token operator">*</span> _Nonnull stop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>moduleInfoByClass setObject<span class="token punctuation">:</span><span class="token attribute atrule">@1</span> forKey<span class="token punctuation">:</span><span class="token punctuation">[</span>obj objectForKey<span class="token punctuation">:</span><span class="token constant">kModuleInfoNameKey</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>modulesArray enumerateObjectsUsingBlock<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token class-name">NSDictionary</span> <span class="token operator">*</span> _Nonnull obj<span class="token punctuation">,</span> <span class="token class-name">NSUInteger</span> idx<span class="token punctuation">,</span> <span class="token constant">BOOL</span> <span class="token operator">*</span> _Nonnull stop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>moduleInfoByClass<span class="token punctuation">[</span><span class="token punctuation">[</span>obj objectForKey<span class="token punctuation">:</span><span class="token constant">kModuleInfoNameKey</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//存储到 BHModuleInfos 中</span>
            <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token class-name">BHModuleInfos</span> addObject<span class="token punctuation">:</span>obj<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div></details> <h4 id="load方法注册"><a href="#load方法注册" class="header-anchor">#</a> load方法注册</h4> <p>该方法注册Module就是在Load方法里面注册Module的类</p> <details class="custom-block details"><summary>点击查看</summary> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code><span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>load
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span>BeeHive registerDynamicModule<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token keyword">self</span> class<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//进入registerDynamicModule实现</span>
<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>registerDynamicModule<span class="token punctuation">:</span><span class="token punctuation">(</span>Class<span class="token punctuation">)</span>moduleClass
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>BHModuleManager sharedManager<span class="token punctuation">]</span> registerDynamicModule<span class="token punctuation">:</span>moduleClass<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
👇
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>registerDynamicModule<span class="token punctuation">:</span><span class="token punctuation">(</span>Class<span class="token punctuation">)</span>moduleClass
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span> registerDynamicModule<span class="token punctuation">:</span>moduleClass shouldTriggerInitEvent<span class="token punctuation">:</span>NO<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
👇
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>registerDynamicModule<span class="token punctuation">:</span><span class="token punctuation">(</span>Class<span class="token punctuation">)</span>moduleClass
       shouldTriggerInitEvent<span class="token punctuation">:</span><span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>shouldTriggerInitEvent
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span> addModuleFromObject<span class="token punctuation">:</span>moduleClass shouldTriggerInitEvent<span class="token punctuation">:</span>shouldTriggerInitEvent<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 和Annotation方式注册的dyld_callback回调一样，最终会走到addModuleFromObject:shouldTriggerInitEvent:方法中</span>

  <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>addModuleFromObject<span class="token punctuation">:</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>object
       shouldTriggerInitEvent<span class="token punctuation">:</span><span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>shouldTriggerInitEvent
  <span class="token punctuation">{</span>
      Class class<span class="token punctuation">;</span>
      NSString <span class="token operator">*</span>moduleName <span class="token operator">=</span> nil<span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          class <span class="token operator">=</span> object<span class="token punctuation">;</span>
          moduleName <span class="token operator">=</span> <span class="token function">NSStringFromClass</span><span class="token punctuation">(</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      __block BOOL flag <span class="token operator">=</span> YES<span class="token punctuation">;</span>
      <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>BHModules enumerateObjectsUsingBlock<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>id  _Nonnull obj<span class="token punctuation">,</span> NSUInteger idx<span class="token punctuation">,</span> BOOL <span class="token operator">*</span> _Nonnull stop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>obj isKindOfClass<span class="token punctuation">:</span>class<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              flag <span class="token operator">=</span> NO<span class="token punctuation">;</span>
              <span class="token operator">*</span>stop <span class="token operator">=</span> YES<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>class conformsToProtocol<span class="token punctuation">:</span><span class="token keyword">@protocol</span><span class="token punctuation">(</span>BHModuleProtocol<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          NSMutableDictionary <span class="token operator">*</span>moduleInfo <span class="token operator">=</span> <span class="token punctuation">[</span>NSMutableDictionary dictionary<span class="token punctuation">]</span><span class="token punctuation">;</span>

          BOOL responseBasicLevel <span class="token operator">=</span> <span class="token punctuation">[</span>class instancesRespondToSelector<span class="token punctuation">:</span><span class="token keyword">@selector</span><span class="token punctuation">(</span>basicModuleLevel<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

          <span class="token keyword">int</span> levelInt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>responseBasicLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              levelInt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token punctuation">[</span>moduleInfo setObject<span class="token punctuation">:</span><span class="token operator">@</span><span class="token punctuation">(</span>levelInt<span class="token punctuation">)</span> forKey<span class="token punctuation">:</span>kModuleInfoLevelKey<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token punctuation">[</span>moduleInfo setObject<span class="token punctuation">:</span>moduleName forKey<span class="token punctuation">:</span>kModuleInfoNameKey<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>BHModuleInfos addObject<span class="token punctuation">:</span>moduleInfo<span class="token punctuation">]</span><span class="token punctuation">;</span>

          id<span class="token operator">&lt;</span>BHModuleProtocol<span class="token operator">&gt;</span> moduleInstance <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>class alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>BHModules addObject<span class="token punctuation">:</span>moduleInstance<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">[</span>moduleInfo setObject<span class="token punctuation">:</span><span class="token operator">@</span><span class="token punctuation">(</span>YES<span class="token punctuation">)</span> forKey<span class="token punctuation">:</span>kModuleInfoHasInstantiatedKey<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>BHModules sortUsingComparator<span class="token punctuation">:</span><span class="token operator">^</span><span class="token function">NSComparisonResult</span><span class="token punctuation">(</span>id<span class="token operator">&lt;</span>BHModuleProtocol<span class="token operator">&gt;</span> moduleInstance1<span class="token punctuation">,</span> id<span class="token operator">&lt;</span>BHModuleProtocol<span class="token operator">&gt;</span> moduleInstance2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              NSNumber <span class="token operator">*</span>module1Level <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">(</span>BHModuleNormal<span class="token punctuation">)</span><span class="token punctuation">;</span>
              NSNumber <span class="token operator">*</span>module2Level <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">(</span>BHModuleNormal<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>moduleInstance1 respondsToSelector<span class="token punctuation">:</span><span class="token keyword">@selector</span><span class="token punctuation">(</span>basicModuleLevel<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  module1Level <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">(</span>BHModuleBasic<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>moduleInstance2 respondsToSelector<span class="token punctuation">:</span><span class="token keyword">@selector</span><span class="token punctuation">(</span>basicModuleLevel<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  module2Level <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">(</span>BHModuleBasic<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>module1Level<span class="token punctuation">.</span>integerValue <span class="token operator">!=</span> module2Level<span class="token punctuation">.</span>integerValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">return</span> module1Level<span class="token punctuation">.</span>integerValue <span class="token operator">&gt;</span> module2Level<span class="token punctuation">.</span>integerValue<span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                  NSInteger module1Priority <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                  NSInteger module2Priority <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>moduleInstance1 respondsToSelector<span class="token punctuation">:</span><span class="token keyword">@selector</span><span class="token punctuation">(</span>modulePriority<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      module1Priority <span class="token operator">=</span> <span class="token punctuation">[</span>moduleInstance1 modulePriority<span class="token punctuation">]</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>moduleInstance2 respondsToSelector<span class="token punctuation">:</span><span class="token keyword">@selector</span><span class="token punctuation">(</span>modulePriority<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      module2Priority <span class="token operator">=</span> <span class="token punctuation">[</span>moduleInstance2 modulePriority<span class="token punctuation">]</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span>
                  <span class="token keyword">return</span> module1Priority <span class="token operator">&lt;</span> module2Priority<span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token punctuation">[</span><span class="token keyword">self</span> registerEventsByModuleInstance<span class="token punctuation">:</span>moduleInstance<span class="token punctuation">]</span><span class="token punctuation">;</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldTriggerInitEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token punctuation">[</span><span class="token keyword">self</span> handleModuleEvent<span class="token punctuation">:</span>BHMSetupEvent forTarget<span class="token punctuation">:</span>moduleInstance withSeletorStr<span class="token punctuation">:</span>nil andCustomParam<span class="token punctuation">:</span>nil<span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token punctuation">[</span><span class="token keyword">self</span> handleModulesInitEventForTarget<span class="token punctuation">:</span>moduleInstance withCustomParam<span class="token punctuation">:</span>nil<span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token function">dispatch_async</span><span class="token punctuation">(</span><span class="token function">dispatch_get_main_queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span>
                  <span class="token punctuation">[</span><span class="token keyword">self</span> handleModuleEvent<span class="token punctuation">:</span>BHMSplashEvent forTarget<span class="token punctuation">:</span>moduleInstance withSeletorStr<span class="token punctuation">:</span>nil andCustomParam<span class="token punctuation">:</span>nil<span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br></div></div></details> <p>load方法，还可以使用BH_EXPORT_MODULE宏代替</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#define BH_EXPORT_MODULE(isAsync) \
+ (void)load { [BeeHive registerDynamicModule:[self class]]; } \
-(BOOL)async { return [[NSString stringWithUTF8String:#isAsync] boolValue];}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <p>BH_EXPORT_MODULE宏里面可以传入一个参数，代表是否异步加载Module模块，如果是YES就是异步加载，如果是NO就是同步加载。</p> <h4 id="beehive-protocol注册"><a href="#beehive-protocol注册" class="header-anchor">#</a> BeeHive Protocol注册</h4> <p>在BeeHive中是通过BHServiceManager来管理各个Protocol的。BHServiceManager中只会管理已经被注册过的Protocol。</p> <p>注册Protocol的方式总共有三种，和注册Module是一样一一对应的</p> <p>Annotation方式注册</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//****** 1、通过BeeHiveService宏进行Annotation标记
BeeHiveService(HomeServiceProtocol,BHViewController)

//****** 2、宏定义
#define BeeHiveService(servicename,impl) \
class BeeHive; char * k##servicename##_service BeeHiveDATA(BeehiveServices) = &quot;{ &quot;&quot;#servicename&quot;&quot; : &quot;&quot;#impl&quot;&quot;}&quot;;

//****** 3、转换后的格式，也是将其存储到特殊的段
char * kHomeServiceProtocol_service __attribute((used, section(&quot;__DATA,&quot;&quot;BeehiveServices&quot;&quot; &quot;))) = &quot;{ &quot;&quot;&quot;HomeServiceProtocol&quot;&quot;&quot; : &quot;&quot;&quot;BHViewController&quot;&quot;&quot;}&quot;;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div> <h4 id="读取本地plist文件"><a href="#读取本地plist文件" class="header-anchor">#</a> 读取本地plist文件</h4> <p>首先同Module一样，需要先设置好路径</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>[BHContext shareInstance].serviceConfigName = @&quot;BeeHive.bundle/BHService&quot;;</p></div> <p>设置plist文件</p> <p><img src="https://cdn.staticaly.com/gh/214070779/picx-images-hosting@master/20230813/Screenshot-2023-08-27-at-09.22.41.1q1a19dazirk.webp" alt="Screenshot-2023-08-27-at-09"></p> <p>同样也是在setContext时注册services</p> <details class="custom-block details"><summary>点击查看</summary> <div class="language- line-numbers-mode"><pre class="language-text"><code>//加载services
-(void)loadStaticServices
{
    [BHServiceManager sharedManager].enableException = self.enableException;

    [[BHServiceManager sharedManager] registerLocalServices];

}
👇
- (void)registerLocalServices
{
    NSString *serviceConfigName = [BHContext shareInstance].serviceConfigName;
    //获取plist文件路径
    NSString *plistPath = [[NSBundle mainBundle] pathForResource:serviceConfigName ofType:@&quot;plist&quot;];
    if (!plistPath) {
        return;
    }

    NSArray *serviceList = [[NSArray alloc] initWithContentsOfFile:plistPath];

    [self.lock lock];
    //遍历并存储到allServicesDict中
    for (NSDictionary *dict in serviceList) {
        NSString *protocolKey = [dict objectForKey:@&quot;service&quot;];
        NSString *protocolImplClass = [dict objectForKey:@&quot;impl&quot;];
        if (protocolKey.length &gt; 0 &amp;&amp; protocolImplClass.length &gt; 0) {
            [self.allServicesDict addEntriesFromDictionary:@{protocolKey:protocolImplClass}];
        }
    }
    [self.lock unlock];
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></details> <h4 id="load方法注册-2"><a href="#load方法注册-2" class="header-anchor">#</a> load方法注册</h4> <p>在Load方法里面注册Protocol协议，主要是调用BeeHive里面的registerService:service:完成protocol的注册</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>+ (void)load
{
   [[BeeHive shareInstance] registerService:@protocol(UserTrackServiceProtocol) service:[BHUserTrackViewController class]];
}
👇
- (void)registerService:(Protocol *)proto service:(Class) serviceClass
{
    [[BHServiceManager sharedManager] registerService:proto implClass:serviceClass];
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>到此，三种方式注册就完成了</p> <h4 id="protocol的获取"><a href="#protocol的获取" class="header-anchor">#</a> Protocol的获取</h4> <p>Protocol与Module的区别在于，Protocol比Module多了一个方法，可以返回Protocol实例对象</p> <details class="custom-block details"><summary>点击查看</summary> <div class="language- line-numbers-mode"><pre class="language-text"><code>- (id)createService:(Protocol *)proto;
{
    return [[BHServiceManager sharedManager] createService:proto];
}
👇
- (id)createService:(Protocol *)service
{
    return [self createService:service withServiceName:nil];
}
👇
- (id)createService:(Protocol *)service withServiceName:(NSString *)serviceName {
    return [self createService:service withServiceName:serviceName shouldCache:YES];
}
👇
- (id)createService:(Protocol *)service withServiceName:(NSString *)serviceName shouldCache:(BOOL)shouldCache {
    if (!serviceName.length) {
        serviceName = NSStringFromProtocol(service);
    }
    id implInstance = nil;
    //判断protocol是否已经注册过
    if (![self checkValidService:service]) {
        if (self.enableException) {
            @throw [NSException exceptionWithName:NSInternalInconsistencyException reason:[NSString stringWithFormat:@&quot;%@ protocol does not been registed&quot;, NSStringFromProtocol(service)] userInfo:nil];
        }
        
    }
    
    NSString *serviceStr = serviceName;
    //如果有缓存，则直接从缓存中获取
    if (shouldCache) {
        id protocolImpl = [[BHContext shareInstance] getServiceInstanceFromServiceName:serviceStr];
        if (protocolImpl) {
            return protocolImpl;
        }
    }
    //获取类后，然后响应下层的方法
    Class implClass = [self serviceImplClass:service];
    if ([[implClass class] respondsToSelector:@selector(singleton)]) {
        if ([[implClass class] singleton]) {
            if ([[implClass class] respondsToSelector:@selector(shareInstance)])
                //创建单例对象
                implInstance = [[implClass class] shareInstance];
            else
                //创建实例对象
                implInstance = [[implClass alloc] init];
            if (shouldCache) {
                //缓存
                [[BHContext shareInstance] addServiceWithImplInstance:implInstance serviceName:serviceStr];
                return implInstance;
            } else {
                return implInstance;
            }
        }
    }
    return [[implClass alloc] init];
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div></details> <p>createService会先检查Protocol协议是否是注册过的。然后接着取出字典里面对应的Class，如果实现了shareInstance方法，那么就创建一个单例对象，如果没有，那么就创建一个实例对象。如果还实现了singleton，就能进一步的把implInstance和serviceStr对应的加到BHContext的servicesByName字典里面缓存起来。这样就可以随着上下文传递了</p> <p>进入serviceImplClass实现，从这里可以看出 protocol和类是通过字典绑定的，protocol作为key，serviceImp（类的名字）作为value</p> <details class="custom-block details"><summary>点击查看</summary> <div class="language- line-numbers-mode"><pre class="language-text"><code>- (Class)serviceImplClass:(Protocol *)service
{
    //通过字典将 协议 和 类 绑定，其中协议作为key，serviceImp（类的名字）作为value
    NSString *serviceImpl = [[self servicesDict] objectForKey:NSStringFromProtocol(service)];
    if (serviceImpl.length &gt; 0) {
        return NSClassFromString(serviceImpl);
    }
    return nil;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></details> <h4 id="module-protocol"><a href="#module-protocol" class="header-anchor">#</a> Module &amp; Protocol</h4> <p>这里简单总结下：</p> <ul><li><p>对于Module：数组存储</p></li> <li><p>对于Protocol：通过字典将protocol与类进行绑定，key为protocol，value为 serviceImp即类名</p></li></ul> <p>BeeHive辅助类</p> <ul><li>BHContext类：是一个单例，其内部有两个NSMutableDictionary的属性，分别是modulesByName 和 servicesByName。这个类主要用来保存上下文信息的。例如在application:didFinishLaunchingWithOptions:的时候，就可以初始化大量的上下文信息</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>//保存信息
[BHContext shareInstance].application = application;
[BHContext shareInstance].launchOptions = launchOptions;
[BHContext shareInstance].moduleConfigName = @&quot;BeeHive.bundle/BeeHive&quot;;//可选，默认为BeeHive.bundle/BeeHive.plist
[BHContext shareInstance].serviceConfigName = @&quot;BeeHive.bundle/BHService&quot;;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><p>BHConfig类：是一个单例，其内部有一个NSMutableDictionary类型的config属性，该属性维护了一些动态的环境变量，作为BHContext的补充存在</p></li> <li><p>BHTimeProfiler类：用来进行计算时间性能方面的Profiler</p></li> <li><p>BHWatchDog类：用来开一个线程，监听主线程是否堵塞</p></li></ul> <h2 id="组件化架构实践规范和原则"><a href="#组件化架构实践规范和原则" class="header-anchor">#</a> 组件化架构实践规范和原则</h2> <p>基于以上这些组件化架构的问题，需要一些组件化架构相关的规范和原则帮助我们做好组件化架构，后面主要会围绕以下三点进行介绍：</p> <ul><li>组件拆分原则 - 拆分思想和最佳实践指导组件拆分</li> <li>组件间依赖 - 优化组件间依赖关系跨组件调用/通信方式的选择</li> <li>质量保障 - 避免在持续的工程演化过程中工程质量逐渐劣化。主要包含安全卡口和CI检查</li></ul> <p>接下来以一个典型的电商APP架构案例来介绍一个组件化工程。这个案例架构具备之前所说现有中大型APP架构的一些特点，多组件、多技术栈、业务间需要解耦、复用底层基础组件。基于这个案例来介绍上面的三点原则。
<img src="https://cdn.staticaly.com/gh/214070779/picx-images-hosting@master/20230813/Screenshot-2023-08-27-at-20.00.38.6idzkez2x900.webp" alt="Screenshot-2023-08-27-at-20"></p> <h3 id="组建拆分原则"><a href="#组建拆分原则" class="header-anchor">#</a> 组建拆分原则</h3> <p><img src="https://cdn.staticaly.com/gh/214070779/picx-images-hosting@master/20230813/Screenshot-2023-08-27-at-20.01.38.7oi4nqecunc.webp" alt="Screenshot-2023-08-27-at-20"></p> <p>组件拆分最重要是帮我们梳理出组件职责以及组件职责的边界。组件划分也会使用很多通用的设计原则和架构思想。</p> <h4 id="使用分层思想拆分"><a href="#使用分层思想拆分" class="header-anchor">#</a> 使用分层思想拆分</h4> <p>通常我们可以首先使用分层架构的思想将所有组件纵向拆分为多层组件，上面层级的组件只能依赖下面层级的组件。一般至少可以划分为四层组件：</p> <ul><li>基础层 - 提供核心的与上层业务无关的基础能力。可以被上层组件直接依赖使用。</li> <li>业务公共层 - 主要包含页面路由、公共UI组件、跨组件通信以及服务接口，可被上层组件直接依赖使用。</li> <li>业务实现层 - 业务核心实现层，包含原生页面、跨平台容器、业务服务实现。组件间不能直接依赖，只能通过调用页面路由或跨组件通信组件进行使用。</li> <li>APP宿主层 - 主要包含APP主工程、启动流程、页面路由注册、服务注册、SDK参数初始化等组件，用于构建打包生成相应的APP。</li></ul> <p>划分层级可以很好的指导我们进行组件拆分。在拆分组件时我们需要先识别它应该在哪一层，它应该以哪种调用方式被其他组件使用，新添加的功能是否会产生反向依赖，帮助我们规范组件间的依赖关系。同时按层级拆分组件也有利于底层基础组件的复用。
以下场景使用分层思想就很容易识别：</p> <p><strong>基础组件依赖业务组件</strong></p> <p>例子：APP内业务发起网络请求通常需要携带公共参数/Cookie。</p> <ul><li><p>没有组件分层约束 - 网络库可能会依赖登录服务获取用户信息、依赖定位服务获取经纬度，引入大量的依赖变成业务组件。</p></li> <li><p>有组件分层约束 - 网络库作为一个基础组件，它不需要关注上层业务需要携带哪些公共业务参数，同时登录/定位服务组件在网络库上层不能被反向依赖。这时候会考虑单独创建一个公共参数管理类，在APP运行时监听各种状态的变更并调用网络库更新公共参数/Cookie。</p></li></ul> <p><strong>业务组件间依赖方向是否正确</strong></p> <p>登录状态切换经常会涉及到很多业务逻辑的触发，例如清空本地用户缓存、地址缓存、清空购物车数据、UI状态变更。</p> <ul><li>没有组件分层约束 - 可能会在登录服务内当登录状态切换时调用多个业务逻辑的触发，导致登录服务引入多个业务组件依赖。</li> <li>有组件分层约束 - 登录组件只需要在登录状态切换时发出通知，无需知道登录状态切换会影响哪些业务。业务逻辑应该监听登录状态的变更。</li></ul> <p><strong>识别基础组件还是业务组件</strong></p> <p>虽然很多场景下我们很容易能识别处理出来一个功能应该归属于基础组件还是业务组件，例如一个UI控件是基础组件还是业务组件。但是很多时候边界又非常的模糊，例如一个添加购物车按键应该是一个基础组件还是业务组件呢。</p> <ul><li>基础组件 - 如果不需要依赖业务公共层那应当划分为一个基础组件。</li> <li>业务组件 - 依赖了业务公共层或者网络库，那就应该划分为一个业务组件。</li></ul> <p>分层思想可以很好的帮助我们管理组件间的依赖关系，并且明确每个组件的职责边界。</p> <h3 id="基础-业务组件拆分原则"><a href="#基础-业务组件拆分原则" class="header-anchor">#</a> 基础/业务组件拆分原则</h3> <p>划分基础/业务组件主要是为了强制约束组件间的依赖关系。以上面的组件分层架构为例：</p> <ul><li>基础组件 - 基础组件可被直接依赖使用，使用方调用基础组件对外暴露API直接使用。基础层、业务公共层都为基础组件。</li> <li>业务组件 - 业务组件不可被直接依赖使用，只能通过间接通信方式进行使用。APP宿主层和业务实现层都为业务组件。
提示：这里的业务组件并不包含业务UI组件。</li></ul> <h4 id="基础组件拆分"><a href="#基础组件拆分" class="header-anchor">#</a> 基础组件拆分</h4> <p>基础组件通常根据职责单一原则进行拆分比较容易拆分，但是会有一些拆分场景需要考虑：
<strong>使用插件组件拆分基础组件扩展能力</strong>
将核心基础能力和扩展能力拆分到不同的组件。以网络库为例，除了提供最核心的接口请求能力，同时可能还包含一些-扩展能力例如HTTPDNS、网络性能检测、弱网优化等能力。但这些扩展能力放在网络库组件内部可能会导致以下问题：</p> <ul><li>扩展能力会使组件自身代码变得更加复杂。</li> <li>使用方不一定会使用所有这些扩展能力违反了最小依赖原则。带来更多的包体积，引入更多的组件依赖，增加模块间的耦合度。</li> <li>相关的扩展能力不支持灵活的替换/插拔。
所以这种场景我们可以考虑根据实际情况将扩展能力拆分到相应的插件组件，使用方需要时再依赖引入对应插件组件。</li></ul> <h4 id="业务组件拆分"><a href="#业务组件拆分" class="header-anchor">#</a> 业务组件拆分</h4> <p>业务页面拆分方式</p> <p>针对业务页面可以使用技术栈、业务域、页面粒度三种方式进行更细粒度的划分，通常至少要拆分到技术栈、业务域这一层级，页面粒度拆分根据具体页面复杂度和复用诉求。</p> <ul><li>基于技术栈进行拆分 - 不同的技术栈需要拆分到不同的组件进行管理。</li> <li>基于业务域进行拆分 - 将同一个业务域的所有页面拆分一个组件，避免不同业务域之间形成强耦合依赖关系，同一个业务域通常会有更多复用和通信的场景也方便开发。例如订单详情和订单列表可放置在一起管理。</li> <li>基于页面粒度进行拆分 - 单个页面复杂度过高或需要被单独复用时需要拆分到一个单个组件管理。</li></ul> <p>提示：放置在单一组件内的多个页面之间也应适当降低耦合程度。</p> <h4 id="第三方库"><a href="#第三方库" class="header-anchor">#</a> 第三方库</h4> <p><strong>第三方库应拆分单独组件管理</strong>
第三方库应使用独立的组件进行管理，一方面有利于组件复用同时避免多个重复第三方库导致符号冲突，另一方面有利于后续升级维护。</p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/master/docs/02.技术/05.iOS基础知识/09.组件化系列跟架构/00.iOS组件化系列.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/10/28, 15:22:03</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/a97536/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">图片相关的问题</div></a> <a href="/pages/b14b84/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">MVVM、MVC、MVP</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/a97536/" class="prev">图片相关的问题</a></span> <span class="next"><a href="/pages/b14b84/">MVVM、MVC、MVP</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/1e9b25/"><div>
            排序算法
            <!----></div></a> <span class="date">10-22</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/f27637/"><div>
            学习数据结构和算法的高效方法
            <!----></div></a> <span class="date">10-19</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/39672b/"><div>
            时间复杂度跟空间复杂度
            <!----></div></a> <span class="date">10-19</span></dt></dl> <dl><dd></dd> <dt><a href="/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:yangzai2140@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/214070779" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2024
    <span>Evan Xu | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.cc55d274.js" defer></script><script src="/assets/js/2.81b2a5fe.js" defer></script><script src="/assets/js/60.fdf12a20.js" defer></script>
  </body>
</html>
