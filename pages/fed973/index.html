<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OC跟webview交互系列 | 洋仔的博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <meta name="description" content="专心做事，用心总结">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.55beba5e.css" as="style"><link rel="preload" href="/assets/js/app.cc55d274.js" as="script"><link rel="preload" href="/assets/js/2.81b2a5fe.js" as="script"><link rel="preload" href="/assets/js/3.1b6e43a5.js" as="script"><link rel="prefetch" href="/assets/js/10.fd87ea06.js"><link rel="prefetch" href="/assets/js/100.033c06ef.js"><link rel="prefetch" href="/assets/js/101.1c0e8fbb.js"><link rel="prefetch" href="/assets/js/102.820c15ea.js"><link rel="prefetch" href="/assets/js/103.1f4387c0.js"><link rel="prefetch" href="/assets/js/104.6b56fc18.js"><link rel="prefetch" href="/assets/js/105.7e174701.js"><link rel="prefetch" href="/assets/js/106.e7ed90dd.js"><link rel="prefetch" href="/assets/js/107.5dff726f.js"><link rel="prefetch" href="/assets/js/108.1b4254ab.js"><link rel="prefetch" href="/assets/js/109.db801d19.js"><link rel="prefetch" href="/assets/js/11.4cd9f768.js"><link rel="prefetch" href="/assets/js/110.51ed8450.js"><link rel="prefetch" href="/assets/js/111.1ed05a5b.js"><link rel="prefetch" href="/assets/js/112.d7f263da.js"><link rel="prefetch" href="/assets/js/113.dea11b47.js"><link rel="prefetch" href="/assets/js/114.ad6403dc.js"><link rel="prefetch" href="/assets/js/115.28cf40c7.js"><link rel="prefetch" href="/assets/js/116.02bcdc6e.js"><link rel="prefetch" href="/assets/js/117.75a9e1eb.js"><link rel="prefetch" href="/assets/js/118.03e0d0e9.js"><link rel="prefetch" href="/assets/js/119.766321d8.js"><link rel="prefetch" href="/assets/js/12.1f119179.js"><link rel="prefetch" href="/assets/js/120.4acf5e51.js"><link rel="prefetch" href="/assets/js/121.a4fcaab7.js"><link rel="prefetch" href="/assets/js/122.d2cc02cb.js"><link rel="prefetch" href="/assets/js/123.c4c3b254.js"><link rel="prefetch" href="/assets/js/124.55aefdfc.js"><link rel="prefetch" href="/assets/js/125.33021e89.js"><link rel="prefetch" href="/assets/js/126.bf744470.js"><link rel="prefetch" href="/assets/js/127.d1b1efb8.js"><link rel="prefetch" href="/assets/js/128.8c1b4252.js"><link rel="prefetch" href="/assets/js/129.ac017f9f.js"><link rel="prefetch" href="/assets/js/13.0f009df8.js"><link rel="prefetch" href="/assets/js/130.fdc573c0.js"><link rel="prefetch" href="/assets/js/131.c4f70462.js"><link rel="prefetch" href="/assets/js/132.d874068e.js"><link rel="prefetch" href="/assets/js/133.3344bf55.js"><link rel="prefetch" href="/assets/js/134.86c9bfea.js"><link rel="prefetch" href="/assets/js/135.7761e325.js"><link rel="prefetch" href="/assets/js/136.99654544.js"><link rel="prefetch" href="/assets/js/137.25867633.js"><link rel="prefetch" href="/assets/js/138.3016a91b.js"><link rel="prefetch" href="/assets/js/139.ead29e5f.js"><link rel="prefetch" href="/assets/js/14.1c908535.js"><link rel="prefetch" href="/assets/js/140.2217ee0f.js"><link rel="prefetch" href="/assets/js/141.faed4896.js"><link rel="prefetch" href="/assets/js/142.3786cfaa.js"><link rel="prefetch" href="/assets/js/143.680d45a4.js"><link rel="prefetch" href="/assets/js/144.5e0d30d9.js"><link rel="prefetch" href="/assets/js/145.a2c5cf58.js"><link rel="prefetch" href="/assets/js/146.215c3961.js"><link rel="prefetch" href="/assets/js/147.81e5dbea.js"><link rel="prefetch" href="/assets/js/148.7ef156fa.js"><link rel="prefetch" href="/assets/js/149.07344fb0.js"><link rel="prefetch" href="/assets/js/15.24686777.js"><link rel="prefetch" href="/assets/js/150.100e1276.js"><link rel="prefetch" href="/assets/js/151.5a0852bd.js"><link rel="prefetch" href="/assets/js/152.d0e587d9.js"><link rel="prefetch" href="/assets/js/153.007ec2d1.js"><link rel="prefetch" href="/assets/js/154.3178d124.js"><link rel="prefetch" href="/assets/js/155.53357b05.js"><link rel="prefetch" href="/assets/js/156.d5438e93.js"><link rel="prefetch" href="/assets/js/157.8afa8209.js"><link rel="prefetch" href="/assets/js/158.0434bf90.js"><link rel="prefetch" href="/assets/js/159.64687b5f.js"><link rel="prefetch" href="/assets/js/16.12f4db26.js"><link rel="prefetch" href="/assets/js/160.56d76ff4.js"><link rel="prefetch" href="/assets/js/161.f6414d3f.js"><link rel="prefetch" href="/assets/js/162.b9de4b51.js"><link rel="prefetch" href="/assets/js/163.07e063ef.js"><link rel="prefetch" href="/assets/js/164.3acfc294.js"><link rel="prefetch" href="/assets/js/165.66703a7d.js"><link rel="prefetch" href="/assets/js/166.cb851667.js"><link rel="prefetch" href="/assets/js/167.4098c444.js"><link rel="prefetch" href="/assets/js/168.a80d728b.js"><link rel="prefetch" href="/assets/js/169.bd937a75.js"><link rel="prefetch" href="/assets/js/17.6c77ddb7.js"><link rel="prefetch" href="/assets/js/170.e3d78c48.js"><link rel="prefetch" href="/assets/js/171.bceae2ae.js"><link rel="prefetch" href="/assets/js/172.ce9b722c.js"><link rel="prefetch" href="/assets/js/173.e47f9666.js"><link rel="prefetch" href="/assets/js/174.7997805c.js"><link rel="prefetch" href="/assets/js/175.00237921.js"><link rel="prefetch" href="/assets/js/176.0fa3c92e.js"><link rel="prefetch" href="/assets/js/177.78d4055c.js"><link rel="prefetch" href="/assets/js/178.3b9e2d49.js"><link rel="prefetch" href="/assets/js/179.ffd38cbc.js"><link rel="prefetch" href="/assets/js/18.bdd3ef44.js"><link rel="prefetch" href="/assets/js/180.ea1e7437.js"><link rel="prefetch" href="/assets/js/181.1b990f8f.js"><link rel="prefetch" href="/assets/js/182.2294fb00.js"><link rel="prefetch" href="/assets/js/183.d49c9d33.js"><link rel="prefetch" href="/assets/js/184.ad8b9900.js"><link rel="prefetch" href="/assets/js/185.da48669b.js"><link rel="prefetch" href="/assets/js/186.650a47d2.js"><link rel="prefetch" href="/assets/js/187.dc3e7f5f.js"><link rel="prefetch" href="/assets/js/188.d372ce27.js"><link rel="prefetch" href="/assets/js/189.fa1c9909.js"><link rel="prefetch" href="/assets/js/19.10c0d5b8.js"><link rel="prefetch" href="/assets/js/190.6c1b8013.js"><link rel="prefetch" href="/assets/js/191.6676590e.js"><link rel="prefetch" href="/assets/js/192.cb1953e2.js"><link rel="prefetch" href="/assets/js/193.a6ae7e91.js"><link rel="prefetch" href="/assets/js/194.2ebc2436.js"><link rel="prefetch" href="/assets/js/195.35be6114.js"><link rel="prefetch" href="/assets/js/196.b360067a.js"><link rel="prefetch" href="/assets/js/197.c0234eef.js"><link rel="prefetch" href="/assets/js/198.6231b11b.js"><link rel="prefetch" href="/assets/js/199.838ff34e.js"><link rel="prefetch" href="/assets/js/20.92725459.js"><link rel="prefetch" href="/assets/js/200.5dc57180.js"><link rel="prefetch" href="/assets/js/201.39e5421a.js"><link rel="prefetch" href="/assets/js/202.0a56fa31.js"><link rel="prefetch" href="/assets/js/203.90d6ea32.js"><link rel="prefetch" href="/assets/js/204.48311b42.js"><link rel="prefetch" href="/assets/js/205.e1f37224.js"><link rel="prefetch" href="/assets/js/206.92c38d74.js"><link rel="prefetch" href="/assets/js/207.3493f997.js"><link rel="prefetch" href="/assets/js/208.d2d00438.js"><link rel="prefetch" href="/assets/js/209.7ff3e1db.js"><link rel="prefetch" href="/assets/js/21.703ec124.js"><link rel="prefetch" href="/assets/js/210.b9e087c1.js"><link rel="prefetch" href="/assets/js/211.0b5f6ae5.js"><link rel="prefetch" href="/assets/js/212.5a5a4e85.js"><link rel="prefetch" href="/assets/js/213.ddea0aff.js"><link rel="prefetch" href="/assets/js/214.06e03126.js"><link rel="prefetch" href="/assets/js/215.99e71be9.js"><link rel="prefetch" href="/assets/js/216.5ab77662.js"><link rel="prefetch" href="/assets/js/217.5b8b2a56.js"><link rel="prefetch" href="/assets/js/218.656d4df8.js"><link rel="prefetch" href="/assets/js/219.2f9282d7.js"><link rel="prefetch" href="/assets/js/22.7832c9ca.js"><link rel="prefetch" href="/assets/js/220.05012b4c.js"><link rel="prefetch" href="/assets/js/221.150b41d4.js"><link rel="prefetch" href="/assets/js/222.18bfe57a.js"><link rel="prefetch" href="/assets/js/223.5d9b036a.js"><link rel="prefetch" href="/assets/js/224.cd5efc56.js"><link rel="prefetch" href="/assets/js/225.fe1ef215.js"><link rel="prefetch" href="/assets/js/226.b5602968.js"><link rel="prefetch" href="/assets/js/227.9f3fc228.js"><link rel="prefetch" href="/assets/js/228.a9a155dc.js"><link rel="prefetch" href="/assets/js/229.53d80ddd.js"><link rel="prefetch" href="/assets/js/23.8e2d40f9.js"><link rel="prefetch" href="/assets/js/230.4918b1a6.js"><link rel="prefetch" href="/assets/js/231.ca415abb.js"><link rel="prefetch" href="/assets/js/232.04bfb190.js"><link rel="prefetch" href="/assets/js/233.d2a40489.js"><link rel="prefetch" href="/assets/js/234.e2aacb9a.js"><link rel="prefetch" href="/assets/js/235.163536f8.js"><link rel="prefetch" href="/assets/js/236.6c845360.js"><link rel="prefetch" href="/assets/js/237.cad6b7ea.js"><link rel="prefetch" href="/assets/js/238.c802c732.js"><link rel="prefetch" href="/assets/js/239.3a5fe17c.js"><link rel="prefetch" href="/assets/js/24.4c371769.js"><link rel="prefetch" href="/assets/js/240.27f6052d.js"><link rel="prefetch" href="/assets/js/241.a631c566.js"><link rel="prefetch" href="/assets/js/242.01736d0d.js"><link rel="prefetch" href="/assets/js/243.b1af5586.js"><link rel="prefetch" href="/assets/js/244.18016cf2.js"><link rel="prefetch" href="/assets/js/245.0626c28d.js"><link rel="prefetch" href="/assets/js/246.73f699ec.js"><link rel="prefetch" href="/assets/js/247.f444bd44.js"><link rel="prefetch" href="/assets/js/248.65a80d31.js"><link rel="prefetch" href="/assets/js/249.0dd1d0d9.js"><link rel="prefetch" href="/assets/js/25.b040b00d.js"><link rel="prefetch" href="/assets/js/250.69712e0b.js"><link rel="prefetch" href="/assets/js/251.d4d3c3e2.js"><link rel="prefetch" href="/assets/js/252.6484f155.js"><link rel="prefetch" href="/assets/js/253.410f1ed5.js"><link rel="prefetch" href="/assets/js/254.e8b85c6f.js"><link rel="prefetch" href="/assets/js/255.d2df3587.js"><link rel="prefetch" href="/assets/js/256.09bb0d0e.js"><link rel="prefetch" href="/assets/js/257.71461633.js"><link rel="prefetch" href="/assets/js/258.af2f399d.js"><link rel="prefetch" href="/assets/js/259.9ec5e83b.js"><link rel="prefetch" href="/assets/js/26.a1fb922a.js"><link rel="prefetch" href="/assets/js/260.cac8239f.js"><link rel="prefetch" href="/assets/js/261.925d41ff.js"><link rel="prefetch" href="/assets/js/262.28633c4a.js"><link rel="prefetch" href="/assets/js/263.f21c004b.js"><link rel="prefetch" href="/assets/js/264.57e4ff6c.js"><link rel="prefetch" href="/assets/js/265.c962904f.js"><link rel="prefetch" href="/assets/js/266.5d28c35b.js"><link rel="prefetch" href="/assets/js/267.966d88be.js"><link rel="prefetch" href="/assets/js/268.7f072ba9.js"><link rel="prefetch" href="/assets/js/269.8a2bbc16.js"><link rel="prefetch" href="/assets/js/27.8ae4e4fd.js"><link rel="prefetch" href="/assets/js/270.c7dbb8c2.js"><link rel="prefetch" href="/assets/js/271.fd0a8147.js"><link rel="prefetch" href="/assets/js/272.39f2833e.js"><link rel="prefetch" href="/assets/js/273.5d03fdb3.js"><link rel="prefetch" href="/assets/js/274.d7cde43a.js"><link rel="prefetch" href="/assets/js/275.2b84609e.js"><link rel="prefetch" href="/assets/js/276.2ba14d83.js"><link rel="prefetch" href="/assets/js/277.bedaa21d.js"><link rel="prefetch" href="/assets/js/278.9750200e.js"><link rel="prefetch" href="/assets/js/279.54cf5084.js"><link rel="prefetch" href="/assets/js/28.7c726cfd.js"><link rel="prefetch" href="/assets/js/280.24775da3.js"><link rel="prefetch" href="/assets/js/281.f44383db.js"><link rel="prefetch" href="/assets/js/282.5dd2530b.js"><link rel="prefetch" href="/assets/js/283.60a029cc.js"><link rel="prefetch" href="/assets/js/284.80d5c684.js"><link rel="prefetch" href="/assets/js/285.2233e644.js"><link rel="prefetch" href="/assets/js/286.2e6924e4.js"><link rel="prefetch" href="/assets/js/287.52470b25.js"><link rel="prefetch" href="/assets/js/288.0c9d41ca.js"><link rel="prefetch" href="/assets/js/289.57b35055.js"><link rel="prefetch" href="/assets/js/29.5762da80.js"><link rel="prefetch" href="/assets/js/290.3765d6a5.js"><link rel="prefetch" href="/assets/js/291.6bd15b79.js"><link rel="prefetch" href="/assets/js/292.afb5a75a.js"><link rel="prefetch" href="/assets/js/293.f5759dcb.js"><link rel="prefetch" href="/assets/js/294.2209dfe5.js"><link rel="prefetch" href="/assets/js/295.f7e224d5.js"><link rel="prefetch" href="/assets/js/296.36fde749.js"><link rel="prefetch" href="/assets/js/297.df8a1239.js"><link rel="prefetch" href="/assets/js/298.d0028860.js"><link rel="prefetch" href="/assets/js/299.f44a0e98.js"><link rel="prefetch" href="/assets/js/30.f7bd2da9.js"><link rel="prefetch" href="/assets/js/300.e1e1e2af.js"><link rel="prefetch" href="/assets/js/301.ac068e67.js"><link rel="prefetch" href="/assets/js/302.1e2a778b.js"><link rel="prefetch" href="/assets/js/303.32c1023d.js"><link rel="prefetch" href="/assets/js/304.2bd7d59c.js"><link rel="prefetch" href="/assets/js/305.0e0b08a3.js"><link rel="prefetch" href="/assets/js/306.48947241.js"><link rel="prefetch" href="/assets/js/307.04186968.js"><link rel="prefetch" href="/assets/js/308.b6b41f7b.js"><link rel="prefetch" href="/assets/js/309.ed01b460.js"><link rel="prefetch" href="/assets/js/31.81b4a4d2.js"><link rel="prefetch" href="/assets/js/310.61ab2756.js"><link rel="prefetch" href="/assets/js/311.dfa83b75.js"><link rel="prefetch" href="/assets/js/312.21c9fcf2.js"><link rel="prefetch" href="/assets/js/313.9c7bdcf7.js"><link rel="prefetch" href="/assets/js/314.444459f4.js"><link rel="prefetch" href="/assets/js/315.01c2dddd.js"><link rel="prefetch" href="/assets/js/316.fa19412e.js"><link rel="prefetch" href="/assets/js/317.b8e81823.js"><link rel="prefetch" href="/assets/js/318.a76c19a2.js"><link rel="prefetch" href="/assets/js/319.b6d393e9.js"><link rel="prefetch" href="/assets/js/32.d9074bf8.js"><link rel="prefetch" href="/assets/js/320.b9b7d53d.js"><link rel="prefetch" href="/assets/js/321.377dc9df.js"><link rel="prefetch" href="/assets/js/322.5414100c.js"><link rel="prefetch" href="/assets/js/323.0edddb0c.js"><link rel="prefetch" href="/assets/js/324.a3c19125.js"><link rel="prefetch" href="/assets/js/325.0a931352.js"><link rel="prefetch" href="/assets/js/326.99cd4779.js"><link rel="prefetch" href="/assets/js/327.aa0bbc95.js"><link rel="prefetch" href="/assets/js/328.8d936413.js"><link rel="prefetch" href="/assets/js/329.86331300.js"><link rel="prefetch" href="/assets/js/33.61cbe880.js"><link rel="prefetch" href="/assets/js/330.2f949c81.js"><link rel="prefetch" href="/assets/js/331.27c8897b.js"><link rel="prefetch" href="/assets/js/332.2a06265f.js"><link rel="prefetch" href="/assets/js/333.5380694f.js"><link rel="prefetch" href="/assets/js/334.a4fc88c7.js"><link rel="prefetch" href="/assets/js/335.d24aa360.js"><link rel="prefetch" href="/assets/js/336.e6c27799.js"><link rel="prefetch" href="/assets/js/337.7068bfa9.js"><link rel="prefetch" href="/assets/js/338.05129acf.js"><link rel="prefetch" href="/assets/js/339.32a155e4.js"><link rel="prefetch" href="/assets/js/34.458856b1.js"><link rel="prefetch" href="/assets/js/340.79f4160c.js"><link rel="prefetch" href="/assets/js/341.1845d39d.js"><link rel="prefetch" href="/assets/js/342.e9025266.js"><link rel="prefetch" href="/assets/js/343.022762e6.js"><link rel="prefetch" href="/assets/js/344.5f6ede26.js"><link rel="prefetch" href="/assets/js/345.0f09d3e9.js"><link rel="prefetch" href="/assets/js/346.baf57bd3.js"><link rel="prefetch" href="/assets/js/347.fca5ad32.js"><link rel="prefetch" href="/assets/js/348.ee72d1c4.js"><link rel="prefetch" href="/assets/js/349.3d1973a7.js"><link rel="prefetch" href="/assets/js/35.bd72afbd.js"><link rel="prefetch" href="/assets/js/350.6c10a97f.js"><link rel="prefetch" href="/assets/js/351.2b4fcad2.js"><link rel="prefetch" href="/assets/js/352.cc2e2e46.js"><link rel="prefetch" href="/assets/js/353.93baf91c.js"><link rel="prefetch" href="/assets/js/354.ce9d0e4c.js"><link rel="prefetch" href="/assets/js/355.110b2119.js"><link rel="prefetch" href="/assets/js/356.31c1cb3f.js"><link rel="prefetch" href="/assets/js/357.fc56933d.js"><link rel="prefetch" href="/assets/js/358.3d6f0995.js"><link rel="prefetch" href="/assets/js/359.e42fb771.js"><link rel="prefetch" href="/assets/js/36.51ff5da4.js"><link rel="prefetch" href="/assets/js/360.b23f20a6.js"><link rel="prefetch" href="/assets/js/361.d40a5970.js"><link rel="prefetch" href="/assets/js/362.5526289b.js"><link rel="prefetch" href="/assets/js/363.57de68f3.js"><link rel="prefetch" href="/assets/js/364.be1cb110.js"><link rel="prefetch" href="/assets/js/365.61d49f0a.js"><link rel="prefetch" href="/assets/js/366.b507225c.js"><link rel="prefetch" href="/assets/js/367.7b1436ad.js"><link rel="prefetch" href="/assets/js/368.dcd60637.js"><link rel="prefetch" href="/assets/js/369.51c46392.js"><link rel="prefetch" href="/assets/js/37.4d7470cc.js"><link rel="prefetch" href="/assets/js/370.79f0015e.js"><link rel="prefetch" href="/assets/js/371.d8c48ef6.js"><link rel="prefetch" href="/assets/js/372.3ccfa0e9.js"><link rel="prefetch" href="/assets/js/373.6ff5c143.js"><link rel="prefetch" href="/assets/js/374.f4fcf914.js"><link rel="prefetch" href="/assets/js/375.d24d77a1.js"><link rel="prefetch" href="/assets/js/376.46fa8c82.js"><link rel="prefetch" href="/assets/js/377.dc0360fd.js"><link rel="prefetch" href="/assets/js/38.b792089b.js"><link rel="prefetch" href="/assets/js/39.65ad4770.js"><link rel="prefetch" href="/assets/js/4.86cba761.js"><link rel="prefetch" href="/assets/js/40.8b58385f.js"><link rel="prefetch" href="/assets/js/41.398e86ae.js"><link rel="prefetch" href="/assets/js/42.789f1388.js"><link rel="prefetch" href="/assets/js/43.05f9d13d.js"><link rel="prefetch" href="/assets/js/44.c2b40548.js"><link rel="prefetch" href="/assets/js/45.df48e9a2.js"><link rel="prefetch" href="/assets/js/46.b83749fb.js"><link rel="prefetch" href="/assets/js/47.7ef7d498.js"><link rel="prefetch" href="/assets/js/48.228e3df9.js"><link rel="prefetch" href="/assets/js/49.fda0dc0b.js"><link rel="prefetch" href="/assets/js/5.3a0ea465.js"><link rel="prefetch" href="/assets/js/50.d9cf5581.js"><link rel="prefetch" href="/assets/js/51.3096a574.js"><link rel="prefetch" href="/assets/js/52.479127e5.js"><link rel="prefetch" href="/assets/js/53.5e0b1963.js"><link rel="prefetch" href="/assets/js/54.59740785.js"><link rel="prefetch" href="/assets/js/55.3b7f709a.js"><link rel="prefetch" href="/assets/js/56.54492258.js"><link rel="prefetch" href="/assets/js/57.35db8f10.js"><link rel="prefetch" href="/assets/js/58.4de20d90.js"><link rel="prefetch" href="/assets/js/59.63dfef23.js"><link rel="prefetch" href="/assets/js/6.5a97029d.js"><link rel="prefetch" href="/assets/js/60.fdf12a20.js"><link rel="prefetch" href="/assets/js/61.fe3f97d3.js"><link rel="prefetch" href="/assets/js/62.f1b0daf7.js"><link rel="prefetch" href="/assets/js/63.93837b5d.js"><link rel="prefetch" href="/assets/js/64.97a1fe26.js"><link rel="prefetch" href="/assets/js/65.70f35686.js"><link rel="prefetch" href="/assets/js/66.3ba3c686.js"><link rel="prefetch" href="/assets/js/67.14cef3f2.js"><link rel="prefetch" href="/assets/js/68.e8a147f5.js"><link rel="prefetch" href="/assets/js/69.24e88bd2.js"><link rel="prefetch" href="/assets/js/7.ce6c36f3.js"><link rel="prefetch" href="/assets/js/70.15818cd2.js"><link rel="prefetch" href="/assets/js/71.119594cc.js"><link rel="prefetch" href="/assets/js/72.9fcbbf86.js"><link rel="prefetch" href="/assets/js/73.b82c6339.js"><link rel="prefetch" href="/assets/js/74.32848a73.js"><link rel="prefetch" href="/assets/js/75.6efef423.js"><link rel="prefetch" href="/assets/js/76.17ea6bee.js"><link rel="prefetch" href="/assets/js/77.220ac10b.js"><link rel="prefetch" href="/assets/js/78.a880b44d.js"><link rel="prefetch" href="/assets/js/79.217ab01c.js"><link rel="prefetch" href="/assets/js/8.cbd97eba.js"><link rel="prefetch" href="/assets/js/80.2e717400.js"><link rel="prefetch" href="/assets/js/81.b7277c4e.js"><link rel="prefetch" href="/assets/js/82.8e22a60c.js"><link rel="prefetch" href="/assets/js/83.c39494a6.js"><link rel="prefetch" href="/assets/js/84.e379d0cd.js"><link rel="prefetch" href="/assets/js/85.3f7d9716.js"><link rel="prefetch" href="/assets/js/86.a7c0bd99.js"><link rel="prefetch" href="/assets/js/87.eb9b0263.js"><link rel="prefetch" href="/assets/js/88.32d31cd7.js"><link rel="prefetch" href="/assets/js/89.cb0eb0c6.js"><link rel="prefetch" href="/assets/js/9.e79b9220.js"><link rel="prefetch" href="/assets/js/90.2aa9f60f.js"><link rel="prefetch" href="/assets/js/91.979af91d.js"><link rel="prefetch" href="/assets/js/92.ecca824d.js"><link rel="prefetch" href="/assets/js/93.70a3d5ac.js"><link rel="prefetch" href="/assets/js/94.c163ecdc.js"><link rel="prefetch" href="/assets/js/95.d5eb2ea5.js"><link rel="prefetch" href="/assets/js/96.d596f924.js"><link rel="prefetch" href="/assets/js/97.fde076d3.js"><link rel="prefetch" href="/assets/js/98.1189bd76.js"><link rel="prefetch" href="/assets/js/99.9e004fea.js">
    <link rel="stylesheet" href="/assets/css/0.styles.55beba5e.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="洋仔的博客" class="logo"> <span class="site-name can-hide">洋仔的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人心法" class="dropdown-title"><a href="/person/" class="link-title">个人心法</a> <span class="title" style="display:none;">个人心法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>个人心法总结</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fe3f91/" class="nav-link">价值心法</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/pages/d13cac/" class="nav-link">iOS基础知识</a></li><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">前端</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/more/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/15d3d8/" class="nav-link">投资体系</a></li><li class="dropdown-item"><!----> <a href="/pages/4db018/" class="nav-link">毛选</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/214070779/publicPicture@master/pingtou.5ytkqlpmd940.webp"> <div class="blogger-info"><h3>洋仔</h3> <span>奋斗的小青年</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人心法" class="dropdown-title"><a href="/person/" class="link-title">个人心法</a> <span class="title" style="display:none;">个人心法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>个人心法总结</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fe3f91/" class="nav-link">价值心法</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/pages/d13cac/" class="nav-link">iOS基础知识</a></li><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">前端</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/more/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/15d3d8/" class="nav-link">投资体系</a></li><li class="dropdown-item"><!----> <a href="/pages/4db018/" class="nav-link">毛选</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术文档</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GitHub技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>博客搭建</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>iOS基础知识</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>iOS底层相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Runloop系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Runtime系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>内存管理系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Block系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>线程系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>KVC跟KVO系列以及通知中心</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>UI系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>离屏渲染系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>组件化系列跟架构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>OC跟webview交互系列</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/fed973/" aria-current="page" class="active sidebar-link">OC跟webview交互系列</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/fed973/#oc与-js交互方式有哪些" class="sidebar-link">OC与 JS交互方式有哪些?</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/fed973/#通过js调用oc代码-url拦截-一" class="sidebar-link">通过JS调用OC代码(url拦截)一</a></li><li class="sidebar-sub-header level3"><a href="/pages/fed973/#方法四-webviewjavascriptbridge" class="sidebar-link">方法四 WebViewJavascriptBridge</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/fed973/#wkwebview-白屏问题" class="sidebar-link">WKWebView 白屏问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/fed973/#解决方案" class="sidebar-link">解决方案</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/fed973/#wkwebview-cookie问题" class="sidebar-link">WKWebView Cookie问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/fed973/#wkwebview-cookie存储" class="sidebar-link">WKWebView Cookie存储</a></li><li class="sidebar-sub-header level3"><a href="/pages/fed973/#wkprocesspool" class="sidebar-link">WKProcessPool</a></li><li class="sidebar-sub-header level3"><a href="/pages/fed973/#workround" class="sidebar-link">Workround</a></li><li class="sidebar-sub-header level3"><a href="/pages/fed973/#wkwebview-nsurlprotocol-问题" class="sidebar-link">WKWebView NSURLProtocol 问题</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/fed973/#wkwebview-loadrequest问题" class="sidebar-link">WKWebView loadRequest问题</a></li><li class="sidebar-sub-header level2"><a href="/pages/fed973/#wkwebview页面样式问题" class="sidebar-link">WKWebView页面样式问题</a></li><li class="sidebar-sub-header level2"><a href="/pages/fed973/#wkwebview截屏问题" class="sidebar-link">WKWebView截屏问题</a></li><li class="sidebar-sub-header level2"><a href="/pages/fed973/#wkwebview-crash问题" class="sidebar-link">WKWebView crash问题</a></li><li class="sidebar-sub-header level2"><a href="/pages/fed973/#其它问题" class="sidebar-link">其它问题</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>持久化系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>APP编译系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>APP性能优化系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>cocoapods系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>swift系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Git系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>网络相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>三方库系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>系统原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>总结系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>算法系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>数据结构系列</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/ui/#技术" data-v-06225672>技术</a></li><li data-v-06225672><a href="/ui/#iOS基础知识" data-v-06225672>iOS基础知识</a></li><li data-v-06225672><a href="/ui/#OC跟webview交互系列" data-v-06225672>OC跟webview交互系列</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/214070779" target="_blank" title="作者" class="beLink" data-v-06225672>洋仔</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-08-11</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">OC跟webview交互系列<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="oc与-js交互方式有哪些"><a href="#oc与-js交互方式有哪些" class="header-anchor">#</a> OC与 JS交互方式有哪些?</h2> <ol><li>拦截url（适用于UIWebView和WKWebView）</li> <li>JavaScriptCore（只适用于UIWebView，iOS7+）</li> <li>WKScriptMessageHandler（只适用于WKWebView，iOS8+）</li> <li>WebViewJavascriptBridge（适用于UIWebView和WKWebView，属于第三方框架）</li></ol> <h3 id="通过js调用oc代码-url拦截-一"><a href="#通过js调用oc代码-url拦截-一" class="header-anchor">#</a> 通过JS调用OC代码(url拦截)一</h3> <p>通过拦截url（适用于UIWebView和WKWebView）</p> <ol><li>和后端同事协定好协议，如jxaction://scan表示启动二维码扫描，jxaction://location表示获取定位。</li> <li>实现UIWebView代理的shouldStartLoadWithRequest:navigationType:方法，在方法中对url进行拦截，如果是步奏&lt;1&gt;中定义好的协议则执行对应原生代码，返回false，否则返回true继续加载原url。<div class="language- line-numbers-mode"><pre class="language-text"><code>// js调用原生
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <ul><li><p>(BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType {
NSString *url = request.URL.absoluteString;
if ([url rangeOfString:@&quot;需要跳转源生界面的URL判断&quot;].location != NSNotFound) {</p> <div class="language- extra-class"><pre><code>  //跳转原生界面
  return NO;
</code></pre></div><p>}
return YES;
}</p></li></ul> <p>h5代码：
<a href="jxaction://scan">扫一扫(拦截url)</a></p> <p>// 原生调用js：直接调用UIWebView的stringByEvaluatingJavaScriptFromString:方法，或者WKWebView的 evaluateJavaScript:completionHandler:方法。
若（1）中扫描二维码结束后，需要把扫描结果返回给web页，直接调用UIWebView的stringByEvaluatingJavaScriptFromString:方法，或者WKWebView的 evaluateJavaScript:completionHandler:方法。
[self.webView stringByEvaluatingJavaScriptFromString:@&quot;scanResult('我是扫描结果~')&quot;];</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>### 方法二JavaScriptCore

方法一web调用原生只适合简单的调用，如果要传递参数，虽然也可以拼接在url上，如jxaction://scan?method=aaa，但是需要我们自行对字符串进行分割解析，并且特殊字符需要编码。在iOS7系统提供了JavaScriptCore，可以更优雅地实现js与原生的交互。
**js调用原生**
1. 新建类继承自NSObject（如AppJSObject）。
2. h文件中声明一个代理并遵循JSExport，代理内的方法和js定义的方法名一致。
3. m文件中实现&lt;2&gt;代理中对应的方法，可以在方法内处理事件或通知代理。

AppJSObject.h
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>#import &lt;Foundation/Foundation.h&gt;
#import &lt;JavaScriptCore/JavaScriptCore.h&gt;</p> <p>@protocol AppJSObjectDelegate <JSExport></JSExport></p> <p>-(void)scan:(NSString *)message;</p> <p>@end</p> <p>@interface AppJSObject : NSObject<AppJSObjectDelegate></AppJSObjectDelegate></p> <p>@property(nonatomic,weak) id<AppJSObjectDelegate> delegate;</AppJSObjectDelegate></p> <p>@end</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>AppJSObject.m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>#import &quot;AppJSObject.h&quot;</p> <p>@implementation AppJSObject</p> <p>-(void)scan:(NSString *)message{
[self.delegate scan:message];
}</p> <p>@end</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>h5代码：
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><input type="button" name="" value="扫一扫" onclick="scan()"> <br> <p id="result">扫描结果：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>4. 在UIWebView加载完成的代理中把AppJSObject实例对象类注入到JS中，那么在js中调用方法就会调用到原生AppJSObject实例对象中对应的方法了。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>-(void)webViewDidFinishLoad:(UIWebView *)webView
{
JSContext *context=[webView valueForKeyPath:@&quot;documentView.webView.mainFrame.javaScriptContext&quot;];</p> <div class="language- extra-class"><pre><code>AppJSObject *jsObject = [AppJSObject new];
jsObject.delegate = self;
context[@&quot;app&quot;] = jsObject;
</code></pre></div><p>}</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>也可以通过block实现而不创建新类AppJSObject:
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>context[@&quot;openAlbum&quot;] = ^(){
NSLog(@&quot;js调用oc打开相册&quot;);
};</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>**原生调用js**

可以通过一中的方法，也可以通过JSContext：
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>JSContext *context=[_mainWebView valueForKeyPath:@&quot;documentView.webView.mainFrame.javaScriptContext&quot;];
NSString *alertJS= [NSString stringWithFormat:@&quot;%@('%@')&quot;,_photoMethod,fileUrl];
[context evaluateScript:alertJS];</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>### 方法三. WKScriptMessageHandler

现在很多app都是支持iOS8+，很多人使用WKWebView代替了UIWebView，但是WKWebView并不支持方法二。此时我们可以使用WKWebView的WKScriptMessageHandler
1. 初始化WKWebView时，调用addScriptMessageHandler:name:方法，name为js中的方法名，如scan:
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><p>(void)setupWKWebView{
WKWebViewConfiguration *configuration = [[WKWebViewConfiguration alloc] init];
configuration.userContentController = [[WKUserContentController alloc] init];
[configuration.userContentController addScriptMessageHandler:self name:@&quot;scan&quot;];</p> <p>WKWebView *webView = [[WKWebView alloc] initWithFrame:self.view.frame configuration:configuration];
webView.UIDelegate = self;
}</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>h5:
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>window.webkit.messageHandlers.scan.postMessage()</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <ol start="2"><li>实现WKScriptMessageHandler代理方法，当js调用scan方法时，会回调此代理方法：</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>- (void)userContentController:(WKUserContentController *)userContentController didReceiveScriptMessage:(WKScriptMessage *)message{
    if ([message.name isEqualToString:@&quot;scan&quot;]) {
        //调用原生扫码
     }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="方法四-webviewjavascriptbridge"><a href="#方法四-webviewjavascriptbridge" class="header-anchor">#</a> 方法四 WebViewJavascriptBridge</h3> <p>是一个第三方框架，官方文档和demo都很完整，不再累赘，GitHub地址：
<a href="https://github.com/marcuswestin/WebViewJavascriptBridge" target="_blank" rel="noopener noreferrer">WebViewJavascriptBridge<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="wkwebview-白屏问题"><a href="#wkwebview-白屏问题" class="header-anchor">#</a> WKWebView 白屏问题</h2> <p>WKWebView是一个多进程的组件，Network Loading以及UI Rendering在其他进程中执行。初次适配WKWebView的时候，我们也惊讶于打开WKWebView后， App进程内存消耗反而大幅度下降，但仔细观察会发现，Other Process的内存占用会增加。在一些用webGL渲染的复杂页面，使用WKWebView总体的内存占用【App process Memory + other Process Memory】，不见得比UIWebView少很多。</p> <p>UIWebView上当内存占用太大的时候， App Process会crash；而在WKWebView上当总体的内存占用比较大的时候，WebContent Process会crash， 从而出现白屏现象</p> <p>这个时候WKWebView.URL会变成nil，简单的reload刷新操作已经失效，对于一些长驻的H5页面影响比较大。</p> <h3 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案</h3> <ol><li>借助WKNavigationDelegate
iOS9之后增加的回调函数<div class="language- line-numbers-mode"><pre class="language-text"><code>/*! @abstract Invoked when the web view's web content process is terminated.
@param webView The web view whose underlying web content process was terminated.
*/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol> <ul><li><p>(void)webViewWebContentProcessDidTerminate:(WKWebView *)webView API_AVAILABLE(macos(10.11), ios(9.0));</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <p>在WKWebView总体内存占用过大的时候，页面即将出现白屏，在上面这个系统回调方法中执行[webview reload]来解决白屏问题。</p> <ol start="2"><li>检测webView.title是否为空</li></ol> <p>并不是所有的H5页面白屏的时候都会调用上面的回调函数； 场景：最近遇到的一个高内存消耗的H5页面上present系统相机，拍照完毕后返回原来页面的时候出现白屏现象（拍照过程消耗了大量内存，导致内存紧张， WebContent Process被系统挂起），但上面的回调函数并没有被调用。在WKWebView白屏的时候，另一种现象是webView.title会被置空，因此，可以在viewWillAppear的时候检测webView.title是否为空来reload页面。</p> <h2 id="wkwebview-cookie问题"><a href="#wkwebview-cookie问题" class="header-anchor">#</a> WKWebView Cookie问题</h2> <h3 id="wkwebview-cookie存储"><a href="#wkwebview-cookie存储" class="header-anchor">#</a> WKWebView Cookie存储</h3> <p>业界普遍认为 WKWebView 拥有自己的私有存储，不会将 Cookie 存入到标准的 Cookie 容器 NSHTTPCookieStorage 中。</p> <p>实践发现 WKWebView 实例其实也会将 Cookie 存储于 NSHTTPCookieStorage 中，但存储时机有延迟，在iOS 8上，当页面跳转的时候，当前页面的 Cookie 会写入 NSHTTPCookieStorage 中，而在 iOS 10 上，JS 执行 document.cookie 或服务器 set-cookie 注入的 Cookie 会很快同步到 NSHTTPCookieStorage 中，FireFox 工程师曾建议通过 reset WKProcessPool 来触发 Cookie 同步到 NSHTTPCookieStorage 中，实践发现不起作用，并可能会引发当前页面 session cookie 丢失等问题。</p> <p><strong>WKWebView Cookie 问题在于 WKWebView 发起的请求不会自动带上存储于 NSHTTPCookieStorage 容器中的 Cookie。</strong></p> <p>比如，NSHTTPCookieStorage 中存储了一个 Cookie:</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>name=Nicholas;value=test;domain=y.qq.com;expires=Sat, 02 May 2019 23:38:25 GMT；</p></div> <p>通过 UIWebView 发起请求http://y.qq.com， 则请求头会自动带上 cookie: Nicholas=test； 而通过 WKWebView发起请求http://y.qq.com， 请求头不会自动带上 cookie: Nicholas=test。</p> <h3 id="wkprocesspool"><a href="#wkprocesspool" class="header-anchor">#</a> WKProcessPool</h3> <ul><li>WKProcessPool定义：A WKProcessPool object represents a pool of Web Content process。</li></ul> <p>通过让所有 WKWebView 共享同一个 WKProcessPool 实例，可以实现多个 WKWebView 之间共享 Cookie（session Cookie and persistent Cookie）数据。 不过WKWebView WkProcessPool实例在app杀进程重启后会被重置，导致WKProcessPool 中的cookie/session Cookie数据丢失，目前也无法实现WKProcessPool实例本地化保存。</p> <h3 id="workround"><a href="#workround" class="header-anchor">#</a> Workround</h3> <p>H5的业务都是依赖于Cookie作登陆态校验，而WKWebView上请求不会自动携带Cookie，目前的主要解决方案是：</p> <ol><li><p>WKWebView loadRequest前，在request header中设置Cookie，解决首个请求Cookie带不上的问题</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>WKWebView * webView = [WKWebView new]; 
NSMutableURLRequest * request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@&quot;http://h5.qzone.qq.com/mqzone/index&quot;]]; 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol> <p>[request addValue:@&quot;skey=skeyValue&quot; forHTTPHeaderField:@&quot;Cookie&quot;];
[webView loadRequest:request];</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>2. 通过document.cookie设置Cookie解决后续页面（同域）Ajax， iframe 请求的cookie问题 注意：document.cookie() 无法跨域设置cookie
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>WKUserContentController* userContentController = [WKUserContentController new];
WKUserScript * cookieScript = [[WKUserScript alloc] initWithSource: @&quot;document.cookie = 'skey=skeyValue';&quot; injectionTime:WKUserScriptInjectionTimeAtDocumentStart forMainFrameOnly:NO];</p> <p>[userContentController addUserScript:cookieScript];</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>这种方案无法解决302请求的Cookie问题，比如：第一个请求时www.a.com,我们通过在request header里带上Cookie解决该请求的Cookie问题，接着页面302跳转到www.b.com, 这个时候www.b.com 这个请求就可能因为没有携带cookie而无法访问。当然，由于每一次页面跳转都会调用回调函数：
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><p>(void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler;</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <p>可以在该回调函数里拦截302请求，copy request， 在request header中带上cookie并重新loadRequest。不过这种方法依然解决不了页面的iframe跨域请求的cookie问题，毕竟-[WKWebView loadRequest]只适合加载mainiFrame请求。</p> <h3 id="wkwebview-nsurlprotocol-问题"><a href="#wkwebview-nsurlprotocol-问题" class="header-anchor">#</a> WKWebView NSURLProtocol 问题</h3> <p>WKWebView在独立于App进程之外的进程中执行网络请求，请求数据不经过主进程，因此，在WKWebView上直接使用NSURLProcol无法拦截请求。</p> <p>苹果开源的WebKit源码暴露了私有API</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>+ [WKBrowsingContextController registerSchemeForCustomProtocol:]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过注册http(s) scheme 后， WKWebView将可以使用NSURLProtocol拦截http(s)请求：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Class cls = NSClassFromString(@&quot;WKBrowsingContextController”); 
SEL sel = NSSelectorFromString(@&quot;registerSchemeForCustomProtocol:&quot;); 
if ([(id)cls respondsToSelector:sel]) { 
           // 注册http(s) scheme, 把 http和https请求交给 NSURLProtocol处理 
           [(id)cls performSelector:sel withObject:@&quot;http&quot;]; 
           [(id)cls performSelector:sel withObject:@&quot;https&quot;]; 
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点</h4> <ol><li>post请求body数据被清空 由于WKWebView在独立进程里网络请求。一旦注册http(s) scheme后，网络请求将从Network process发送到App Process，这样NSURLProtocol才能拦截网络请求。 在webkit2的设计里使用了messageQueue进行进程之间的通信， Network Process会将请求encode成一个Message，然后通过IPC发送给App Process。 出于性能的原因，encode的时候HTTPBody和HTTPBodyStream这两个字段丢弃掉了。</li></ol> <p>因此，如果通过registerSchemeForCustomProcol注册了http(s) scheme，那么由WKWebView发起的所有http(s)请求都会通过IPC传给进程NSURLProtocol处理，导致post请求body被清空；</p> <ol start="2"><li>对ATS支持不足 打开ATS开关： Allow Arbitrary Loads选项设置为NO，同时通过registerSchemeForCustomProtocol注册了http(s) scheme；WKWebView发起的所有http网络请求将被阻塞(即便将Allow Arbitrary Loads in Web Content 选项设置为YES) WKWebView可以注册customScheme，比如dynamic://，因此希望使用离线功能，又不使用post方式的请求可以通过customScheme发起请求，eg：dynamic://www.dynamicalbumlocalimage.com/，然后在 app 进程 NSURLProtocol 拦截这个请求并加载离线数据。不足： 使用post方式的请求该方案依然不适用，同时需要H5侧修改请求scheme以及CSP规则。</li></ol> <h2 id="wkwebview-loadrequest问题"><a href="#wkwebview-loadrequest问题" class="header-anchor">#</a> WKWebView loadRequest问题</h2> <p>在WKWebView上通过loadRequest发起的post请求body数据会丢失；</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//同样是由于进程间通信性能问题，HTTPBody字段被丢弃
[request setHTTPMethod:@&quot;POST&quot;];
[request setHTTPBody:[@&quot;bodyData&quot; dataUsingEncoding:NSUTF8StringEncoding]];
[wkwebview loadRequest: request];
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>workround: 假设想通过-[WKWebView loadRequest:]加载post请求，request1： http://h5.qzone.qq.com/mqzone/index，可以通过以下步骤实现：</p> <ol><li>替换请求scheme，生成新的post请求request2：post://h5.qzone.qq.com/mqzone/index，同时将request1的body字段复制到request2的header中（WebKit不会丢弃header字段）</li> <li>通过-[WKWebView loadRequest:]加载新的post请求request2；</li> <li>通过 +[WKbrowsingContextController registerSchemeForCustom Protocol：]注册scheme:post://;</li> <li>注册 NSURLProtocol 拦截请求post://h5.qzone.qq.com/mqzone/index ,替换请求 scheme, 生成新的请求 request3: http://h5.qzone.qq.com/mqzone/index，将 request2 header的body 字段复制到 request3 的 body 中，并使用 NSURLConnection 加载 request3，最后通过 NSURLProtocolClient 将加载结果返回 WKWebView;</li></ol> <h2 id="wkwebview页面样式问题"><a href="#wkwebview页面样式问题" class="header-anchor">#</a> WKWebView页面样式问题</h2> <p>适配过程中，发现h5页面元素位置向下偏移或被拉伸变形，追踪后发现主要是h5页面高度值异常导致：</p> <p><strong>问题1:</strong></p> <p>空间H5页面有透明导航、透明导航下拉刷新、全屏等需求，因此之前 webView 整个是从（0, 0）开始布局，通过调整webView.scrollView.contentInset 来适配特殊导航栏需求。而在 WKWebView 上对 contentInset 的调整会反馈到webView.scrollView.contentSize.height的变化上，比如设置 webView.scrollView.contentInset.top = a，那么contentSize.height的值会增加a,导致H5页面长度增加，页面元素位置向下偏移；</p> <p><strong>解决方案:</strong></p> <p>调整WKWebView布局方式，避免调整webView.scrollView.contentInset。实际上，即便在 UIWebView 上也不建议直接调整webView.scrollView.contentInset的值，这确实会带来一些奇怪的问题。如果某些特殊情况下非得调整 contentInset 不可的话，可以通过下面方式让H5页面恢复正常显示：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>/**设置contentInset值后通过调整webView.frame让页面恢复正常显示 
 *参考：http://km.oa.com/articles/show/277372
 */ 
webView.scrollView.contentInset = UIEdgeInsetsMake(a, 0, 0, 0); 
webView.frame = CGRectMake(webView.frame.origin.x, webView.frame.origin.y, webView.frame.size.width, webView.frame.size.height - a);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>问题2:接入now直播问题</strong></p> <p>在接入 now 直播的时候，我们发现在 iOS 9 上 WKWebView 会出现页面被拉伸变形的情况，最后发现是window.innerHeight值不准确导致（在WKWebView上返回了一个非常大的值），而H5同学通过获取window.innerHeight来设置页面高度，导致页面整体被拉伸。通过查阅相关资料发现，这个bug只在 iOS 9 的几个系统版本上出现，苹果后来fix了这个bug。我们最后的解决方案是：延迟调用window.innerHeight。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>setTimeout(function(){height = window.innerHeight},0);
或者
Use shrink-to-fit meta-tag 
&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1, shrink-to-fit=no&quot;&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="wkwebview截屏问题"><a href="#wkwebview截屏问题" class="header-anchor">#</a> WKWebView截屏问题</h2> <p>空间玩吧H5小游戏有截屏分享的功能，WKWebView 下通过 -[CALayer renderInContext:]实现截屏的方式失效，需要通过以下方式实现截屏功能：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@implementation UIView (ImageSnapshot) 
- (UIImage*)imageSnapshot { 
    UIGraphicsBeginImageContextWithOptions(self.bounds.size,YES,self.contentScaleFactor); 
    [self drawViewHierarchyInRect:self.bounds afterScreenUpdates:YES]; 
    UIImage* newImage = UIGraphicsGetImageFromCurrentImageContext(); 
    UIGraphicsEndImageContext(); 
    return newImage; 
} 
@end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>然而这种方式依然解决不了 webGL 页面的截屏问题，笔者已经翻遍苹果文档，研究过 webKit2 源码里的截屏私有API，依然没有找到合适的解决方案，同时发现 Safari 以及 Chrome 这两个全量切换到 WKWebView 的浏览器也存在同样的问题：对webGL 页面的截屏结果不是空白就是纯黑图片。无奈之下，我们只能约定一个JS接口，让游戏开发商实现该接口，具体是通过 canvas getImageData()方法取得图片数据后返回 base64 格式的数据，客户端在需要截图的时候，调用这个JS接口获取 base64 String 并转换成 UIImage。</p> <h2 id="wkwebview-crash问题"><a href="#wkwebview-crash问题" class="header-anchor">#</a> WKWebView crash问题</h2> <p>WKWebView 放量后，外网新增了一些 crash, 其中一类 crash 的主要堆栈如下：</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>...
28 UIKit 0x0000000190513360 UIApplicationMain + 208
29 Qzone 0x0000000101380570 main (main.m:181)
30 libdyld.dylib 0x00000001895205b8 _dyld_process_info_notify_release + 36
Completion handler passed to -[QZWebController webView:runJavaScriptAlertPanelWithMessage:initiatedByFrame:completionHandler:] was not called</p></div> <p>主要是JS调用window.alert()函数引起的，从 crash 堆栈可以看出是 WKWebView 回调函数:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>+ (void) presentAlertOnController:(nonnull UIViewController*)parentController title:(nullable NSString*)title message:(nullable NSString *)message handler:(nonnull void (^)())completionHandler;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>completionHandler 没有被调用导致的。在适配 WKWebView 的时候，我们需要自己实现该回调函数，window.alert()才能调起 alert 框，我们最初的实现是这样的：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>- (void)webView:(WKWebView *)webView runJavaScriptAlertPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(void))completionHandler 
{ 
    UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@&quot;&quot; message:message preferredStyle:UIAlertControllerStyleAlert]; 
    [alertController addAction:[UIAlertAction actionWithTitle:@&quot;确认&quot; style:UIAlertActionStyleCancel handler:^(UIAlertAction *action) { completionHandler(); }]]; 
    [self presentViewController:alertController animated:YES completion:^{}]; 
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果 WKWebView 退出的时候，JS刚好执行了window.alert(), alert 框可能弹不出来，completionHandler 最后没有被执行，导致 crash；另一种情况是在 WKWebView 一打开，JS就执行window.alert()，这个时候由于 WKWebView 所在的 UIViewController 出现（push或present）的动画尚未结束，alert 框可能弹不出来，completionHandler 最后没有被执行，导致 crash。我们最终的实现大致是这样的：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>- (void)webView:(WKWebView *)webView runJavaScriptAlertPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(void))completionHandler 
{ 
    if (/*UIViewController of WKWebView has finish push or present animation*/) { 
        completionHandler(); 
        return; 
    } 
    UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@&quot;&quot; message:message preferredStyle:UIAlertControllerStyleAlert]; 
    [alertController addAction:[UIAlertAction actionWithTitle:@&quot;确认&quot; style:UIAlertActionStyleCancel handler:^(UIAlertAction *action) { completionHandler(); }]]; 
    if (/*UIViewController of WKWebView is visible*/) 
        [self presentViewController:alertController animated:YES completion:^{}]; 
    else 
        completionHandler(); 
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>确保上面两种情况下 completionHandler 都能被执行，消除了 WKWebView 下弹 alert 框的 crash，WKWebView 下弹 confirm 框的 crash 的原因与解决方式与 alert 类似。</p> <p>另一个 crash 发生在 WKWebView 退出前调用：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>-[WKWebView evaluateJavaScript: completionHandler:]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行JS代码的情况下。WKWebView 退出并被释放后导致completionHandler变成野指针，而此时 javaScript Core 还在执行JS代码，待 javaScript Core 执行完毕后会调用completionHandler()，导致 crash。这个 crash 只发生在 iOS 8 系统上，参考Apple Open Source，在iOS9及以后系统苹果已经修复了这个bug，主要是对completionHandler block做了copy（refer: https://trac.webkit.org/changeset/179160）；对于iOS 8系统，可以通过在 completionHandler 里 retain WKWebView 防止 completionHandler 被过早释放。我们最后用 methodSwizzle hook 了这个系统方法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>+ (void) load 
{ 
     [self jr_swizzleMethod:NSSelectorFromString(@&quot;evaluateJavaScript:completionHandler:&quot;) withMethod:@selector(altEvaluateJavaScript:completionHandler:) error:nil]; 
} 
/* 
 * fix: WKWebView crashes on deallocation if it has pending JavaScript evaluation 
 */ 
- (void)altEvaluateJavaScript:(NSString *)javaScriptString completionHandler:(void (^)(id, NSError *))completionHandler 
{ 
    id strongSelf = self; 
    [self altEvaluateJavaScript:javaScriptString completionHandler:^(id r, NSError *e) { 
        [strongSelf title]; 
        if (completionHandler) { 
            completionHandler(r, e); 
        } 
    }]; 
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="其它问题"><a href="#其它问题" class="header-anchor">#</a> 其它问题</h2> <p><strong>问题1</strong></p> <p>视频自动播放 WKWebView 需要通过WKWebViewConfiguration.mediaPlaybackRequiresUserAction设置是否允许自动播放，但一定要在 WKWebView 初始化之前设置，在 WKWebView 初始化之后设置无效。</p> <p><strong>问题2</strong>
goBack API问题 WKWebView 上调用 -[WKWebView goBack], 回退到上一个页面后不会触发window.onload()函数、不会执行JS。</p> <p><strong>问题3</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>- (void)scrollViewWillBeginDragging:(UIScrollView *)scrollView {
     scrollView.decelerationRate = UIScrollViewDecelerationRateNormal;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>登录后cookie携带不上问题</strong>
现象：未登录访问h5页面，点击按钮弹出登录页，登录成功后再次点击按钮，又弹出登录页，抓包cookie为空
原因：登录后登录状态写进cookie里了，并保存在NSHTTPCookieStorage里，但是没有同步到WKHTTPCookieStore里，所以h5获取不到cookie
解决，登录后重新加载 loadRequest</p> <p><strong>Cookie异常丢失</strong></p> <p>由于WKWebView加载网页得到的Cookie会同步到NSHTTPCookieStorage中的特点，有时候你强行添加的Cookie会在同步过程中丢失。抓包你就会发现，点击一个链接时，Request的header中多了Set-Cookie字段，其实Cookie已经丢了</p> <p>解决：把自己需要的Cookie主动保存起来，每次调用[NSHTTPCookieStorage sharedHTTPCookieStorage].cookies方法时，保证返回的数组中有自己需要的Cookie，用了runtime的Method Swizzling，代码如下：</p> <p>适当的时候保存cookie</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//比如登录成功，保存Cookie
NSArray *allCookies = [[NSHTTPCookieStorage sharedHTTPCookieStorage] cookies];
for (NSHTTPCookie *cookie in allCookies) {
    if ([cookie.name isEqualToString:DAServerSessionCookieName]) {
        NSDictionary *dict = [[NSUserDefaults standardUserDefaults] dictionaryForKey:DAUserDefaultsCookieStorageKey];
        if (dict) {
            NSHTTPCookie *localCookie = [NSHTTPCookie cookieWithProperties:dict];
            if (![cookie.value isEqual:localCookie.value]) {
                NSLog(@&quot;本地Cookie有更新&quot;);
            }
        }
        [[NSUserDefaults standardUserDefaults] setObject:cookie.properties forKey:DAUserDefaultsCookieStorageKey];
        [[NSUserDefaults standardUserDefaults] synchronize];
        break;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>读取时如果cookie为空则添加</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@implementation NSHTTPCookieStorage (Utils)

+ (void)load
{
    class_methodSwizzling(self, @selector(cookies), @selector(da_cookies));
}

- (NSArray&lt;NSHTTPCookie *&gt; *)da_cookies
{
    NSArray *cookies = [self da_cookies];
    BOOL isExist = NO;
    for (NSHTTPCookie *cookie in cookies) {
        if ([cookie.name isEqualToString:DAServerSessionCookieName]) {
            isExist = YES;
            break;
        }
    }
    if (!isExist) {
        //CookieStroage中添加
        NSDictionary *dict = [[NSUserDefaults standardUserDefaults] dictionaryForKey:DAUserDefaultsCookieStorageKey];
        if (dict) {
            NSHTTPCookie *cookie = [NSHTTPCookie cookieWithProperties:dict];
            [[NSHTTPCookieStorage sharedHTTPCookieStorage] setCookie:cookie];
            NSMutableArray *mCookies = cookies.mutableCopy;
            [mCookies addObject:cookie];
            cookies = mCookies.copy;
        }
    }
    return cookies;
}

@end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/xugaoyi/vuepress-theme-vdoing/edit/master/docs/02.技术/05.iOS基础知识/10.OC跟webview交互系列/00.OC跟webview交互系列.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/10/23, 23:26:17</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/b14b84/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">MVVM、MVC、MVP</div></a> <a href="/pages/1c267e/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">持久化系列</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/b14b84/" class="prev">MVVM、MVC、MVP</a></span> <span class="next"><a href="/pages/1c267e/">持久化系列</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/1e9b25/"><div>
            排序算法
            <!----></div></a> <span class="date">10-22</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/f27637/"><div>
            学习数据结构和算法的高效方法
            <!----></div></a> <span class="date">10-19</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/39672b/"><div>
            时间复杂度跟空间复杂度
            <!----></div></a> <span class="date">10-19</span></dt></dl> <dl><dd></dd> <dt><a href="/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:yangzai2140@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/214070779" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2024
    <span>Evan Xu | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.cc55d274.js" defer></script><script src="/assets/js/2.81b2a5fe.js" defer></script><script src="/assets/js/3.1b6e43a5.js" defer></script>
  </body>
</html>
